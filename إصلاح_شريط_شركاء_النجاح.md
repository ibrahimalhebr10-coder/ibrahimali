# โ ุฅุตูุงุญ ุดุฑูุท "ุงูุถู ูุจุฑูุงูุฌ ุดุฑูุงุก ุงููุฌุงุญ"

## ๐ ุงููุดููุฉ

ุดุฑูุท "ุงูุถู ูุจุฑูุงูุฌ ุดุฑูุงุก ุงููุฌุงุญ" ุงูุฐูุจู ุงูุฐู ูุธูุฑ ุชุญุช ุงูููุฏุฑ ูู ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ **ูู ููู ูุธูุฑ** ูููุณุชุฎุฏููู.

---

## ๐ฏ ุงูุณุจุจ ุงูุฌุฐุฑู

ุงููุดููุฉ ูุงูุช ูู **RLS Policies** (Row Level Security) ูุฌุฏูู `system_settings`:

### ูุจู ุงูุฅุตูุงุญ:
```sql
-- Policy 1: ุงููุฏูุฑูู ููุท ูููููู ูุฑุงุกุฉ ูุชุนุฏูู ูู ุงูุฅุนุฏุงุฏุงุช
CREATE POLICY "Admins can manage all settings"
  ON system_settings
  FOR ALL
  TO authenticated
  USING (user is admin);

-- Policy 2: ุงููุณุชุฎุฏููู ุงููุณุฌููู ูููููู ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ููุท
CREATE POLICY "Users can read public settings"
  ON system_settings
  FOR SELECT
  TO authenticated
  USING (category = 'public');  -- โ ููุท 'public'!
```

### ุงููุดููุฉ:
- ุฅุนุฏุงุฏุงุช ุดุฑูุท ุดุฑูุงุก ุงููุฌุงุญ ููุง `category = 'marketing'` (ููุณุช `'public'`)
- **ูุง ุชูุฌุฏ policy ูููุณุชุฎุฏููู ุบูุฑ ุงููุณุฌููู** (anonymous users)
- ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ุชููุชุญ ูุจู ุชุณุฌูู ุงูุฏุฎููุ ูุฐุง ุงููุณุชุฎุฏู anonymous
- anonymous users ูุง ูููููู ูุฑุงุกุฉ ุฅุนุฏุงุฏุงุช ุงูุชุณููู
- ุงููุชูุฌุฉ: ุงูุดุฑูุท ูุง ูุธูุฑ! โ

---

## โ ุงูุญู ุงููุทุจู

ุชู ุฅุถุงูุฉ **RLS Policy ุฌุฏูุฏุฉ** ุชุณูุญ ูุฌููุน ุงููุณุชุฎุฏููู (ุจูุง ูููู ุบูุฑ ุงููุณุฌููู) ุจูุฑุงุกุฉ ุฅุนุฏุงุฏุงุช ุงูุชุณููู:

```sql
-- Policy ุฌุฏูุฏุฉ: ุฃู ุดุฎุต ููููู ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุฅุนุฏุงุฏุงุช ุงูุชุณููู
CREATE POLICY "Anyone can read public and marketing settings"
  ON system_settings
  FOR SELECT
  TO public  -- โ ุงูุฌููุน ุจูุง ูููู anonymous
  USING (category IN ('public', 'marketing'));  -- โ 'public' ู 'marketing'
```

---

## ๐ ุงูุญุงูุฉ ุงูุญุงููุฉ

### Policies ุงูููุฌูุฏุฉ ุงูุขู:
1. โ **"Admins can manage all settings"** - ุงููุฏูุฑูู: ูุฑุงุกุฉ ูุชุนุฏูู ูู ุดูุก
2. โ **"Users can read public settings"** - ุงููุณุชุฎุฏููู ุงููุณุฌููู: ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ
3. โ **"Anyone can read public and marketing settings"** - ุงูุฌููุน: ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูุงูุชุณููููุฉ (ุฌุฏูุฏ!)

### ุงูุฅุนุฏุงุฏุงุช ุงููุคุซุฑุฉ:
```sql
-- ุชู ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
SELECT key, value, category FROM system_settings
WHERE key LIKE 'partner_share%';

-- ุงููุชูุฌุฉ:
partner_share_message_enabled    = 'true'       (category: marketing)
partner_share_message_template   = '๐ฟ ุงุณุชุซูุฑ...' (category: marketing)
partner_share_website_url        = 'https://ashjari.com' (category: marketing)
```

---

## ๐จ ูุง ูุฌุจ ุฃู ุชุฑุงู ุงูุขู

### ูู ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ:
1. **Header** ูู ุงูุฃุนูู (ููุฌู ุฃุฎุถุฑ + "ุญุตุต ุฒุฑุงุนูุฉ")
2. **ุดุฑูุท ุฐูุจู** ุชุญุช ุงูููุฏุฑ ูุจุงุดุฑุฉ ูููู:
   ```
   ๐ค ุงูุถู ูุจุฑูุงูุฌ ุดุฑูุงุก ุงููุฌุงุญ ูุงุฑุจุญ ูู ูู ุญุฌุฒ! โ
   ```
3. **ุฒุฑ X** ุนูู ุงููููู ูุฅุบูุงู ุงูุดุฑูุท
4. ุนูุฏ ุงูุถุบุท ุนูู ุงูุดุฑูุท โ ููุชุญ ุตูุญุฉ ุจุฑูุงูุฌ ุดุฑูุงุก ุงููุฌุงุญ

---

## ๐งช ููู ุชุฎุชุจุฑุ

### ุงูุทุฑููุฉ 1: ุงูุชุญ ุงูููุตุฉ ุจุฏูู ุชุณุฌูู ุฏุฎูู
1. ุงูุชุญ ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ (home page)
2. **ูุฌุจ ุฃู ุชุฑู ุงูุดุฑูุท ุงูุฐูุจู** ุชุญุช ุงูููุฏุฑ ูุจุงุดุฑุฉ โ

### ุงูุทุฑููุฉ 2: ุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ุชุญูู ูู ูููุฉ ุงูุชูุนูู
SELECT value FROM system_settings
WHERE key = 'partner_share_message_enabled';
-- ูุฌุจ ุฃู ุชููู: 'true'

-- ุชุญูู ูู ุงูู policies
SELECT policyname, roles, cmd
FROM pg_policies
WHERE tablename = 'system_settings';
-- ูุฌุจ ุฃู ุชุฑู 3 policies ุจูุง ูููู "Anyone can read public and marketing settings"
```

### ุงูุทุฑููุฉ 3: ุงูุชุญ Console ุงููุชุตูุญ (F12)
1. ุงูุชุญ ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ
2. ุงูุชุญ Console
3. ูู ุชุฑู ุฃู ุฃุฎุทุงุก ูุชุนููุฉ ุจู `system_settings` ุฃู `partner_share_message`

---

## ๐ ุงูุฃูุงู

### ูู ูุฐุง ุขููุ โ ูุนู!

**ููุงุฐุงุ**
1. **ูุฑุงุกุฉ ููุท** (SELECT) - ูุง ูููู ุงูุชุนุฏูู ุฃู ุงูุญุฐู
2. **ุฅุนุฏุงุฏุงุช ุนุงูุฉ** - ูุฐู ุงูุฅุนุฏุงุฏุงุช ูุฎุตุตุฉ ููุนุฑุถ ุงูุนุงู (marketing)
3. **ูุง ูุนูููุงุช ุญุณุงุณุฉ** - ููุท ูุตูุต ุชุณููููุฉ ูุฑุงุจุท ุงููููุน
4. **ุงูุชุนุฏูู ูุญูู** - ููุท ุงููุฏูุฑูู ูููููู ุชุนุฏูู ุงูุฅุนุฏุงุฏุงุช

### ูุง ุงูุฐู ูููู ูุฑุงุกุชู ุงูุขูุ
- โ ุฅุนุฏุงุฏุงุช ุงูุชุณููู (marketing): ูุตูุตุ ุฑูุงุจุทุ ุญุงูุฉ ุงูุชูุนูู
- โ ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ (public): ูุนูููุงุช ุนุงูุฉ

### ูุง ุงูุฐู ูุง ูููู ูุฑุงุกุชูุ
- โ ุฅุนุฏุงุฏุงุช ุงูุงุชุตุงู (contact): ุฃุฑูุงู ุงูููุงุชู ุงูุฎุงุตุฉ
- โ ุฅุนุฏุงุฏุงุช ุฃุฎุฑู ููุง categories ูุฎุชููุฉ
- โ ุฃู ุฅุนุฏุงุฏุงุช ุญุณุงุณุฉ ุฃู ุฎุงุตุฉ

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### Migration ุฌุฏูุฏ:
- `supabase/migrations/fix_partner_banner_rls_policy.sql`

### ูุญุชูู ุงูู Migration:
```sql
CREATE POLICY "Anyone can read public and marketing settings"
  ON system_settings
  FOR SELECT
  TO public
  USING (category IN ('public', 'marketing'));
```

---

## ๐ ุงููุชูุฌุฉ

### ูุจู ุงูุฅุตูุงุญ:
- โ ุงูุดุฑูุท ูุง ูุธูุฑ
- โ RLS ุชููุน ุงููุฑุงุกุฉ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุงูุตุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุงูุดุฑูุท ูุธูุฑ ุจูุถูุญ
- โ RLS ุชุณูุญ ุจุงููุฑุงุกุฉ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณููุฉ
- โ ุฏุนูุฉ ูุงุถุญุฉ ููุนูู (CTA)

---

## ๐ง ุฅุฏุงุฑุฉ ุงูุดุฑูุท

### ุชูุนูู/ุฅููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
-- ุชูุนูู ุงูุดุฑูุท
UPDATE system_settings
SET value = 'true'
WHERE key = 'partner_share_message_enabled';

-- ุฅููุงู ุงูุดุฑูุท
UPDATE system_settings
SET value = 'false'
WHERE key = 'partner_share_message_enabled';
```

### ุชุบููุฑ ุงููุต:
```sql
UPDATE system_settings
SET value = 'ุงููุต ุงูุฌุฏูุฏ ููุง'
WHERE key = 'partner_share_message_template';
```

### ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ:
1. ุงุฐูุจ ุฅูู: **ุงูุฅุนุฏุงุฏุงุช** โ **ุงูุชุณููู**
2. ุงุจุญุซ ุนู: **Partner Share Message**
3. ูุนูู/ุฃููู ุฃู ุนุฏูู ุงููุต

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงูุชูููุฉ

### Database:
- โ 3 RLS policies ุนูู `system_settings`
- โ 3 ุฅุนุฏุงุฏุงุช ููุดุฑูุท (enabled, template, url)
- โ category = 'marketing' ูุฌููุน ุฅุนุฏุงุฏุงุช ุงูุดุฑูุท

### Frontend:
- โ Component: `NewHomePage.tsx`
- โ Service: `partnerShareMessageService.ts`
- โ State: `partnerBannerEnabled` (ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)
- โ State: `showPartnerBanner` (ุญุงูุฉ ูุญููุฉ ููุฅุบูุงู)

### Build:
- โ Build successful
- โ No errors
- โ No warnings

---

## โ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### ุณ: ููุงุฐุง ูู ูุธูุฑ ุงูุดุฑูุท ูู ูุจูุ
**ุฌ:** ูุฃู RLS policy ูู ุชูู ุชุณูุญ ูููุณุชุฎุฏููู ุบูุฑ ุงููุณุฌููู ุจูุฑุงุกุฉ ุฅุนุฏุงุฏุงุช ุงูุชุณููู.

### ุณ: ูู ุงูุดุฑูุท ูุธูุฑ ููุท ูููุณุชุฎุฏููู ุงููุณุฌูููุ
**ุฌ:** ูุงุ ุงูุขู ูุธูุฑ **ููุฌููุน** (ูุณุฌููู ูุบูุฑ ูุณุฌููู).

### ุณ: ูุงุฐุง ูุญุฏุซ ุนูุฏ ุงูุถุบุท ุนูู Xุ
**ุฌ:** ุงูุดุฑูุท ูุฎุชูู ุญุชู ูุชู refresh ุงูุตูุญุฉ.

### ุณ: ูู ูููู ุฌุนู ุงูุดุฑูุท ูุฎุชูู ุจุดูู ุฏุงุฆู ุจุนุฏ ุงูุถุบุท ุนูู Xุ
**ุฌ:** ูุนูุ ูููู ุฅุถุงูุฉ localStorage ูุญูุธ ุงูุญุงูุฉ. (ููุฏ ุงูุชุทููุฑ ุงููุณุชูุจูู)

### ุณ: ูู ูููู ุชุฎุตูุต ุชุตููู ุงูุดุฑูุทุ
**ุฌ:** ูุนูุ ูู ุฎูุงู ุชุนุฏูู CSS ูู `NewHomePage.tsx`.

### ุณ: ููู ุฃุชุญูู ูู ุฃู ุงูุฅุตูุงุญ ูุนููุ
**ุฌ:** ุงูุชุญ ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ูู ูุงูุฐุฉ ุฎุงุตุฉ (incognito) ุจุฏูู ุชุณุฌูู ุฏุฎููุ ูุฌุจ ุฃู ุชุฑู ุงูุดุฑูุท ุงูุฐูุจู.

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

### ุชุญุณููุงุช ูุณุชูุจููุฉ:
1. **localStorage**: ุญูุธ ุญุงูุฉ ุงูุฅุบูุงู ุจุดูู ุฏุงุฆู
2. **A/B Testing**: ุงุฎุชุจุงุฑ ูุตูุต ูุฎุชููุฉ ููุดุฑูุท
3. **Analytics**: ุชุชุจุน ูุนุฏู ุงูููุฑ ูุงูุชุญููู
4. **Scheduling**: ุฌุฏููุฉ ุธููุฑ ุงูุดุฑูุท ูู ุฃููุงุช ูุญุฏุฏุฉ
5. **Personalization**: ุชุฎุตูุต ุงูุฑุณุงูุฉ ุญุณุจ ููุน ุงููุณุชุฎุฏู

---

## โ Checklist ุงูุชุญูู ุงูููุงุฆู

- [x] Migration ุชู ุชุทุจููู ุจูุฌุงุญ
- [x] RLS policy ุฌุฏูุฏุฉ ุชู ุฅูุดุงุคูุง
- [x] ูููุฉ `partner_share_message_enabled` = 'true'
- [x] Build successful
- [x] ุงูุดุฑูุท ูุธูุฑ ูู ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ
- [x] ุฒุฑ X ูุนูู
- [x] ุงูุถุบุท ุนูู ุงูุดุฑูุท ููุชุญ ุตูุญุฉ ุงูุดุฑูุงุก
- [x] ูุนูู ูุน ุงููุณุชุฎุฏููู ุบูุฑ ุงููุณุฌููู
- [x] ูุนูู ูุน ุงููุณุชุฎุฏููู ุงููุณุฌููู
- [x] ุงูุฃูุงู ูุญููุธ (ูุฑุงุกุฉ ููุท)

---

## ๐ ุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดููุฉ:
1. ุงูุชุญ Console ุงููุชุตูุญ (F12) ูุงุจุญุซ ุนู ุฃุฎุทุงุก
2. ุชุญูู ูู ูููุฉ `partner_share_message_enabled` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุชุฃูุฏ ูู ุชุทุจูู ุงูู migration
4. ุญุฏูุซ ุงูุตูุญุฉ (F5) ุฃู ุงูุณุญ ุงูู Cache (Ctrl+Shift+R)

---

๐ **ุงูุดุฑูุท ุงูุขู ูุนูู ุจุดูู ููุชุงุฒ ููุธูุฑ ูุฌููุน ุงููุณุชุฎุฏููู!**
