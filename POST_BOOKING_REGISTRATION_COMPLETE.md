# ุฑุญูุฉ ูุง ุจุนุฏ ุงูุญุฌุฒ ุญุชู ุฅูุดุงุก ุงูุญุณุงุจ - ุงูุชูู โ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูููุฐ ุฑุญูุฉ ูุงููุฉ ูุญุฌุฒ ุงูุงุณุชุซูุงุฑ ูู ูุญุธุฉ ุงูุถุบุท ุนูู "ุงุณุชุซูุฑ ุงูุขู" ุญุชู ุฅูุดุงุก ุญุณุงุจ ุงููุณุชุซูุฑ ูุฑุจุท ุงูุญุฌุฒ ุจุงูุญุณุงุจ.

---

## ๐ฏ ุงููุฏู ุงููุญูู

ุฑุจุท ุงูุญุฌุฒ ุงููุคูุช ุจุญุณุงุจ ุงููุณุชุซูุฑ **ุจุฏูู ุฏูุน** ู**ุจุฏูู ูุฑุงุญู ุฅุถุงููุฉ**.

ุงูุชุทููุฑ ูุชููู ููุง ูุคูุชุงู ููุง ูู ูุทููุจ.

---

## ๐ ุงูุชุฏูู ุงููุงูู (ูู ุงูุจุฏุงูุฉ ููููุงูุฉ)

### ุงููุฑุญูุฉ 1๏ธโฃ: ุงุฎุชูุงุฑ ูุญุฌุฒ ุงูุงุณุชุซูุงุฑ

#### ุงูุฎุทูุฉ 1: ุงุฎุชูุงุฑ ุงูุจุงูุฉ ูุงูุฃุดุฌุงุฑ
```
ุงููุณุชุฎุฏู ูู InvestmentFarmPage:
  1. ูุฎุชุงุฑ ุจุงูุฉ ุงุณุชุซูุงุฑ
  2. ูุญุฏุฏ ุนุฏุฏ ุงูุฃุดุฌุงุฑ
  3. ูุฑุงุฌุน ุงูุฅุฌูุงูู
  4. ูุถุบุท "ุงุณุชุซูุฑ ุงูุขู"
```

#### ุงูุฎุทูุฉ 2: ุฅูุดุงุก ุงูุญุฌุฒ ุงููุคูุช
```typescript
handleInvestNow() {
  - ุฅูุดุงุก guest_id (ูุนุฑู ูุคูุช)
  - ุฅูุดุงุก reservation ุจุญุงูุฉ 'temporary'
  - ุฑุจุท ุงูุญุฌุฒ ุจู guest_id
  - ุชุนููู ููุช ุงูุชูุงุก (24 ุณุงุนุฉ)
  - ุญูุธ ุชูุงุตูู ุงูุนูุฏ ูุงูุฃุดุฌุงุฑ
}
```

**ุงูุจูุงูุงุช ุงููุญููุธุฉ:**
```sql
INSERT INTO reservations (
  guest_id,           -- ูุนุฑู ุงูุฒุงุฆุฑ ุงููุคูุช
  farm_id,            -- ุฑูู ุงููุฒุฑุนุฉ
  farm_name,          -- ุงุณู ุงููุฒุฑุนุฉ
  contract_id,        -- ูุนุฑู ุงูุนูุฏ
  contract_name,      -- ุงุณู ุงูุนูุฏ
  duration_years,     -- ูุฏุฉ ุงูุงุณุชุซูุงุฑ
  bonus_years,        -- ุงูุณููุงุช ุงููุฌุงููุฉ
  total_trees,        -- ุนุฏุฏ ุงูุฃุดุฌุงุฑ
  total_price,        -- ุงูุณุนุฑ ุงูุฅุฌูุงูู
  status,             -- 'temporary'
  temporary_expires_at -- ุจุนุฏ 24 ุณุงุนุฉ
)
```

---

### ุงููุฑุญูุฉ 2๏ธโฃ: ุดุงุดุฉ ูุฌุงุญ ุงูุญุฌุฒ

ุชุธูุฑ ุดุงุดุฉ `BookingSuccessScreen` ุชุญุชูู ุนูู:

#### ุงููุณู ุงูุฃูู: ุฑุณุงูุฉ ุงููุฌุงุญ
```
๐ ุชู ุชุซุจูุช ุญุฌุฒ ูุฒุฑุนุชู ุงูุงุณุชุซูุงุฑูุฉ ุจูุฌุงุญ
```
- ุฃููููุฉ checkmark ูุชุญุฑูุฉ
- ุฑุณุงูุฉ ูุงุถุญุฉ
- ุชุฃููุฏ ุฃู ุงูุญุฌุฒ ูุญููุธ

#### ุงููุณู ุงูุซุงูู: ุจุทุงูุฉ ุชูุงุตูู ุงูุญุฌุฒ
```
โข ุงููุฒุฑุนุฉ: [ุงุณู ุงููุฒุฑุนุฉ]
โข ุงูุนูุฏ: [ุงุณู ุงูุนูุฏ]
โข ุนุฏุฏ ุงูุฃุดุฌุงุฑ: XX ุดุฌุฑุฉ
โข ูุฏุฉ ุงูุงุณุชุซูุงุฑ: X ุณููุงุช (+Y ูุฌุงูู)
โข ุงูุฅุฌูุงูู: XXX,XXX ุฑ.ุณ
```

#### ุงููุณู ุงูุซุงูุซ: ุงูุดูุงุฏุฉ ุงููุคูุชุฉ
```
๐ ุดูุงุฏุฉ ุงุณุชุซูุงุฑ ูุคูุชุฉ

[ุนุฑุถ ุงูุดูุงุฏุฉ]

โ ุนุฑุถ ููุท ุฏุงุฎู ุงูุชุทุจูู โข ูุง ุชุญููู โข ูุง ุทุจุงุนุฉ
```

**ุฒุฑ ุนุฑุถ ุงูุดูุงุฏุฉ:**
- ููุชุญ ุดุงุดุฉ ูุงููุฉ ุชุนุฑุถ ุงูุดูุงุฏุฉ
- ุชุตููู ุงุญุชุฑุงูู ุจุฃููุงู ุฐูุจูุฉ
- ุนูููุง ููุงุญุธุฉ: "ุดูุงุฏุฉ ูุคูุชุฉ - ุญุฌุฒ ุบูุฑ ูุฏููุน"

---

### ุงููุฑุญูุฉ 3๏ธโฃ: ุงูุดูุงุฏุฉ ุงููุคูุชุฉ

ุงููููู: `TemporaryCertificate.tsx`

#### ูุญุชูู ุงูุดูุงุฏุฉ:

**ุงูุนููุงู:**
```
๐ ุดูุงุฏุฉ ุงุณุชุซูุงุฑ ูุคูุชุฉ
ุดูุงุฏุฉ ุญุฌุฒ ุงุณุชุซูุงุฑู
๐ก ุญุฌุฒ ุบูุฑ ูุฏููุน
```

**ุงูุชูุงุตูู:**
- ุงููุฒุฑุนุฉ
- ุนุฏุฏ ุงูุฃุดุฌุงุฑ (ุจุงูุฃุฎุถุฑ)
- ูุฏุฉ ุงูุงุณุชุซูุงุฑ (ุจุงูุฃุฒุฑู)
- ุงูุณููุงุช ุงููุฌุงููุฉ (ุฅู ููุฌุฏุช)
- ุชุงุฑูุฎ ุงูุญุฌุฒ
- ุฑูู ุงูุญุฌุฒ (8 ุฃุญุฑู ูู ุงูู UUID)

**ุงูุชุญุฐูุฑ:**
```
โ ูุฐู ุดูุงุฏุฉ ูุคูุชุฉ ุบูุฑ ูุงุจูุฉ ููุทุจุงุนุฉ ุฃู ุงูุชุญููู.
ุณูุชู ุฅุตุฏุงุฑ ุดูุงุฏุฉ ุฑุณููุฉ ุจุนุฏ ุฅุชูุงู ุงูุชุณุฌูู ูุงูุณุฏุงุฏ.
```

**ุงูุชุตููู:**
- ุฅุทุงุฑ ุฐูุจู ุนุฑูุถ
- ุฎุทูุท ุฐูุจูุฉ ูู ุงูุฃุนูู ูุงูุฃุณูู
- ุฎูููุฉ ูุชุฏุฑุฌุฉ (amber/yellow/orange)
- ุฃููููุฉ ุฌุงุฆุฒุฉ ูุจูุฑุฉ
- ุชุตููู ุงุญุชุฑุงูู ูููู ุจุดูุงุฏุฉ

---

### ุงููุฑุญูุฉ 4๏ธโฃ: ุฏุนูุฉ ูุฅูุดุงุก ุงูุญุณุงุจ

ุจุนุฏ ุนุฑุถ ุชูุงุตูู ุงูุญุฌุฒ ูุงูุดูุงุฏุฉุ ุชุธูุฑ ุฑุณุงูุฉ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ุญุชู ุชุถู ูุฒุฑุนุชู ุฅูู ุญุณุงุจู             โ
โ  ุจูู ุนููู ุฅูุดุงุก ุญุณุงุจ ุงููุณุชุซูุฑ          โ
โ                                         โ
โ  [โ ุฅูุดุงุก ุญุณุงุจ ุงููุณุชุซูุฑ]               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุฒุฑ ุฅูุดุงุก ุงูุญุณุงุจ:**
- ุจููุณุฌู/ูุฑุฏู (ููุชูููุฒ)
- ูุจูุฑ ููุงุถุญ
- ูููู ูุจุงุดุฑุฉ ููููุฐุฌ ุงูุชุณุฌูู

---

### ุงููุฑุญูุฉ 5๏ธโฃ: ูููุฐุฌ ุงูุชุณุฌูู

ุงููููู: `InvestorRegistrationForm.tsx`

#### ุงูุญููู ุงููุทููุจุฉ:

**1. ุงูุงุณู ุงููุงูู**
```
๐ค [ุฃุฏุฎู ุงุณูู ุงููุงูู]
```
- 3 ุฃุญุฑู ุนูู ุงูุฃูู
- ูุทููุจ

**2. ุฑูู ุงูุฌูุงู**
```
๐ฑ [05xxxxxxxx]
```
- ูุฌุจ ุฃู ูุจุฏุฃ ุจู 05 ุฃู 5
- 10 ุฃุฑูุงู
- ูุซุงู: 0512345678
- ุณููุณุชุฎุฏู ูู email: `phoneNumber@investor.harvest.local`

**3. ูููุฉ ุงููุฑูุฑ**
```
๐ [ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ]
```
- 8 ุฃุญุฑู ุนูู ุงูุฃูู
- ูุทููุจุฉ

**4. ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ**
```
๐ [ุฃุนุฏ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ]
```
- ูุฌุจ ุฃู ุชุทุงุจู ูููุฉ ุงููุฑูุฑ

#### ุงูุชุญูู ูุงูุฃุฎุทุงุก:

**ุงูุฃุฎุทุงุก ุงูููููุฉ:**
- "ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู ุงููุงูู"
- "ุงูุงุณู ูุฌุจ ุฃู ูููู 3 ุฃุญุฑู ุนูู ุงูุฃูู"
- "ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุฌูุงู"
- "ุฑูู ุงูุฌูุงู ุบูุฑ ุตุญูุญ"
- "ูุฑุฌู ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ"
- "ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 8 ุฃุญุฑู ุนูู ุงูุฃูู"
- "ูููุฉ ุงููุฑูุฑ ุบูุฑ ูุชุทุงุจูุฉ"
- "ุฑูู ุงูุฌูุงู ูุณุฌู ูุณุจูุงู"

#### ุฒุฑ ุงูุชุณุฌูู:
```
โ ุชุณุฌูู ุงูุญุณุงุจ
```
- ุฐูุจู ูุชุฏุฑุฌ
- ูุชุญูู ูู "ุฌุงุฑู ุงูุชุณุฌูู..." ุนูุฏ ุงูุถุบุท
- spinner ุฃุซูุงุก ุงููุนุงูุฌุฉ

---

### ุงููุฑุญูุฉ 6๏ธโฃ: ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ

**ุฑุงุจุท ุฃุณูู ุงููููุฐุฌ:**
```
ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ
```

**ุนูุฏ ุงูุถุบุท:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โน ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ                โ
โ                                        โ
โ  ุณูุชู ุชูุนูู ูุธุงู ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ โ
โ  ุนุจุฑ ุฑุณุงุฆู SMS ูุฑูุจุงู.                โ
โ                                        โ
โ  ุญุงููุงูุ ูุฑุฌู ุงูุชูุงุตู ูุน ุงูุฏุนู ุงูููู โ
โ  ูููุณุงุนุฏุฉ.                            โ
โ                                        โ
โ  [ุฑุฌูุน]                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูููุงุญุธุฉ:**
- ุงููุธุงู ููุฌููุฒ ููู SMS
- ููู ูุง ุชูุนูู ูุนูู ุงูุขู
- ููุท ุชุฌููุฒ ุงูุจููุฉ ุงูุชุญุชูุฉ

---

### ุงููุฑุญูุฉ 7๏ธโฃ: ูุง ุจุนุฏ ุงูุชุณุฌูู

#### ุนูุฏ ูุฌุงุญ ุงูุชุณุฌูู:

**1. ุฅูุดุงุก ุงููุณุชุฎุฏู ูู Supabase Auth:**
```typescript
supabase.auth.signUp({
  email: `${phoneNumber}@investor.harvest.local`,
  password: formData.password,
  options: {
    data: {
      full_name: formData.fullName,
      phone_number: phoneNumber,
      user_type: 'investor'
    }
  }
})
```

**2. ุฑุจุท ุงูุญุฌุฒ ุจุงููุณุชุฎุฏู:**
```typescript
handleRegistrationComplete(userId) {
  // ุชุญุฏูุซ ุงูุญุฌุฒ
  UPDATE reservations
  SET
    user_id = userId,      -- ุฑุจุท ุจุงููุณุชุฎุฏู
    guest_id = NULL,       -- ุฅุฒุงูุฉ ุงููุนุฑู ุงููุคูุช
    status = 'pending'     -- ุชุบููุฑ ุงูุญุงูุฉ
  WHERE id = reservation_id
  AND guest_id = guestId
}
```

**3. ุชูุธูู ุงูุจูุงูุงุช ุงููุคูุชุฉ:**
```typescript
localStorage.removeItem('guestId')
```

**4. ุฅุดุนุงุฑ ุงููุณุชุฎุฏู:**
```
โ ุชู ุฑุจุท ุงูุญุฌุฒ ุจุญุณุงุจู ุจูุฌุงุญ!
ุณูุชู ูุฑุงุฌุนุฉ ุญุฌุฒู ูู ูุจู ุงูุฅุฏุงุฑุฉ.
```

**5. ุงูุฅุบูุงู:**
- ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
- ุงููุณุชุฎุฏู ุงูุขู ูุณุฌู ููุตุงุฏู
- ุงูุญุฌุฒ ูุฑุจูุท ุจุญุณุงุจู

---

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุชุบููุฑุงุช ุนูู ุฌุฏูู reservations:

#### ุงูุญููู ุงูุฌุฏูุฏุฉ:
```sql
guest_id              text                -- ูุนุฑู ุงูุฒุงุฆุฑ ุงููุคูุช
contract_id           uuid                -- ูุนุฑู ุงูุนูุฏ
contract_name         text                -- ุงุณู ุงูุนูุฏ
duration_years        integer             -- ูุฏุฉ ุงูุงุณุชุซูุงุฑ
bonus_years           integer             -- ุงูุณููุงุช ุงููุฌุงููุฉ
temporary_expires_at  timestamptz         -- ููุช ุงูุชูุงุก ุงูุญุฌุฒ ุงููุคูุช
```

#### ุงูุชุนุฏููุงุช:
```sql
user_id nullable                           -- ูููู ุฃู ูููู NULL ููุญุฌูุฒุงุช ุงููุคูุชุฉ
status: 'temporary' added                  -- ุญุงูุฉ ุฌุฏูุฏุฉ ููุญุฌูุฒุงุช ุงููุคูุชุฉ
```

#### ุงููููุฏ ุงูุฌุฏูุฏุฉ:
```sql
CHECK (user_id IS NOT NULL OR guest_id IS NOT NULL)
-- ูุฌุจ ุฃู ูููู ุฃุญุฏููุง ููุฌูุฏ
```

### ุญุงูุงุช ุงูุญุฌุฒ:

```
temporary             โ ุญุฌุฒ ูุคูุช ูุจู ุงูุชุณุฌูู (ุฌุฏูุฏ)
pending               โ ุจุนุฏ ุงูุชุณุฌููุ ุจุงูุชุธุงุฑ ุงุนุชูุงุฏ ุงูุฅุฏุงุฑุฉ
waiting_for_payment   โ ูุนุชูุฏุ ุจุงูุชุธุงุฑ ุงูุณุฏุงุฏ (ูุณุชูุจูุงู)
payment_submitted     โ ุชู ุฑูุน ุงูุฅูุตุงู (ูุณุชูุจูุงู)
paid                  โ ุณุฏุงุฏ ูุนุชูุฏ (ูุณุชูุจูุงู)
transferred_to_harvest โ ูู ูุญุตููู (ูุณุชูุจูุงู)
cancelled             โ ููุบู
```

### ุณูุงุณุงุช RLS ุงูุฌุฏูุฏุฉ:

#### ููุญุฌูุฒุงุช ุงููุคูุชุฉ:
```sql
-- ุงูุณูุงุญ ุจุฅูุดุงุก ุญุฌุฒ ูุคูุช ุจุฏูู ุชุณุฌูู
CREATE POLICY "Anyone can create temporary reservations"
  ON reservations FOR INSERT
  WITH CHECK (status = 'temporary' AND user_id IS NULL AND guest_id IS NOT NULL);

-- ุงูุณูุงุญ ุจุนุฑุถ ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ
CREATE POLICY "Guests can view their temporary reservations"
  ON reservations FOR SELECT
  TO anon
  USING (guest_id IS NOT NULL AND status = 'temporary');

-- ุงูุณูุงุญ ุจุฑุจุท ุงูุญุฌุฒ ุจุงููุณุชุฎุฏู ุจุนุฏ ุงูุชุณุฌูู
CREATE POLICY "Link temporary reservation to user after registration"
  ON reservations FOR UPDATE
  TO authenticated
  USING (guest_id IS NOT NULL AND status = 'temporary' AND user_id IS NULL)
  WITH CHECK (auth.uid() = user_id AND status = 'pending');
```

### ูุธููุฉ ุงูุชูุธูู:
```sql
CREATE FUNCTION cleanup_expired_temporary_reservations()
-- ุชูุบู ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ ุจุนุฏ 24 ุณุงุนุฉ
```

---

## ๐งฉ ุงูููููุงุช ุงูุฌุฏูุฏุฉ

### 1. BookingSuccessScreen.tsx
**ุงููุธููุฉ:** ุดุงุดุฉ ูุฌุงุญ ุงูุญุฌุฒ ุงูุฑุฆูุณูุฉ

**ุงูุฃูุณุงู:**
- ุนุฑุถ ุชูุงุตูู ุงูุญุฌุฒ
- ุฒุฑ ุนุฑุถ ุงูุดูุงุฏุฉ
- ุฏุนูุฉ ูุฅูุดุงุก ุงูุญุณุงุจ
- ูููุฐุฌ ุงูุชุณุฌูู (ุนูุฏ ุงูุทูุจ)

**Props:**
```typescript
{
  reservation: {
    id, farmName, treeCount, durationYears,
    bonusYears, totalPrice, contractName, createdAt
  },
  guestId: string,
  onRegistrationComplete: (userId) => void,
  onClose?: () => void
}
```

**ุงูุญุงูุงุช:**
```typescript
[showCertificate]     -- ุนุฑุถ ุงูุดูุงุฏุฉ
[showRegistration]    -- ุนุฑุถ ูููุฐุฌ ุงูุชุณุฌูู
```

---

### 2. TemporaryCertificate.tsx
**ุงููุธููุฉ:** ุนุฑุถ ุงูุดูุงุฏุฉ ุงููุคูุชุฉ

**ุงููุญุชูู:**
- ูุนูููุงุช ุงูุงุณุชุซูุงุฑ ูุงููุฉ
- ุชุตููู ุงุญุชุฑุงูู ุจุฃููุงู ุฐูุจูุฉ
- ุชุญุฐูุฑ ุนุฏู ุงูุทุจุงุนุฉ/ุงูุชุญููู
- ุฑูู ุงูุญุฌุฒ

**Props:**
```typescript
{
  farmName: string,
  treeCount: number,
  durationYears: number,
  bonusYears: number,
  reservationId: string,
  createdAt: string
}
```

**ุงูููุฒุงุช:**
- ุบูุฑ ูุงุจูุฉ ููุทุจุงุนุฉ
- ุนุฑุถ ููุท
- ุฏุงุฎู ุงูุชุทุจูู
- ุชุตููู ุงุญุชุฑุงูู

---

### 3. InvestorRegistrationForm.tsx
**ุงููุธููุฉ:** ูููุฐุฌ ุชุณุฌูู ุงููุณุชุซูุฑ

**ุงูุญููู:**
- ุงูุงุณู ุงููุงูู
- ุฑูู ุงูุฌูุงู
- ูููุฉ ุงููุฑูุฑ
- ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ

**Props:**
```typescript
{
  guestId: string,
  onSuccess: (userId) => void,
  onCancel?: () => void
}
```

**ุงูุชุญูู:**
- ุงูุชุญูู ูู ุงูุญููู
- ุงูุชุญูู ูู ุฑูู ุงูุฌูุงู (05xxxxxxxx)
- ุงูุชุญูู ูู ุชุทุงุจู ูููุงุช ุงููุฑูุฑ
- ุงูุชุญูู ูู ุทูู ูููุฉ ุงููุฑูุฑ (8+)

**ุงูููุฒุงุช:**
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- ุญุงูุฉ ุชุญููู
- ุฑุงุจุท ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ
- ุฅูุดุงุก email ูุฎุตุต: `phone@investor.harvest.local`

---

### 4. ุงูุชุญุฏูุซุงุช ุนูู InvestmentFarmPage.tsx

#### State ุฌุฏูุฏ:
```typescript
[isCreatingReservation] -- ุญุงูุฉ ุฅูุดุงุก ุงูุญุฌุฒ
[reservationData]       -- ุจูุงูุงุช ุงูุญุฌุฒ ุงููุคูุช
[guestId]               -- ูุนุฑู ุงูุฒุงุฆุฑ
```

#### ุฏูุงู ุฌุฏูุฏุฉ:
```typescript
handleInvestNow()              -- ุฅูุดุงุก ุงูุญุฌุฒ ุงููุคูุช
handleRegistrationComplete()   -- ุฑุจุท ุงูุญุฌุฒ ุจุนุฏ ุงูุชุณุฌูู
```

#### ุงูุชุฏูู:
```
[ุงุณุชุซูุฑ ุงูุขู]
  โ handleInvestNow()
    โ ุฅูุดุงุก ุงูุญุฌุฒ ุงููุคูุช
      โ setReservationData()
        โ ุนุฑุถ BookingSuccessScreen
          โ ุงูุชุณุฌูู
            โ handleRegistrationComplete()
              โ ุฑุจุท ุงูุญุฌุฒ
                โ onClose()
```

---

## ๐ ูุธุงู ุงููุตุงุฏูุฉ

### ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุงููุฎุตุต:
```typescript
email = `${phoneNumber}@investor.harvest.local`
```

**ูุซุงู:**
```
ุฑูู ุงูุฌูุงู: 0512345678
Email: 0512345678@investor.harvest.local
```

### ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุฅุถุงููุฉ:
```typescript
user_metadata: {
  full_name: "ูุญูุฏ ุฃุญูุฏ",
  phone_number: "0512345678",
  user_type: "investor"
}
```

### ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก:
- ุฑูู ูุณุฌู ูุณุจูุงู โ "ุฑูู ุงูุฌูุงู ูุณุฌู ูุณุจูุงู"
- ุฎุทุฃ ุนุงู โ "ุญุฏุซ ุฎุทุฃ ูู ุงูุชุณุฌูู"

---

## ๐ ุงูุชุฏูู ุงููุฑุฆู ุงููุงูู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 InvestmentFarmPage                          โ
โ                                                             โ
โ  1. ุงุฎุชูุงุฑ ุงูุจุงูุฉ: [ุณูุฉ ูุงุญุฏุฉ] [ุณูุชุงู] [3 ุณููุงุช]         โ
โ  2. ุงุฎุชูุงุฑ ุงูุฃุดุฌุงุฑ: [โโโโโโโโโ] 50 ุดุฌุฑุฉ                    โ
โ  3. ุงูุฅุฌูุงูู: 50,000 ุฑ.ุณ                                   โ
โ                                                             โ
โ               [๐ฐ ุงุณุชุซูุฑ ุงูุขู]                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                [ุฅูุดุงุก ุญุฌุฒ ูุคูุช]
                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            BookingSuccessScreen                             โ
โ                                                             โ
โ  ๐ ุชู ุชุซุจูุช ุญุฌุฒ ูุฒุฑุนุชู ุงูุงุณุชุซูุงุฑูุฉ ุจูุฌุงุญ                โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ  โ ุชูุงุตูู ุงูุญุฌุฒ                               โ            โ
โ  โ โข ุงููุฒุฑุนุฉ: ูุฒุฑุนุฉ ุงูุฒูุชูู                  โ            โ
โ  โ โข ุนุฏุฏ ุงูุฃุดุฌุงุฑ: 50 ุดุฌุฑุฉ                    โ            โ
โ  โ โข ุงููุฏุฉ: 2 ุณููุงุช +1 ูุฌุงูู                 โ            โ
โ  โ โข ุงูุฅุฌูุงูู: 50,000 ุฑ.ุณ                    โ            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ  โ ๐ ุดูุงุฏุฉ ุงุณุชุซูุงุฑ ูุคูุชุฉ                    โ            โ
โ  โ        [ุนุฑุถ ุงูุดูุงุฏุฉ]                       โ            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ
โ                                                             โ
โ  ุญุชู ุชุถู ูุฒุฑุนุชู ุฅูู ุญุณุงุจู                                 โ
โ  ุจูู ุนููู ุฅูุดุงุก ุญุณุงุจ ุงููุณุชุซูุฑ                             โ
โ                                                             โ
โ         [โ ุฅูุดุงุก ุญุณุงุจ ุงููุณุชุซูุฑ]                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
              [ุงูุถุบุท ุนูู ุฅูุดุงุก ุญุณุงุจ]
                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         InvestorRegistrationForm                            โ
โ                                                             โ
โ  ๐ค [ุงูุงุณู ุงููุงูู_______________]                          โ
โ  ๐ฑ [ุฑูู ุงูุฌูุงู________________]                          โ
โ  ๐ [ูููุฉ ุงููุฑูุฑ_______________]                          โ
โ  ๐ [ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ_________]                          โ
โ                                                             โ
โ           [โ ุชุณุฌูู ุงูุญุณุงุจ]                                 โ
โ                                                             โ
โ       [ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ]                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                  [ุงูุชุณุฌูู ุจูุฌุงุญ]
                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ ุชู ุฑุจุท ุงูุญุฌุฒ ุจุญุณุงุจู ุจูุฌุงุญ!                             โ
โ  ุณูุชู ูุฑุงุฌุนุฉ ุญุฌุฒู ูู ูุจู ุงูุฅุฏุงุฑุฉ.                         โ
โ                                                             โ
โ  ุงูุญุฌุฒ ุงูุขู ูู ุญุงูุฉ: pending                               โ
โ  ูุฑุชุจุท ุจู: user_id (ุงูุญุณุงุจ ุงูุฌุฏูุฏ)                        โ
โ  guest_id: ุชู ุฅุฒุงูุชู                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          โ
                [ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ]
                          โ
              โ ุงูุฑุญูุฉ ููุชููุฉ
         ุงูุชุทููุฑ ูุชููู ููุง ูุคูุชุงู
```

---

## โก ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1. ุงูุญุฌุฒ ุจุฏูู ุชุณุฌูู
โ ูููู ููุฒุงุฆุฑ ุญุฌุฒ ุงูุงุณุชุซูุงุฑ ูุจู ุฅูุดุงุก ุญุณุงุจ
โ ุงูุญุฌุฒ ููุญูุธ ูููุฑุจุท ุจูุนุฑู ูุคูุช (guest_id)
โ ุตูุงุญูุฉ ุงูุญุฌุฒ ุงููุคูุช 24 ุณุงุนุฉ

### 2. ุงูุดูุงุฏุฉ ุงููุคูุชุฉ
โ ุดูุงุฏุฉ ุงุญุชุฑุงููุฉ ูุน ุฌููุน ุงูุชูุงุตูู
โ ุนุฑุถ ููุท (ูุง ุชุญูููุ ูุง ุทุจุงุนุฉ)
โ ููุงุญุธุฉ ูุงุถุญุฉ: "ูุคูุชุฉ - ุบูุฑ ูุฏููุน"

### 3. ุงูุชุณุฌูู ุงูุณูุณ
โ ูููุฐุฌ ุจุณูุท (3 ุญููู + ุชุฃููุฏ)
โ ุงูุชุญูู ุงูุฐูู ูู ุงูุจูุงูุงุช
โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
โ ุงุณุชุฎุฏุงู ุฑูู ุงูุฌูุงู ููุนุฑู

### 4. ุงูุฑุจุท ุงูุชููุงุฆู
โ ุจุนุฏ ุงูุชุณุฌููุ ุงูุญุฌุฒ ููุฑุจุท ุชููุงุฆูุงู
โ ุชุญุฏูุซ ุงูุญุงูุฉ ูู 'temporary' ุฅูู 'pending'
โ ุฅุฒุงูุฉ guest_id ูุฅุถุงูุฉ user_id

### 5. ุงูุฃูุงู
โ RLS policies ูุญููุฉ
โ ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ ูุญููุฉ
โ ูุง ูููู ุชุนุฏูู ุญุฌุฒ ุดุฎุต ุขุฎุฑ
โ ุงูุชูุธูู ุงูุชููุงุฆู ููุญุฌูุฒุงุช ุงูููุชููุฉ

---

## ๐ ููุทุฉ ุงูุชููู

### ูุง ุชู ุฅูุฌุงุฒู:
โ ุงูุญุฌุฒ ุงููุคูุช ุจุฏูู ุชุณุฌูู
โ ุดุงุดุฉ ูุฌุงุญ ุงูุญุฌุฒ
โ ุงูุดูุงุฏุฉ ุงููุคูุชุฉ
โ ูููุฐุฌ ุชุณุฌูู ุงููุณุชุซูุฑ
โ ุฑุจุท ุงูุญุฌุฒ ุจุงูุญุณุงุจ
โ ุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ (ููุฌููุฒ)

### ูุง ูู ูุชู ุชูููุฐู (ููุง ูู ูุทููุจ):
โ ูุธุงู ุงูุฏูุน
โ ุชุญููู ุงูุญุงูุฉ ุฅูู waiting_for_payment
โ ุฑูุน ุฅูุตุงู ุงูุณุฏุงุฏ
โ ูุฑุงุฌุนุฉ ุงูุฅุฏุงุฑุฉ ููุฏูุน
โ ุชุญููู ุงูุญุฌุฒ ุฅูู ูุญุตููู
โ ุงูุดูุงุฏุฉ ุงูุฑุณููุฉ ุงูููุงุฆูุฉ
โ ุฅุฑุณุงู SMS ูุนูู ูุงุณุชุนุงุฏุฉ ูููุฉ ุงููุฑูุฑ

**ุงูุชุทููุฑ ูุชููู ููุง ูุคูุชุงู ูุณูุชู ุงุณุชููุงู ุงููุฑุงุญู ูุงุญูุงู.**

---

## ๐ ุงูุญุงูุฉ ุงูุญุงููุฉ ููุญุฌูุฒุงุช

ุจุนุฏ ุงูุชูุงู ูุฐู ุงููุฑุญูุฉุ ุงูุญุฌูุฒุงุช ุชููู ูู ุงูุญุงูุงุช ุงูุชุงููุฉ:

### ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ:
```sql
status = 'temporary'
guest_id IS NOT NULL
user_id IS NULL
temporary_expires_at = now() + 24 hours
```

### ุงูุญุฌูุฒุงุช ุงููุณุฌูุฉ:
```sql
status = 'pending'
user_id IS NOT NULL
guest_id IS NULL
temporary_expires_at = NULL
```

**ุงูุชุฏูู:**
```
temporary (ุญุฌุฒ ุจุฏูู ุชุณุฌูู)
    โ
pending (ุจุนุฏ ุงูุชุณุฌูู)
    โ
[ุชููู ูุคูุช - ุณููุณุชููู ูุงุญูุงู]
    โ
waiting_for_payment (ุจุนุฏ ุงุนุชูุงุฏ ุงูุฅุฏุงุฑุฉ)
    โ
... ุจููุฉ ุงููุฑุงุญู
```

---

## ๐งช Build Status

```bash
โ 1614 modules transformed
โ built in 8.23s

Bundle Size:
- CSS: 65.94 kB (gzipped: 10.32 kB)
- JS: 784.06 kB (gzipped: 183.12 kB)
```

**ุฌููุน ุงูููููุงุช ุชุนูู ุจุฏูู ุฃุฎุทุงุก.**

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ/ุงููุนุฏูุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
```
src/components/BookingSuccessScreen.tsx          -- ุดุงุดุฉ ูุฌุงุญ ุงูุญุฌุฒ
src/components/TemporaryCertificate.tsx          -- ุงูุดูุงุฏุฉ ุงููุคูุชุฉ
src/components/InvestorRegistrationForm.tsx      -- ูููุฐุฌ ุงูุชุณุฌูู
```

### ูููุงุช ูุนุฏูุฉ:
```
src/components/InvestmentFarmPage.tsx            -- ุฅุถุงูุฉ ููุทู ุงูุญุฌุฒ
```

### migrations ุฌุฏูุฏุฉ:
```
supabase/migrations/add_temporary_reservations_support.sql
```

---

## ๐จ ุงูุชุตููู

### ูุธุงู ุงูุฃููุงู:

**ุงูุฐูุจู (ููุญุฌุฒ ูุงูุดูุงุฏุฉ):**
```css
Primary:    #D4AF37
Secondary:  #B8942F
Light:      rgba(212, 175, 55, 0.1-0.3)
Gradient:   from-amber-50 via-yellow-50 to-orange-50
```

**ุงูุฃุฎุถุฑ (ูููุฌุงุญ):**
```css
Success:    from-green-400 to-green-600
Badge:      bg-green-50 text-green-700
```

**ุงูุจููุณุฌู (ูุฒุฑ ุงูุชุณุฌูู):**
```css
CTA:        from-purple-600 to-pink-600
Background: from-purple-50 to-pink-50
```

**ุงูุฃุญูุฑ (ููุชุญุฐูุฑุงุช):**
```css
Warning:    bg-red-50 border-red-200 text-red-700
Badge:      bg-red-100 border-red-400
```

### ุงููุณุงูุงุช ูุงูุฃุญุฌุงู:
```
padding:  p-4, p-6, p-8
spacing:  space-y-4, space-y-6
radius:   rounded-xl, rounded-2xl
shadows:  shadow-lg, shadow-xl, shadow-2xl
borders:  border-2, border-4
```

---

## ๐ ุชุฏูู ุงูุจูุงูุงุช

### localStorage:
```typescript
guestId: string  // ูุนุฑู ุงูุฒุงุฆุฑ ุงููุคูุช
// ููุญูุธ ุนูุฏ ุฃูู ุฒูุงุฑุฉ
// ููุฒุงู ุจุนุฏ ุงูุชุณุฌูู
```

### State ูู InvestmentFarmPage:
```typescript
selectedContract: FarmContract | null
treeCount: number
isCreatingReservation: boolean
reservationData: ReservationData | null
guestId: string
```

### ุงูุชูุฑูุฑ ุจูู ุงูููููุงุช:
```
InvestmentFarmPage
  โ (reservationData, guestId)
BookingSuccessScreen
  โ (farm details)
TemporaryCertificate
  โ (guestId, onSuccess)
InvestorRegistrationForm
  โ (userId)
handleRegistrationComplete
```

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ:
1. โ ุงุฎุชูุงุฑ ุงูุงุณุชุซูุงุฑ ุจุญุฑูุฉ
2. โ ุญุฌุฒ ููุฑู ุจุฏูู ุชุณุฌูู
3. โ ุดูุงุฏุฉ ูุคูุชุฉ ููุงุทูุฆูุงู
4. โ ุชุณุฌูู ุจุณูุท ูุณุฑูุน (ุฏูููุชุงู)
5. โ ุฑุจุท ุชููุงุฆู ููุญุฌุฒ
6. โ ุฅุดุนุงุฑ ูุงุถุญ ุจุงููุฌุงุญ

### ูุธุงู ูุญูู ูุขูู:
1. โ ุงูุญุฌูุฒุงุช ูุญููุฉ ุจู RLS
2. โ guest_id ูุฑูุฏ ููู ุฒุงุฆุฑ
3. โ ุงูุชูุงุก ุชููุงุฆู ุจุนุฏ 24 ุณุงุนุฉ
4. โ ูุง ูููู ุงููุตูู ูุญุฌูุฒุงุช ุงูุขุฎุฑูู
5. โ ุงูุชุญูู ูู ุงูุจูุงูุงุช ูุจู ุงูุญูุธ

### ุฌุงูุฒ ููุชูุณุน:
1. โ ุงูุญุงูุงุช ูุนุฑููุฉ ูุณุจูุงู
2. โ ุงูุจููุฉ ุฌุงูุฒุฉ ููุฏูุน
3. โ SMS infrastructure ุฌุงูุฒุฉ
4. โ ุฑุญูุฉ ุงููุณุชุซูุฑ ูุงุถุญุฉ

---

## ๐ก ููุงุญุธุงุช ูููุฉ

### 1. ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ
- ุตูุงุญูุชูุง 24 ุณุงุนุฉ ููุท
- ุชููุบู ุชููุงุฆูุงู ุจุนุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ
- ุงูุฏุงูุฉ `cleanup_expired_temporary_reservations()` ูุชููุฑุฉ

### 2. ุฑูู ุงูุฌูุงู ููุนุฑู
- ููุญูู ูู email: `phone@investor.harvest.local`
- ูุฐุง ูุถูู ุงูุชูุฑุฏ ูู Supabase Auth
- ุฑูู ุงูุฌูุงู ููุญูุธ ูู user_metadata

### 3. ุงูุดูุงุฏุฉ ุงููุคูุชุฉ
- ููุนุฑุถ ููุท ุฏุงุฎู ุงูุชุทุจูู
- ูุง ูููู ุชุญููููุง ุฃู ุทุจุงุนุชูุง
- ุชุชุญูู ูุดูุงุฏุฉ ุฑุณููุฉ ุจุนุฏ ุงูุฏูุน (ูุณุชูุจูุงู)

### 4. ูุธุงู SMS
- ุงูุจููุฉ ุฌุงูุฒุฉ
- ููู ูู ูุชู ุงูุชูุนูู
- ุณูุชู ุงูุชูุนูู ูู ูุฑุญูุฉ ูุงุญูุฉ

### 5. ุงูุชููู ุงููุคูุช
- ูุง ููุฌุฏ ุฏูุน ุญุงููุงู
- ูุง ููุฌุฏ ูุฑุงุฌุนุฉ ุฅุฏุงุฑูุฉ
- ุงูุญุฌุฒ ูุจูู ูู ุญุงูุฉ 'pending'
- ุณูุชู ุงูุงุณุชููุงู ูุงุญูุงู

---

## โจ ุงูุฎูุงุตุฉ

ุชู ุชูููุฐ ุฑุญูุฉ ูุงููุฉ ูู:
```
ุงุฎุชูุงุฑ ุงูุงุณุชุซูุงุฑ โ ุงูุญุฌุฒ ุงููุคูุช โ ุนุฑุถ ุงูุดูุงุฏุฉ โ ุงูุชุณุฌูู โ ุฑุจุท ุงูุญุฌุฒ
```

**"ุฑุญูุฉ ุงุณุชุซูุงุฑูุฉ ุณูุณุฉ ูุขููุฉ ูู ุฃูู ููุฑุฉ ุญุชู ุฅูุดุงุก ุงูุญุณุงุจ"**

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุงูุงุฎุชุจุงุฑุ ูุฌุงูุฒ ููุชูุณุน ูู ุงููุฑุงุญู ุงููุงุฏูุฉ.

๐ฏ **ุงูุชุทููุฑ ูุชููู ููุง ููุง ูู ูุทููุจ.**
