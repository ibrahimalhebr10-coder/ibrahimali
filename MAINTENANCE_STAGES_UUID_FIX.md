# ุฅุตูุงุญ ุฎุทุฃ UUID ูู ุฌุฏูู maintenance_stages

## ุงูุชุงุฑูุฎ: 2026-02-04

---

## ๐ ุงููุดููุฉ ุงููููุชุดูุฉ

### ุฑุณุงูุฉ ุงูุฎุทุฃ:
```
POST https://...supabase.co/rest/v1/maintenance_stages 400 (Bad Request)
Error: {
  code: '22P02',
  details: null,
  hint: null,
  message: 'invalid input syntax for type uuid: "kxc11h7bl"'
}
```

### ุงูุณุจุจ ุงูุฌุฐุฑู:

1. **ูู MaintenanceRecordWizard.tsx (ุงูุณุทุฑ 69):**
```typescript
const newStage: MaintenanceStageInput = {
  id: Math.random().toString(36).substr(2, 9),  // โ ูููุฏ id ูุซู "kxc11h7bl"
  ...tempStage
};
```

2. **ูุฐุง ุงูู id ุงููุคูุช ููุณุชุฎุฏู ูู ุงููุงุฌูุฉ ููุท ูู React keys**

3. **ููู ุนูุฏ ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```typescript
// ูู operationsService.ts (ุงูุณุทุฑ 504-508)
data.stages.map(stage =>
  this.createMaintenanceStage({
    maintenance_id: maintenanceId,
    ...stage  // โ ููุณุฎ ุฌููุน ุงูุฎุตุงุฆุต ุจูุง ูููุง id ุงููุคูุช!
  })
)
```

4. **ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุฑูุถ ูุฃู:**
   - ุฌุฏูู `maintenance_stages` ูุชููุน `id` ูู ููุน UUID
   - ุงููููุฉ `"kxc11h7bl"` ููุณุช UUID ุตุงูุญ
   - UUID ุงูุตุงูุญ ูุจุฏู ูุซู: `"550e8400-e29b-41d4-a716-446655440000"`

---

## ๐๏ธ ุงูุญู ุงูููุทุจู

### ุงูุฅุตูุงุญ ูู operationsService.ts

**ูุจู:**
```typescript
if (data.stages.length > 0) {
  await Promise.all(
    data.stages.map(stage =>
      this.createMaintenanceStage({
        maintenance_id: maintenanceId,
        ...stage  // โ ูุฑุณู id ุงููุคูุช
      })
    )
  );
}
```

**ุจุนุฏ:**
```typescript
if (data.stages.length > 0) {
  await Promise.all(
    data.stages.map(stage => {
      const { id, ...stageData } = stage as any;  // โ ูุฒูู id ุงููุคูุช
      return this.createMaintenanceStage({
        maintenance_id: maintenanceId,
        ...stageData  // โ ูุฑุณู ููุท ุงูุจูุงูุงุช ุงูุตุงูุญุฉ
      });
    })
  );
}
```

**ุงููุงุฆุฏุฉ:**
- ูุชู ุฅุฒุงูุฉ `id` ุงููุคูุช ูุจู ุฅุฑุณุงูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชููุฏ UUID ุตุญูุญ ุชููุงุฆููุง
- ุงูู `id` ุงููุคูุช ูุจูู ูู ุงููุงุฌูุฉ ููุท ูู React keys

### ุฅุตูุงุญ ููุงุซู ูู mediaFiles

**ูุจู:**
```typescript
if (data.mediaFiles.length > 0) {
  await Promise.all(
    data.mediaFiles.map(media =>
      this.uploadMaintenanceMedia(media.file, maintenanceId, media.type)
    )
  );
}
```

**ุจุนุฏ:**
```typescript
if (data.mediaFiles.length > 0) {
  await Promise.all(
    data.mediaFiles.map(media => {
      const { id, preview, ...mediaData } = media as any;  // โ ูุฒูู id ู preview ุงููุคูุชูู
      return this.uploadMaintenanceMedia(mediaData.file, maintenanceId, mediaData.type);
    })
  );
}
```

**ุงููุงุฆุฏุฉ:**
- ูุชู ุฅุฒุงูุฉ `id` ู `preview` ุงููุคูุชูู
- ูุชู ุฅุฑุณุงู ููุท `file` ู `type` ุฅูู ุงูุฏุงูุฉ

---

## ๐ ุงูุชุฏูู ุงูุตุญูุญ

### ูุจู ุงูุฅุตูุงุญ:
```
1. ุงููุณุชุฎุฏู ูุถูู ูุฑุญูุฉ ูู ุงููุงุฌูุฉ
   โ
2. ูุชู ุฅูุดุงุก id ูุคูุช: "kxc11h7bl"
   โ
3. ูุชู ุญูุธ ุงููุฑุญูุฉ ูู formData ูุน id ุงููุคูุช
   โ
4. ุนูุฏ ุงูุถุบุท "ุญูุธ ุงูุณุฌู"
   โ
5. ูุชู ุฅุฑุณุงู ุฌููุน ุงูุจูุงูุงุช ุจูุง ูููุง id ุงููุคูุช
   โ
6. ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุฑูุถ: "invalid input syntax for type uuid"
   โ
7. โ ูุดู ุงูุญูุธ
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
1. ุงููุณุชุฎุฏู ูุถูู ูุฑุญูุฉ ูู ุงููุงุฌูุฉ
   โ
2. ูุชู ุฅูุดุงุก id ูุคูุช: "kxc11h7bl" (ูููุงุฌูุฉ ููุท)
   โ
3. ูุชู ุญูุธ ุงููุฑุญูุฉ ูู formData ูุน id ุงููุคูุช
   โ
4. ุนูุฏ ุงูุถุบุท "ุญูุธ ุงูุณุฌู"
   โ
5. ูุชู ุชุตููุฉ ุงูุจูุงูุงุช ูุฅุฒุงูุฉ id ุงููุคูุช
   โ
6. ูุชู ุฅุฑุณุงู ููุท: stage_title, stage_note, stage_date
   โ
7. ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชููุฏ UUID ุตุญูุญ ุชููุงุฆููุง
   โ
8. โ ูุฌุญ ุงูุญูุธ
```

---

## ๐ ุงูุชูุงุตูู ุงูุชูููุฉ

### ููุงุฐุง ูุณุชุฎุฏู `as any`ุ

```typescript
const { id, ...stageData } = stage as any;
```

**ุงูุณุจุจ:**
- TypeScript type ููู stages ูู ุงูู interface ูุง ูุญุชูู ุนูู `id`
- ููู ุงููุงุฆู ุงููุนูู ุงููุงุฏู ูู MaintenanceRecordWizard ูุญุชูู ุนูู `id`
- `as any` ูุณูุญ ููุง ุจูุฑุงุกุฉ `id` ูุฅุฒุงูุชู ุฏูู ุฃุฎุทุงุก TypeScript
- ุจุนุฏ ุงูุฅุฒุงูุฉุ `stageData` ูุญุชูู ููุท ุนูู ุงูุฎุตุงุฆุต ุงููุทููุจุฉ

### ููุงุฐุง ูุง ูุฒูู ุงูู id ูู MaintenanceRecordWizardุ

**ุงูุณุจุจ:**
- ุงูู `id` ุงููุคูุช ุถุฑูุฑู ูููุงุฌูุฉ
- ููุณุชุฎุฏู ูู React key ูู ุงูููุงุฆู: `key={stage.id}`
- ููุณุชุฎุฏู ูุญุฐู ูุฑุญูุฉ ูุจู ุงูุญูุธ: `stages.filter(s => s.id !== id)`
- ุฅุฒุงูุชู ูู ุงููุงุฌูุฉ ุณูุณุจุจ ูุดุงูู ูู ุงูุชูุงุนู

**ุงูุญู ุงูุฃูุซู:**
- ุงูู `id` ุงููุคูุช ูุจูู ูู ุงููุงุฌูุฉ
- ูุชู ุชุตููุชู ุนูุฏ ุงูุฅุฑุณุงู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูู ุทุจูุฉ ุชุณุชุฎุฏู ุงูุจูุงูุงุช ุจุงูุดูู ุงูููุงุณุจ ููุง

---

## ๐ฏ ุงูุจูุงูุงุช ุงูููุฑุณูุฉ

### ูุจู ุงูุฅุตูุงุญ:
```json
{
  "maintenance_id": "uuid-here",
  "id": "kxc11h7bl",  // โ invalid UUID
  "stage_title": "ูุฑุญูุฉ ุงูุฑู",
  "stage_note": "ุฑู ููุซู",
  "stage_date": "2026-02-04"
}
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```json
{
  "maintenance_id": "uuid-here",
  "stage_title": "ูุฑุญูุฉ ุงูุฑู",  // โ ููุท ุงูุจูุงูุงุช ุงูุตุงูุญุฉ
  "stage_note": "ุฑู ููุซู",
  "stage_date": "2026-02-04"
}
```

**ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชููุฏ:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",  // โ UUID ุตุญูุญ
  "maintenance_id": "uuid-here",
  "stage_title": "ูุฑุญูุฉ ุงูุฑู",
  "stage_note": "ุฑู ููุซู",
  "stage_date": "2026-02-04",
  "created_at": "2026-02-04T10:30:00Z"
}
```

---

## โ ุงูุงุฎุชุจุงุฑ

### ุงูุณููุงุฑูู:
1. ุงูุฐูุงุจ ุฅูู Admin Dashboard โ ูุณู Operations โ ุชุจููุจ Green Trees
2. ุงูุถุบุท ุนูู "ุฅูุดุงุก ุณุฌู ุตูุงูุฉ ุฌุฏูุฏ"
3. ุงุฎุชูุงุฑ ูุฒุฑุนุฉ ูููุน ุตูุงูุฉ
4. ุฅุถุงูุฉ ูุฑุญูุฉ ุฃู ุฃูุซุฑ
5. ุฅุถุงูุฉ ุตูุฑ/ููุฏูู (ุงุฎุชูุงุฑู)
6. ุฅุฏุฎุงู ุงููุจูุบ ุงูุฅุฌูุงูู (ุงุฎุชูุงุฑู)
7. ุงูุถุบุท "ุญูุธ ุงูุณุฌู"

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- โ ูุชู ุญูุธ ุงูุณุฌู ุจูุฌุงุญ
- โ ูุชู ุญูุธ ุฌููุน ุงููุฑุงุญู ุจูุฌุงุญ
- โ ูุชู ุฑูุน ุงูุตูุฑ/ุงูููุฏูู ุจูุฌุงุญ
- โ ูุชู ุฅูุดุงุก ุงูุฑุณูู ุงููุงููุฉ ุจูุฌุงุญ
- โ ุฑุณุงูุฉ ูุฌุงุญ: "ุชู ุฅูุดุงุก ุณุฌู ุงูุตูุงูุฉ ุจูุฌุงุญ ูุน ุฌููุน ุงูุชูุงุตูู"
- โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก UUID ูู Console

---

## ๐ ุงูุฃูุงู

### ูุง ุชูุฌุฏ ูุฎุงูู ุฃูููุฉ:
- ุงูุฅุตูุงุญ ูุฒูู ููุท ุจูุงูุงุช ุบูุฑ ุตุงูุญุฉ ูุจู ุงูุฅุฑุณุงู
- ูุง ูุคุซุฑ ุนูู RLS policies
- ูุง ูุคุซุฑ ุนูู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- ูุชุจุน ููุณ ุงูุชุฏูู ุงูุฃููู ุงูุณุงุจู

---

## ๐ ุงูููุงุญุธุงุช ุงููููุฉ

### ูููุทูุฑูู:

1. **ุนูุฏ ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ:**
   - ุชุฃูุฏ ูู ุฃู ุงูุญููู ุงููุคูุชุฉ (ูููุงุฌูุฉ ููุท) ูุง ูุชู ุฅุฑุณุงููุง ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุงุณุชุฎุฏู destructuring ูุฅุฒุงูุฉ ุงูุญููู ุบูุฑ ุงููุทููุจุฉ

2. **ุนูุฏ ุงุณุชุฎุฏุงู temporary IDs:**
   - ุงุณุชุฎุฏู `crypto.randomUUID()` ุฅุฐุง ููุช ุจุญุงุฌุฉ ูู UUID ุญูููู
   - ุฃู ุงุณุชุฎุฏู ุฃู ูุธุงู ุชุนุฑูู ูุคูุช ููู ูุง ุชุฑุณูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

3. **TypeScript:**
   - ุงุณุชุฎุฏู `as any` ููุท ุนูุฏูุง ุชุนุฑู ุฃู ุงูุจูุงูุงุช ุงููุนููุฉ ุชุฎุชูู ุนู Type
   - ุฃุถู ุชุนููู ูุดุฑุญ ุงูุณุจุจ

### ุฃููุงุท ููุงุซูุฉ ูู ุงูููุฏ:
- โ ุชู ุฅุตูุงุญ `stages` ูู createFullMaintenanceRecord
- โ ุชู ุฅุตูุงุญ `mediaFiles` ูู createFullMaintenanceRecord
- โ ูุง ุชูุฌุฏ ุฃูุงูู ุฃุฎุฑู ุชุญุชุงุฌ ููุณ ุงูุฅุตูุงุญ

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ูุจู ุงูุฅุตูุงุญ:
```
โ ุฎุทุฃ UUID ุนูุฏ ุญูุธ ุณุฌู ุตูุงูุฉ ูุน ูุฑุงุญู
โ ูุง ูููู ุฅูุดุงุก ุณุฌูุงุช ุตูุงูุฉ ูุงููุฉ
โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
โ ุญูุธ ูุงุฌุญ ูุฌููุน ุงููุฑุงุญู
โ UUID ุตุญูุญ ูุชู ุชูููุฏู ุชููุงุฆููุง
โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ
โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู Console
```

---

## โ ุญุงูุฉ ุงูุชูููุฐ

| ุงููููุฉ | ุงูุญุงูุฉ |
|--------|--------|
| ุชุญููู ุงููุดููุฉ | โ ููุชูู |
| ุชุญุฏูุฏ ุงูุณุจุจ ุงูุฌุฐุฑู | โ ููุชูู |
| ุฅุตูุงุญ stages | โ ููุชูู |
| ุฅุตูุงุญ mediaFiles | โ ููุชูู |
| ุงุฎุชุจุงุฑ ุงูุจูุงุก | โ ููุชูู |
| ุงูุชูุซูู | โ ููุชูู |

**ุงููุดููุฉ ููุนุงูุฌุฉ - ูููู ุงูุขู ุฅูุดุงุก ุณุฌูุงุช ุตูุงูุฉ ูุงููุฉ ุจูุฌุงุญ!**
