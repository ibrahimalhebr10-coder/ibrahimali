# ูุธุงู ุชุชุจุน ุฑูุงุจุท ุงูุดุฑูุงุก - ููู ูุนูู ๐

## ุงูุณุคุงู ุงูููู โ
**ุนูุฏูุง ูููู ุงูุดุฑูู ุจูุณุฎ ุฑุงุจุทู ููุดุงุฑูุชูุ ููู ูุนุฑู ุฃู ุงูุญุฌุฒ ุฌุงุก ูู ุฎูุงู ูุฐุง ุงูุดุฑููุ**

---

## ุงูุฅุฌุงุจุฉ ุงููุงููุฉ ๐

ุงููุธุงู ูุนูู ุจู **3 ุทุฑู ูุชูุงููุฉ** ูุถูุงู ุงูุชุชุจุน ุงูุฏููู:

---

## ุงูุทุฑููุฉ 1๏ธโฃ: ุงูุฑุงุจุท ูุน ูุนุงูู ref ๐

### ููู ูุนูู:

**ุงูุฑุงุจุท ุงูุฐู ูุดุงุฑูู ุงูุดุฑูู:**
```
https://yoursite.com?ref=ahmed_almzare3
```

**ูุงุฐุง ูุญุฏุซ ุนูุฏ ูุชุญ ุงูุฑุงุจุท:**

1. **ูุฑุงุกุฉ ุงูููุฏ ูู URL**
```javascript
// ูู InfluencerCodeInput.tsx - ุณุทุฑ 56
sessionStorage.setItem('influencer_code', code);
sessionStorage.setItem('influencer_activated_at', new Date().toISOString());
```

2. **ุญูุธ ุงูููุฏ ูู ุงููุชุตูุญ**
   - ููุญูุธ ูู `sessionStorage`
   - ูุจูู ุทูุงู ุงูุฌูุณุฉ
   - ุญุชู ูู ุชููู ุงูุฒุงุฆุฑ ุจูู ุงูุตูุญุงุช

3. **ุฅุฑูุงู ุงูููุฏ ูุน ุงูุญุฌุฒ**
```javascript
// ุนูุฏ ุฅูุดุงุก ุงูุญุฌุฒ - InvestmentFarmPage.tsx ุณุทุฑ 364
const { data: reservation } = await supabase
  .from('reservations')
  .insert({
    ...reservationData,
    influencer_code: influencerCode || null  // โ ููุง ููุญูุธ ุงูููุฏ!
  });
```

---

## ุงูุทุฑููุฉ 2๏ธโฃ: ุงูุฅุฏุฎุงู ุงููุฏูู โจ๏ธ

### ููู ูุนูู:

**ุนูุฏูุง ูุทูุจ ุงูุฒุงุฆุฑ ุฅุฏุฎุงู ุงูููุฏ ูุฏููุงู:**

1. **ุญูู ุงูุฅุฏุฎุงู**
   - ูุธูุฑ ูู ุตูุญุฉ ุงููุฒุฑุนุฉ
   - "ูู ูุฏูู ููุฏ ูู ุดุฑูู ุงููุณูุฑุฉุ"

2. **ุงูุชุญูู ูู ุงูููุฏ**
```javascript
// ูู InfluencerCodeInput.tsx - ุณุทุฑ 44
const result = await influencerMarketingService.verifyInfluencerCode(inputValue.trim());

if (!result.isValid) {
  setErrorMessage(result.message); // โ ููุฏ ุฎุงุทุฆ
  return;
}
```

3. **ุญูุธ ุงูููุฏ**
```javascript
sessionStorage.setItem('influencer_code', code);
sessionStorage.setItem('influencer_activated_at', new Date().toISOString());
```

4. **ุฑุจุท ูุน ุงูุญุฌุฒ**
   - ููุณ ุงูุทุฑููุฉ ุงูุฃููู
   - ููุญูุธ ูู `influencer_code` column

---

## ุงูุทุฑููุฉ 3๏ธโฃ: ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุงูุชููุงุฆู ๐

### ููู ูุนูู:

**ุนูุฏ ุฅุชูุงู ุงูุฏูุน:**

```javascript
// ูู InvestmentFarmPage.tsx - ุณุทุฑ 393
if (influencerCode) {
  const { data: influencerResult } = await supabase
    .rpc('update_influencer_stats_after_payment', {
      p_influencer_code: influencerCode,
      p_trees_count: treeCount,
      p_reservation_id: reservation.id
    });
}
```

**ูุงุฐุง ุชูุนู ูุฐู ุงูุฏุงูุฉ:**
1. ุชุฌุฏ ุงูุดุฑูู ุตุงุญุจ ุงูููุฏ
2. ุชุฒูุฏ ุนุฏุฏ ุงูุนููุงุก: `+1`
3. ุชุฒูุฏ ุนุฏุฏ ุงูุฃุดุฌุงุฑ: `+treeCount`
4. ุชุญุณุจ ุงูููุงูุฃุฉ ุงููุณุชุญูุฉ
5. ุชุณุฌู ูู `influencer_rewards_log`

---

## ูุซุงู ุนููู ูุงูู ๐ฏ

### ุงูุณููุงุฑูู:

**ุงูุดุฑูู: ุฃุญูุฏ** (ููุฏ: `ahmed_almzare3`)

#### ุงูุฎุทูุฉ 1: ุงููุดุงุฑูุฉ
```
ุฃุญูุฏ ููุณุฎ ุฑุงุจุทู:
https://yoursite.com?ref=ahmed_almzare3
```

#### ุงูุฎุทูุฉ 2: ุงูุฒูุงุฑุฉ
```
ุฎุงูุฏ ูุถุบุท ุนูู ุงูุฑุงุจุท
โ ููุชุญ ุงููุชุตูุญ
โ ููุฑุฃ ?ref=ahmed_almzare3
โ ูุญูุธ ูู sessionStorage
```

#### ุงูุฎุทูุฉ 3: ุงูุชุตูุญ
```
ุฎุงูุฏ ูุชุตูุญ ุงููุฒุงุฑุน
- ุตูุญุฉ ุงููุฒุฑุนุฉ ุงูุฃููู โ
- ุตูุญุฉ ุงูุฃุดุฌุงุฑ ุงูุฐูุจูุฉ โ
- ุตูุญุฉ ุงูุจุงูุงุช โ

ุงูููุฏ ูุง ูุฒุงู ูุญููุธุงู: ahmed_almzare3
```

#### ุงูุฎุทูุฉ 4: ุงูุญุฌุฒ
```
ุฎุงูุฏ ูุญุฌุฒ 10 ุฃุดุฌุงุฑ
โ ูุชู ุฅูุดุงุก reservation
โ influencer_code = 'ahmed_almzare3' โ
```

#### ุงูุฎุทูุฉ 5: ุงูุฏูุน
```
ุฎุงูุฏ ูุฏูุน ุจูุฌุงุญ
โ ุชูุญุฏุซ ุฅุญุตุงุฆูุงุช ุฃุญูุฏ:
   - total_customers: 5 โ 6
   - total_trees_sold: 50 โ 60
   - total_reward_amount: 500 โ 600
```

---

## ููู ุชุชุญูู ูู ุฃู ุงูุชุชุจุน ูุนูู ๐งช

### 1. ูู ููุญุฉ ุงูุดุฑูู:

```
ุงูุชุญ ุญุณุงุจ ุงูุดุฑูู:
- ุนุฏุฏ ุงูุนููุงุก: ุณูุฒูุฏ
- ุนุฏุฏ ุงูุฃุดุฌุงุฑ: ุณูุฒูุฏ
- ุงูููุงูุขุช: ุณุชุฒูุฏ
```

### 2. ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```sql
-- ุชุญูู ูู ุงูุญุฌุฒ
SELECT id, influencer_code, tree_count, total_price
FROM reservations
WHERE influencer_code = 'ahmed_almzare3';

-- ุชุญูู ูู ุงูููุงูุขุช
SELECT * FROM influencer_rewards_log
WHERE influencer_code = 'ahmed_almzare3';
```

### 3. ูู Console ุงููุชุตูุญ:

```javascript
// ุงูุชุญ Developer Tools (F12)
// ุชุจููุจ Console
// ุงูุชุจ:
sessionStorage.getItem('influencer_code')

// ุงููุชูุฌุฉ:
// "ahmed_almzare3" โ
```

---

## ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ ูู ุงูุชุชุจุน ๐

### 1. ุฌุฏูู `reservations`
```sql
influencer_code TEXT  -- ุงูููุฏ ุงููุณุชุฎุฏู ุนูุฏ ุงูุญุฌุฒ
```

### 2. ุฌุฏูู `influencer_partners`
```sql
name TEXT              -- ุงูููุฏ ุงููุฑูุฏ (ูุซู: ahmed_almzare3)
total_customers INT    -- ุนุฏุฏ ุงูุนููุงุก ุงูุฅุฌูุงูู
total_trees_sold INT   -- ุนุฏุฏ ุงูุฃุดุฌุงุฑ ุงููุจุงุนุฉ
total_reward_amount    -- ุฅุฌูุงูู ุงูููุงูุขุช
```

### 3. ุฌุฏูู `influencer_rewards_log`
```sql
influencer_code TEXT   -- ุงูููุฏ
reservation_id UUID    -- ูุนุฑู ุงูุญุฌุฒ
trees_count INT        -- ุนุฏุฏ ุงูุฃุดุฌุงุฑ
reward_amount          -- ูููุฉ ุงูููุงูุฃุฉ
created_at             -- ุชุงุฑูุฎ ุงูููุงูุฃุฉ
```

---

## ุงูุฏูุงู ุงููุณุชุฎุฏูุฉ ๐๏ธ

### 1. `verifyInfluencerCode()`
```typescript
// ุงูุบุฑุถ: ุงูุชุญูู ูู ุตุญุฉ ุงูููุฏ
// ุงููุฏุฎูุงุช: ุงูููุฏ
// ุงููุฎุฑุฌุงุช: { isValid: boolean, message: string }
```

### 2. `update_influencer_stats_after_payment()`
```sql
-- ุงูุบุฑุถ: ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูุดุฑูู
-- ุงููุฏุฎูุงุช:
--   p_influencer_code: ููุฏ ุงูุดุฑูู
--   p_trees_count: ุนุฏุฏ ุงูุฃุดุฌุงุฑ
--   p_reservation_id: ูุนุฑู ุงูุญุฌุฒ
-- ุงููุชูุฌุฉ: ุชุญุฏูุซ ุชููุงุฆู ููุฅุญุตุงุฆูุงุช
```

---

## ุงูุฃูุงู ูุงูุญูุงูุฉ ๐

### 1. ุงูุชุญูู ูู ุงูููุฏ:
```typescript
// ูุง ูููู ุงุณุชุฎุฏุงู ููุฏ ูููู
const result = await influencerMarketingService.verifyInfluencerCode(code);
if (!result.isValid) {
  return; // โ ุฑูุถ
}
```

### 2. ุนุฏู ุงูุชูุฑุงุฑ:
```sql
-- ูู ุญุฌุฒ ูู ููุฏ ูุงุญุฏ ููุท
-- ูุง ูููู ุชุบููุฑ ุงูููุฏ ุจุนุฏ ุฅูุดุงุก ุงูุญุฌุฒ
```

### 3. ุงูุชุชุจุน ุงูุฏููู:
```sql
-- ูู ููุงูุฃุฉ ูุฑุชุจุทุฉ ุจุญุฌุฒ ูุญุฏุฏ
-- ูููู ูุฑุงุฌุนุฉ ูู ุนูููุฉ
-- ุณุฌู ูุงูู ูู influencer_rewards_log
```

---

## ุงูุชูุงุฑูุฑ ุงููุชุงุญุฉ ๐

### 1. ููุดุฑูู:
- ุนุฏุฏ ุงูุนููุงุก ุงูููู
- ุนุฏุฏ ุงูุฃุดุฌุงุฑ ุงููุจุงุนุฉ
- ุฅุฌูุงูู ุงูููุงูุขุช
- ุณุฌู ุงูุนูููุงุช ุงูุฃุฎูุฑุฉ

### 2. ููุฅุฏุงุฑุฉ (Admin):
```sql
-- ุนุฑุถ ุฌููุน ุงูุญุฌูุฒุงุช ูุดุฑูู ูุนูู
SELECT * FROM reservations
WHERE influencer_code = 'ahmed_almzare3';

-- ุนุฑุถ ุฅุฌูุงูู ุงูููุงูุขุช
SELECT
  influencer_code,
  COUNT(*) as total_reservations,
  SUM(trees_count) as total_trees,
  SUM(reward_amount) as total_rewards
FROM influencer_rewards_log
GROUP BY influencer_code;
```

---

## ูุฒุงูุง ุงููุธุงู โจ

### 1. ุฏูุฉ 100%
- ูู ุญุฌุฒ ูุฑุชุจุท ุจููุฏ ูุญุฏุฏ
- ูุง ุชูุฌุฏ ูุฑุตุฉ ููุฎุทุฃ

### 2. ุดูุงููุฉ ูุงููุฉ
- ุงูุดุฑูู ูุฑู ูู ุดูุก
- ุงูุฅุฏุงุฑุฉ ุชุฑุงูุจ ูู ุดูุก
- ุณุฌูุงุช ูุงููุฉ

### 3. ุฃูุงู ุนุงูู
- ุชุญูู ูู ุงูุฃููุงุฏ
- ูุง ุชูุฑุงุฑ
- ุณุฌูุงุช ูุญููุฉ

### 4. ุณูููุฉ ุงูุงุณุชุฎุฏุงู
- ุฑุงุจุท ุจุณูุท
- ุฃู ุฅุฏุฎุงู ูุฏูู
- ูุนูู ุชููุงุฆูุงู

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก ๐ง

### ุงููุดููุฉ: ุงูููุฏ ูุง ููุญูุธ

**ุงูุญู:**
```javascript
// ุชุญูู ูู Console
console.log(sessionStorage.getItem('influencer_code'));
// ุฅุฐุง ูุงู nullุ ุฌุฑุจ:
// 1. ุฅุนุงุฏุฉ ูุชุญ ุงูุฑุงุจุท
// 2. ุฅุฏุฎุงู ุงูููุฏ ูุฏููุงู
```

### ุงููุดููุฉ: ุงูุฅุญุตุงุฆูุงุช ูุง ุชุชุญุฏุซ

**ุงูุญู:**
```sql
-- ุชุญูู ูู ุงูุญุฌูุฒุงุช
SELECT * FROM reservations
WHERE influencer_code = 'YOUR_CODE'
ORDER BY created_at DESC;

-- ุฅุฐุง ูู ุชุธูุฑุ ุชุญูู:
-- 1. ูู ุชู ุงูุฏูุนุ
-- 2. ูู ุงูููุฏ ุตุญูุญุ
```

---

## ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ ๐

ุงููุธุงู ูุนูู ุจุดูู **ุชููุงุฆู 100%**:

1. โ ุงูุดุฑูู ููุณุฎ ุฑุงุจุทู
2. โ ุงูุนููู ููุชุญ ุงูุฑุงุจุท
3. โ ุงูููุฏ ููุญูุธ ุชููุงุฆูุงู
4. โ ุงูุญุฌุฒ ูููุดุฃ ูุน ุงูููุฏ
5. โ ุงูุฏูุน ููุญุฏุซ ุงูุฅุญุตุงุฆูุงุช
6. โ ุงูุดุฑูู ูุฑู ุงููุชุงุฆุฌ ููุฑุงู

**ูุง ููุฌุฏ ุชุฏุฎู ูุฏูู ูุทููุจ!** ๐

---

## ุฑูุงุจุท ุฐุงุช ุตูุฉ ๐

- ุฏููู ููุญุฉ ุดุฑูู ุงููุฌุงุญ: `ุฏููู_ููุญุฉ_ุดุฑูู_ุงููุฌุงุญ.md`
- ุฏููู ุงุฎุชุจุงุฑ ุฃุฒุฑุงุฑ ุงููุดุงุฑูุฉ: `ููู_ุชุฎุชุจุฑ_ุฃุฒุฑุงุฑ_ุงููุดุงุฑูุฉ.md`
- ูุธุงู ุดุฑูุงุก ุงููุฌุงุญ ูุงูู: `ูุธุงู_ุดุฑูุงุก_ุงููุฌุงุญ_ูุงูู.md`
