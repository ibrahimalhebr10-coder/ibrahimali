# ุชูุงูู ูุธุงู ุงูุตูุงูุฉ ูุน ูุงุฌูุฉ ุงูุนููุงุก - ููุชูู

## ุงูุชุงุฑูุฎ: 2026-02-04

---

## โ ุงูุฅูุฌุงุฒุงุช ุงูููุชููุฉ

### 1๏ธโฃ ุฅุถุงูุฉ ุญูู visible_to_client ููุชูุซูู ุงูุจุตุฑู

**ุงูุฌุฏุงูู ุงููุญุฏุซุฉ:**
- `maintenance_media` โ ุฃุถูู ุญูู `visible_to_client` (boolean, default: true)

**ุงููุธุงุฆู:**
- ุฃู ุตูุฑุฉ ุฃู ููุฏูู ูุชู ุฑูุนู ูููู ูุฑุฆูุงู ุชููุงุฆูุงู ููุนููู
- ุงูุฅุฏุงุฑุฉ ูููููุง ุฅุฎูุงุก ูููุงุช ูุนููุฉ ุจุชุบููุฑ ุงููููุฉ ุฅูู false
- ูุงุฌูุฉ ุงูุนููู ุชุนุฑุถ ููุท ุงููููุงุช ุงูุชู `visible_to_client = true`

---

### 2๏ธโฃ ุฅุถุงูุฉ ุญูู fees_status ูุฑุณูู ุงูุตูุงูุฉ

**ุงูุฌุฏุงูู ุงููุญุฏุซุฉ:**
- `maintenance_fees` โ ุฃุถูู ุญูู `fees_status` (text, default: 'active')
- ุงูููู ุงููุณููุญุฉ: 'active', 'inactive', 'paid'

**ุงููุธุงุฆู:**
- ุนูุฏ ุฅูุดุงุก ุฑุณูู ุตูุงูุฉุ ูุชู ุชูุนูููุง ุชููุงุฆูุงู (`fees_status = 'active'`)
- ูุงุฌูุฉ ุงูุนููู ุชุนุฑุถ ููุท ุงูุฑุณูู ุงููุดุทุฉ
- ุนูุฏ ูุดุฑ ุณุฌู ุงูุตูุงูุฉุ ุชุธูุฑ ุงูุฑุณูู ุชููุงุฆูุงู ููุนููู

---

### 3๏ธโฃ ุชุญุฏูุซ ุฎุฏูุงุช ุงููุธุงู

**ูููุงุช ูุญุฏุซุฉ:**

#### `operationsService.ts`
- ุฅุถุงูุฉ ูุงุฌูุงุช TypeScript ููุญููู ุงูุฌุฏูุฏุฉ
- ุฅุถุงูุฉ ุฏูุงู ูุฌูุจ ุจูุงูุงุช ุงูุนููุงุก:
  - `getClientMaintenanceRecords()` - ุณุฌูุงุช ุงูุตูุงูุฉ ููุนููู
  - `getClientMaintenanceMedia()` - ุงูููุฏูุง ุงููุฑุฆูุฉ ููุท
  - `getClientMaintenanceStages()` - ูุฑุงุญู ุงูุตูุงูุฉ

#### `clientMaintenanceService.ts`
- ุชุญุฏูุซ ุงููุงุฌูุงุช ูุฏุนู ุงูุญููู ุงูุฌุฏูุฏุฉ
- ุชุญุฏูุซ ุฏุงูุฉ `getMaintenanceDetails()` ูุฌูุจ ุงูุจูุงูุงุช ุงูุตุญูุญุฉ
- ุงุณุชุฎุฏุงู ุงูุฏูุงู ุงูุฌุฏูุฏุฉ ุงูุชู ุชููุชุฑ ุงูุจูุงูุงุช ุญุณุจ ุงูุฑุคูุฉ

---

### 4๏ธโฃ ุฏูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

**ุชู ุฅูุดุงุก:**

#### `get_client_maintenance_records(client_user_id, filter_path_type)`
- ุชุฌูุจ ุณุฌูุงุช ุงูุตูุงูุฉ ุงูููุดูุฑุฉ ููุนููู
- ุชููุชุฑ ุญุณุจ ุงููุฒุงุฑุน ุงูุชู ูุฏูู ุญุฌูุฒุงุช ูููุง
- ุชููุชุฑ ุญุณุจ ููุน ุงููุณุงุฑ (ุฒุฑุงุนู/ุงุณุชุซูุงุฑู)
- ุชุญุณุจ:
  - ุนุฏุฏ ุฃุดุฌุงุฑ ุงูุนููู
  - ุงููุจูุบ ุงููุณุชุญู ุนููู
  - ุนุฏุฏ ุงููููุงุช ุงููุฑุฆูุฉ
  - ุญุงูุฉ ุงูุณุฏุงุฏ

#### `get_client_visible_media(p_maintenance_id)`
- ุชุฌูุจ ููุท ุงูููุฏูุง ุงููุฑุฆูุฉ ููุนููู
- ุชุชุญูู ูู `visible_to_client = true`
- ุชุชุญูู ูู `status = 'published'`

#### `get_client_maintenance_stages(p_maintenance_id)`
- ุชุฌูุจ ูุฑุงุญู ุงูุตูุงูุฉ ููุณุฌู ุงููุญุฏุฏ
- ูุฑุชุจุฉ ุญุณุจ ุงูุชุงุฑูุฎ

---

## ๐งช ุงูุงุฎุชุจุงุฑ ุงูููุชูู

ุชู ุฅูุดุงุก ุณุฌู ุตูุงูุฉ ุชุฌุฑูุจู ูุงูู:

### ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ:
- **ุงููุฒุฑุนุฉ:** ูุฒุฑุนุฉ ุงูุฒูุชูู ุงููุชุทูุฑุฉ
- **ููุน ุงูุตูุงูุฉ:** ุฏูุฑูุฉ
- **ุงูุชุงุฑูุฎ:** 2026-02-04
- **ุงูุญุงูุฉ:** ููุดูุฑ

### ุงููุญุชูู:
- โ **3 ูุฑุงุญู:**
  1. ุชุญุถูุฑ ุงููุนุฏุงุช
  2. ุงูุฑู ูุงูุชุณููุฏ
  3. ุงููุฑุงุฌุนุฉ ุงูููุงุฆูุฉ

- โ **3 ูููุงุช ูุฑุฆูุฉ:**
  - ุตูุฑุฉ 1
  - ุตูุฑุฉ 2
  - ููุฏูู 1

- โ **ุฑุณูู ุงูุตูุงูุฉ:**
  - ุฅุฌูุงูู: 5000 ุฑูุงู
  - ุชูููุฉ ุงูุดุฌุฑุฉ: 0.01 ุฑูุงู
  - ููุนููู (50 ุดุฌุฑุฉ): 0.50 ุฑูุงู
  - ุงูุญุงูุฉ: ูุดุท
  - ุงูุณุฏุงุฏ: ูุนูู

### ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ:
```json
{
  "maintenance_id": "a8967189-6aa0-41dc-806b-630bd3439337",
  "farm_name": "ูุฒุฑุนุฉ ุงูุฒูุชูู ุงููุชุทูุฑุฉ",
  "maintenance_type": "periodic",
  "status": "published",
  "total_amount": 5000.00,
  "cost_per_tree": 0.01,
  "fees_status": "active",
  "client_tree_count": 50,
  "client_due_amount": 0.50,
  "payment_status": "pending",
  "visible_media_count": 3
}
```

---

## ๐ ุขููุฉ ุงูุนูู

### ููุฅุฏุงุฑุฉ:

1. **ุฅูุดุงุก ุณุฌู ุตูุงูุฉ:**
   - ุงุฎุชูุงุฑ ุงููุฒุฑุนุฉ
   - ุชุญุฏูุฏ ููุน ุงูุตูุงูุฉ ูุงูุชุงุฑูุฎ
   - ุฅุถุงูุฉ ุงููุฑุงุญู (ุงุฎุชูุงุฑู)
   - ุฑูุน ุงูุตูุฑ ูุงูููุฏูููุงุช (ุชููู ูุฑุฆูุฉ ุชููุงุฆูุงู)
   - ุฅุฏุฎุงู ุฑุณูู ุงูุตูุงูุฉ (ุชููู ูุดุทุฉ ุชููุงุฆูุงู)
   - ูุดุฑ ุงูุณุฌู

2. **ุงููุดุฑ:**
   - ุชุบููุฑ ุญุงูุฉ ุงูุณุฌู ุฅูู "ููุดูุฑ"
   - ูุธูุฑ ุชููุงุฆูุงู ูุฌููุน ุงูุนููุงุก ุงูุฐูู ูุฏููู ุฃุดุฌุงุฑ ูู ุงููุฒุฑุนุฉ

### ููุนููู:

1. **ูุชุญ "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก":**
   - ูุฑู ููุท ุงูุณุฌูุงุช ุงูููุดูุฑุฉ
   - ูุฑู ููุท ุงููุฒุงุฑุน ุงูุชู ูุฏูู ุญุฌูุฒุงุช ูููุง
   - ูููุชุฑ ุญุณุจ ููุน ุงููุณุงุฑ (ุฒุฑุงุนู/ุงุณุชุซูุงุฑู)

2. **ุนุฑุถ ุงูุชูุงุตูู:**
   - ุงูููุฏูุง ุงููุฑุฆูุฉ (ุตูุฑ ูููุฏูููุงุช)
   - ุงููุฑุงุญู
   - ูุนูููุงุช ุงูุตูุงูุฉ

3. **ุงูุฑุณูู:**
   - ูุฑู ููุท ุงูุฑุณูู ุงููุดุทุฉ
   - ูุฑู ุงููุจูุบ ุงููุญุณูุจ ุจูุงุกู ุนูู ุนุฏุฏ ุฃุดุฌุงุฑู
   - ููููู ุงูุณุฏุงุฏ ูุจุงุดุฑุฉ

---

## โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### ๐ฏ ุงูููุชุฑุฉ ุงูุฐููุฉ
- ุชุนุฑุถ ุงูุจูุงูุงุช ููุท ูููุฒุงุฑุน ุฐุงุช ุงูุตูุฉ ุจุงูุนููู
- ุชููุชุฑ ุญุณุจ ููุน ุงููุณุงุฑ ุชููุงุฆูุงู
- ุชุนุฑุถ ููุท ุงูุณุฌูุงุช ุงูููุดูุฑุฉ

### ๐ฐ ุญุณุงุจ ุงูุฑุณูู ุงูุชููุงุฆู
- ุชุญุณุจ ุชููุงุฆูุงู ุจูุงุกู ุนูู ุนุฏุฏ ุฃุดุฌุงุฑ ุงูุนููู
- ูุง ุญุงุฌุฉ ูุญุณุงุจุงุช ูุฏููุฉ
- ุฏูููุฉ ููุฑุจูุทุฉ ุจุงูุญุฌุฒ ุงููุนูู

### ๐ ุงูุฃูุงู
- ุฌููุน ุงูุฏูุงู SECURITY DEFINER
- ุชุชุญูู ูู ูููุฉ ุงููุณุชุฎุฏู
- ุชุชุญูู ูู ุงูุตูุงุญูุงุช
- ูุง ูููู ููุนููู ุฑุคูุฉ ุจูุงูุงุช ูุฒุงุฑุน ุฃุฎุฑู

### ๐ ุงูุดูุงููุฉ
- ุงูุนููู ูุฑู ูู ุดูุก ูุชุนูู ุจุฃุดุฌุงุฑู
- ุชูุซูู ุจุตุฑู ูุงูู
- ุชูุงุตูู ุงููุฑุงุญู
- ุฑุณูู ูุงุถุญุฉ ููุญุณูุจุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

### ููุชุญุณูู ุงููุณุชูุจูู:
1. ุฅุถุงูุฉ ูุธุงู ุฅุดุนุงุฑุงุช ุนูุฏ ูุดุฑ ุณุฌูุงุช ุฌุฏูุฏุฉ
2. ุฅุถุงูุฉ ุฎุงุตูุฉ ุชูุฒูู ุงูุชูุงุฑูุฑ
3. ุฅุถุงูุฉ ุชููููุงุช ููุตูุงูุฉ ูู ุงูุนููุงุก
4. ุฅุถุงูุฉ ุฌุฏูู ุฒููู ููุตูุงูุฉ ุงููุงุฏูุฉ

---

## ๐ ููุงุญุธุงุช ูููุทูุฑูู

### ุนูุฏ ุฅุถุงูุฉ ููุฏูุง ุฌุฏูุฏุฉ:
```typescript
// ุงููููุงุช ุชููู ูุฑุฆูุฉ ุชููุงุฆูุงู
visible_to_client: true // ุงูุชุฑุงุถู
```

### ุนูุฏ ุฅูุดุงุก ุฑุณูู:
```typescript
// ุงูุฑุณูู ุชููู ูุดุทุฉ ุชููุงุฆูุงู
fees_status: 'active' // ุงูุชุฑุงุถู
```

### ููุชุญูู ูู ุงูุฑุคูุฉ:
```sql
-- ุฅุฎูุงุก ููุฏูุง ูุนููุฉ
UPDATE maintenance_media
SET visible_to_client = false
WHERE id = 'xxx';

-- ุชุนุทูู ุฑุณูู ูุนููุฉ
UPDATE maintenance_fees
SET fees_status = 'inactive'
WHERE id = 'xxx';
```

---

## โ ุญุงูุฉ ุงูุชูููุฐ

| ุงููููุฉ | ุงูุญุงูุฉ |
|--------|--------|
| ุฅุถุงูุฉ visible_to_client | โ ููุชูู |
| ุฅุถุงูุฉ fees_status | โ ููุชูู |
| ุชุญุฏูุซ ุงูุฎุฏูุงุช | โ ููุชูู |
| ุฅูุดุงุก ุงูุฏูุงู | โ ููุชูู |
| ุชุญุฏูุซ ุงููุงุฌูุฉ | โ ููุชูู |
| ุงูุงุฎุชุจุงุฑ | โ ููุชูู |
| ุงูุชูุซูู | โ ููุชูู |

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

**ุงูุฑุจุท ุจูู ูุณู ุงูุชุดุบูู ููุงุฌูุฉ "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก" ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

ุงูุจูุงูุงุช ุชุชุฏูู ุจุณูุงุณุฉ:
- ุงูุฅุฏุงุฑุฉ ุชุฏุฎู โ ุงููุธุงู ูุนุงูุฌ โ ุงูุนููู ูุฑู
- ุตูุฑ ุชุฏุฎู ูุฏูู
- ุตูุฑ ุฃุฎุทุงุก ุญุณุงุจูุฉ
- 100% ุดูุงููุฉ
