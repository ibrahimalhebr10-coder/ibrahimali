# ุฅุตูุงุญ ูุนูุงุฑู ุดุงูู - ููุญุฉ ุงูุชุณุฌูู ุจุนุฏ ุงูุญุฌุฒ

## ุงูุชุงุฑูุฎ: 2026-02-03
## ุงูุญุงูุฉ: โ ููุชูู

---

## ๐ฏ ุงููุดููุฉ ุงูุฃุตููุฉ

### ุงูุฃุนุฑุงุถ:
1. ููุญุฉ ุงูุชุณุฌูู ุจุนุฏ ุงูุญุฌุฒ ูุง ุชุชูุงูู ูุน ุงููุธุงู ุงูุฌุฏูุฏ
2. ุงูุญุณุงุจ ูููุดุฃ ููู ุงูุญุฌุฒ ูุง ููุฑุจุท ุจู
3. ุงูุญุฌูุฒุงุช ูุง ุชุธูุฑ ูู "ุญุณุงุจู"
4. `identity/context` ูุง ูุชู ุชุญุฏูุซู

### ุงูุณุจุจ ุงูุฌุฐุฑู:
```typescript
// ุงูููุฏ ุงููุฏูู ูู PrePaymentRegistration
if (authData.user) {
  onSuccess(authData.user.id, formData.fullName);
}
// โ ูุง ูุชู ุชุญุฏูุซ identity
// โ ูุง ูุชู ุฑุจุท ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ
// โ ูุง ูุชู ุงูุชุญูู ูู ุงูุฌูุณุฉ ุงูุญุงููุฉ
```

---

## โ ุงูุญู ุงููุนูุงุฑู

### 1๏ธโฃ ุงูุชุญูู ูู ุงูุฌูุณุฉ ุฃููุงู

**ูุจู:**
```typescript
if (user) {
  return null; // โ ูุฎูู ุงููููู ููุท
}
```

**ุจุนุฏ:**
```typescript
useEffect(() => {
  const checkExistingSession = async () => {
    if (user) {
      console.log('โ ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ุจุงููุนู:', user.id);

      // ุชุญุฏูุซ ุงููููุฉ
      await updateUserIdentity(user.id);

      // ุฑุจุท ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ
      await linkTemporaryReservation(user.id);

      // ุงูุงูุชูุงู ููุฏูุน ูุจุงุดุฑุฉ
      onSuccess(user.id, userName);
    }
  };
  checkExistingSession();
}, [user]);
```

โ **ุงููุงุฆุฏุฉ:**
- ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎููุ ูุง ุญุงุฌุฉ ููุชุณุฌูู ูุฑุฉ ุฃุฎุฑู
- ุงูุงูุชูุงู ูุจุงุดุฑุฉ ูุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน
- ุชุญุฏูุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู

---

### 2๏ธโฃ ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู (Identity/Context)

```typescript
const updateUserIdentity = async (userId: string) => {
  console.log('๐ ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู...');
  console.log('๐ farmCategory:', farmCategory); // 'investment' ุฃู 'agricultural'

  // ุชุญุฏูุฏ ุงูุญูู ุงูููุงุณุจ
  const identityField = farmCategory === 'investment'
    ? 'secondary_identity'  // ููุงุณุชุซูุงุฑ
    : 'primary_identity';   // ููุฒุฑุงุนุฉ

  const updateData = {
    [identityField]: farmCategory === 'investment' ? 'investor' : 'farmer'
  };

  // ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const { error } = await supabase
    .from('user_profiles')
    .update(updateData)
    .eq('id', userId);

  if (!error) {
    console.log('โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู ุจูุฌุงุญ!');
  }
};
```

โ **ุงููุงุฆุฏุฉ:**
- ุงููุณุชุฎุฏู ูุธูุฑ ุจุงููููุฉ ุงูุตุญูุญุฉ ูู "ุญุณุงุจู"
- ูููู ุฃู ูููู ูุฏูู ูููุชูู (ูุฒุงุฑุน ููุณุชุซูุฑ)
- ุงููุธุงู ูุนุฑู context ูู ุญุฌุฒ

---

### 3๏ธโฃ ุฑุจุท ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ

```typescript
const linkTemporaryReservation = async (userId: string) => {
  if (!guestId) {
    console.log('โน๏ธ ูุง ููุฌุฏ ุญุฌุฒ ูุคูุช ููุฑุจุท');
    return;
  }

  console.log('๐ ุฑุจุท ุงูุญุฌุฒ ุงููุคูุช:', guestId);

  // ุงูุจุญุซ ุนู ุงูุญุฌุฒ ุงููุคูุช
  const { data: tempReservation } = await supabase
    .from('reservations')
    .select('*')
    .eq('guest_id', guestId)
    .eq('status', 'temporary')
    .maybeSingle();

  if (tempReservation) {
    // ุฑุจุท ุงูุญุฌุฒ ุจุงููุณุชุฎุฏู
    await supabase
      .from('reservations')
      .update({
        user_id: userId,          // โ ุฑุจุท ุจุงููุณุชุฎุฏู
        guest_id: null,           // โ ุฅุฒุงูุฉ guest_id
        status: 'confirmed',      // โ ุชุฃููุฏ ุงูุญุฌุฒ
        temporary_expires_at: null // โ ุฅุฒุงูุฉ ุงูุชูุงุก ุงูุตูุงุญูุฉ
      })
      .eq('id', tempReservation.id);

    console.log('โ ุชู ุฑุจุท ุงูุญุฌุฒ ุงููุคูุช ุจุงููุณุชุฎุฏู!');
  }
};
```

โ **ุงููุงุฆุฏุฉ:**
- ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ ูุง ุชุถูุน
- ุชูุฑุจุท ุชููุงุฆูุงู ุจุงูุญุณุงุจ ุงูุฌุฏูุฏ
- ุงูุญุงูุฉ ุชูุญุฏูุซ ุฅูู `confirmed`

---

### 4๏ธโฃ ุฏุนู farmCategory

**ูุงุฌูุฉ ุงููููู:**
```typescript
interface PrePaymentRegistrationProps {
  farmName: string;
  treeCount: number;
  farmCategory: 'agricultural' | 'investment'; // โ NEW
  guestId?: string;                            // โ NEW
  onSuccess: (userId: string, userName: string) => void;
  onBack?: () => void;
}
```

**ูู InvestmentFarmPage:**
```typescript
<PrePaymentRegistration
  farmName={farm.name}
  treeCount={treeCount}
  farmCategory="investment"  // โ ููุงุณุชุซูุงุฑ
  onSuccess={handleRegistrationSuccess}
  onBack={() => setShowPrePaymentRegistration(false)}
/>
```

**ูู AgriculturalFarmPage:**
```typescript
<PrePaymentRegistration
  farmName={farm.name}
  treeCount={treeCount}
  farmCategory="agricultural"  // โ ููุฒุฑุงุนุฉ
  onSuccess={handleRegistrationSuccess}
  onBack={() => setShowPrePaymentRegistration(false)}
/>
```

โ **ุงููุงุฆุฏุฉ:**
- ุงููุธุงู ูุนุฑู ููุน ุงูุญุฌุฒ
- ูุญุฏุซ ุงูุญูู ุงูุตุญูุญ ูู `user_profiles`
- ูุฏุนู ููุง ุงูููุทูู

---

### 5๏ธโฃ ุชุญุฏูุซ handleSubmit (ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ)

```typescript
const handleSubmit = async (e: React.FormEvent) => {
  e.preventDefault();
  if (!validateForm()) return;

  setLoading(true);

  try {
    console.log('๐ ุจุฏุก ุฅูุดุงุก ุงูุญุณุงุจ...');
    console.log('๐ Phone:', phoneNumber);
    console.log('๐ Category:', farmCategory);

    // ุฅูุดุงุก ุงูุญุณุงุจ
    const { data: authData, error: signUpError } = await supabase.auth.signUp({
      email: `${phoneNumber}@investor.harvest.local`,
      password: formData.password,
      options: {
        data: {
          full_name: formData.fullName,
          phone_number: phoneNumber,
          user_type: 'investor'
        }
      }
    });

    if (signUpError) {
      // ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
      return;
    }

    if (authData.user) {
      console.log('โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ! User ID:', authData.user.id);

      // ุชุญุฏูุซ ุงููููุฉ
      await updateUserIdentity(authData.user.id);

      // ุฑุจุท ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ
      await linkTemporaryReservation(authData.user.id);

      console.log('โ ุงูุชุณุฌูู ููุชูู! ุงูุงูุชูุงู ููุฏูุน...');
      onSuccess(authData.user.id, formData.fullName);
    }
  } catch (err) {
    console.error('โ ุฎุทุฃ:', err);
  }
};
```

โ **ุงููุงุฆุฏุฉ:**
- ุนูููุฉ ููุญุฏุฉ ููู ูู ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ ูุงูููุฌูุฏุฉ
- Logging ููุตู ููู ุฎุทูุฉ
- Error handling ุดุงูู

---

## ๐ ุฏูุฑุฉ ุงูุญุฌุฒ ุงููุงููุฉ (ุจุนุฏ ุงูุฅุตูุงุญ)

### ุณููุงุฑูู 1: ูุณุชุฎุฏู ุฌุฏูุฏ

```
1๏ธโฃ ุงููุณุชุฎุฏู ูุญุฌุฒ ุฃุดุฌุงุฑ
   Console: ๐ณ ุงุฎุชุงุฑ 50 ุดุฌุฑุฉ ูู "ูุฒุฑุนุฉ ุงูุฒูุชูู"

2๏ธโฃ ูุถุบุท "ุงุญุฌุฒ ุงูุขู"
   System: ููุญุต ุงูุฌูุณุฉ โ ูุง ููุฌุฏ ูุณุชุฎุฏู
   UI: ูุนุฑุถ PrePaymentRegistration

3๏ธโฃ ูููุฃ ุงูุจูุงูุงุช ููุถุบุท "ูุชุญ ุญุณุงุจู"
   Console: ๐ ุจุฏุก ุฅูุดุงุก ุงูุญุณุงุจ...
   Console: ๐ Phone: 0501234567
   Console: ๐ Category: investment
   Database: INSERT INTO auth.users (...)
   Console: โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ! User ID: abc-123

4๏ธโฃ ุชุญุฏูุซ ุงููููุฉ ุชููุงุฆูุงู
   Console: ๐ ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู...
   Console: ๐ ุชุญุฏูุซ: secondary_identity = investor
   Database: UPDATE user_profiles SET secondary_identity = 'investor'
   Console: โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู ุจูุฌุงุญ!

5๏ธโฃ ุฑุจุท ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ (ุฅู ูุฌุฏุช)
   Console: ๐ ุฑุจุท ุงูุญุฌุฒ ุงููุคูุช: guest-xyz-789
   Database: UPDATE reservations SET user_id = 'abc-123', status = 'confirmed'
   Console: โ ุชู ุฑุจุท ุงูุญุฌุฒ ุงููุคูุช ุจุงููุณุชุฎุฏู!

6๏ธโฃ ุงูุงูุชูุงู ูุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน
   Console: โ ุงูุชุณุฌูู ููุชูู! ุงูุงูุชูุงู ููุฏูุน...
   UI: ูุนุฑุถ PaymentMethodSelector

7๏ธโฃ ูุฎุชุงุฑ ุทุฑููุฉ ุงูุฏูุน
   Console: ๐ฐ ุจุฏุก ุฅูุดุงุก ุงูุญุฌุฒ...
   Database: INSERT INTO reservations (..., status = 'pending')
   Console: โ ุชู ุฅูุดุงุก ุงูุญุฌุฒ! ID: xyz-789

8๏ธโฃ ุชุฃููุฏ ุงูุญุฌุฒ
   Console: ๐ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู confirmed...
   Database: UPDATE reservations SET status = 'confirmed'
   Console: โ ุชู ุชุฃููุฏ ุงูุญุฌุฒ ุจูุฌุงุญ!
   UI: ูุนุฑุถ PaymentSuccessScreen

9๏ธโฃ ุงูุงูุชูุงู ุฅูู "ุญุณุงุจู"
   Console: ๐ ุจุฏุก ุชุญููู ุงูุญุฌูุฒุงุช...
   Database: SELECT * FROM reservations WHERE user_id = 'abc-123' AND status IN ('confirmed', 'completed')
   Console: โ ุชู ุงูุนุซูุฑ ุนูู 1 ุญุฌุฒ
   UI: โ ูุนุฑุถ ุงูุญุฌุฒ ูู "ุชุงุจุน ูุฒุฑุนุชู"
```

---

### ุณููุงุฑูู 2: ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู ุจุงููุนู

```
1๏ธโฃ ุงููุณุชุฎุฏู ูุญุฌุฒ ุฃุดุฌุงุฑ
   Console: ๐ณ ุงุฎุชุงุฑ 50 ุดุฌุฑุฉ ูู "ูุฒุฑุนุฉ ุงูุฒูุชูู"

2๏ธโฃ ูุถุบุท "ุงุญุฌุฒ ุงูุขู"
   System: ููุญุต ุงูุฌูุณุฉ โ ููุฌุฏ ูุณุชุฎุฏู! โ
   Console: โ ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ุจุงููุนู: abc-123

3๏ธโฃ ุชุญุฏูุซ ุงููููุฉ ุชููุงุฆูุงู
   Console: ๐ ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู...
   Console: ๐ ุชุญุฏูุซ: secondary_identity = investor
   Console: โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู ุจูุฌุงุญ!

4๏ธโฃ ุงูุงูุชูุงู ูุจุงุดุฑุฉ ูุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุฏูุน
   Console: ๐ ุชุฎุทู ุงูุชุณุฌูู ูุงููุชุงุจุนุฉ ููุฏูุน...
   UI: ูุนุฑุถ PaymentMethodSelector ูุจุงุดุฑุฉ (ุจุฏูู ุงูุชุณุฌูู!)

5๏ธโฃ ูุฎุชุงุฑ ุทุฑููุฉ ุงูุฏูุน โ ุฅูุดุงุก ุงูุญุฌุฒ โ ุชุฃููุฏ โ "ุญุณุงุจู"
   (ููุณ ุงูุฎุทูุงุช 7-9 ูู ุงูุณููุงุฑูู 1)
```

---

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ

### ูุจู ุงูุฅุตูุงุญ:
```
โ ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู โ ูุฑู ูููุฐุฌ ุงูุชุณุฌูู
โ ูุณุฌู ุญุณุงุจ ุฌุฏูุฏ โ identity ูุง ููุญุฏูุซ
โ ุญุฌูุฒุงุช ูุคูุชุฉ ูุง ุชูุฑุจุท
โ ุงูุญุฌุฒ ูููุดุฃ ููู ูุง ูุธูุฑ ูู "ุญุณุงุจู"
โ ูุง ููุฌุฏ logging ูุงุถุญ
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
โ ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู โ ููุชูู ูุจุงุดุฑุฉ ููุฏูุน
โ ูุณุฌู ุญุณุงุจ ุฌุฏูุฏ โ identity ููุญุฏูุซ ุชููุงุฆูุงู
โ ุญุฌูุฒุงุช ูุคูุชุฉ ุชูุฑุจุท ุชููุงุฆูุงู
โ ุงูุญุฌุฒ ูููุดุฃ ููุธูุฑ ูู "ุญุณุงุจู" ููุฑุงู
โ logging ููุตู ููู ุฎุทูุฉ
```

---

## ๐งช ุทุฑููุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ูุณุชุฎุฏู ุฌุฏูุฏ (Signup Flow)

```bash
1. ุงูุชุญ Console (F12)
2. ุงุฐูุจ ูุฃู ูุฒุฑุนุฉ (ุฒุฑุงุนูุฉ ุฃู ุงุณุชุซูุงุฑูุฉ)
3. ุงุฎุชุฑ ุนุฏุฏ ุงูุฃุดุฌุงุฑ ูุงูุจุงูุฉ
4. ุงุถุบุท "ุงุญุฌุฒ ุงูุขู"
5. ุงููุฃ ุจูุงูุงุช ุงูุชุณุฌูู (ุฑูู ุฌูุงู ุฌุฏูุฏ)
6. ุงุถุบุท "ูุชุญ ุญุณุงุจู ูุงููุชุงุจุนุฉ ููุฏูุน"
7. ุฑุงูุจ Console - ูุฌุจ ุฃู ุชุฑู:
   โ ๐ ุจุฏุก ุฅูุดุงุก ุงูุญุณุงุจ...
   โ โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ!
   โ ๐ ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู...
   โ โ ุชู ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู ุจูุฌุงุญ!
   โ โ ุงูุชุณุฌูู ููุชูู!
8. ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน
9. ุฑุงูุจ Console - ูุฌุจ ุฃู ุชุฑู:
   โ ๐ฐ ุจุฏุก ุฅูุดุงุก ุงูุญุฌุฒ...
   โ โ ุชู ุฅูุดุงุก ุงูุญุฌุฒ!
   โ ๐ ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู confirmed...
   โ โ ุชู ุชุฃููุฏ ุงูุญุฌุฒ ุจูุฌุงุญ!
10. ุงุถุบุท "ุงุฐูุจ ูุญุณุงุจู"
11. ุงุถุบุท "ุชุงุจุน ูุฒุฑุนุชู"
12. โ ูุฌุจ ุฃู ุชุฑู ุงูุญุฌุฒ ูุจุงุดุฑุฉ!
```

### ุงุฎุชุจุงุฑ 2: ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู (Skip Registration)

```bash
1. ุงูุชุญ Console (F12)
2. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ููุฌูุฏ
3. ุงุฐูุจ ูุฃู ูุฒุฑุนุฉ (ุฒุฑุงุนูุฉ ุฃู ุงุณุชุซูุงุฑูุฉ)
4. ุงุฎุชุฑ ุนุฏุฏ ุงูุฃุดุฌุงุฑ ูุงูุจุงูุฉ
5. ุงุถุบุท "ุงุญุฌุฒ ุงูุขู"
6. ุฑุงูุจ Console - ูุฌุจ ุฃู ุชุฑู:
   โ โ ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ุจุงููุนู
   โ ๐ ุชุญุฏูุซ ูููุฉ ุงููุณุชุฎุฏู...
   โ ๐ ุชุฎุทู ุงูุชุณุฌูู ูุงููุชุงุจุนุฉ ููุฏูุน...
7. โ ูุฌุจ ุฃู ุชุธูุฑ ุดุงุดุฉ ุงุฎุชูุงุฑ ุงูุฏูุน ูุจุงุดุฑุฉ (ุจุฏูู ุงูุชุณุฌูู!)
8. ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน โ ุชุฃูุฏ ูู ุฅูุดุงุก ุงูุญุฌุฒ
9. ุงุฐูุจ ูู "ุญุณุงุจู" โ "ุชุงุจุน ูุฒุฑุนุชู"
10. โ ูุฌุจ ุฃู ุชุฑู ุงูุญุฌุฒ ูุจุงุดุฑุฉ!
```

### ุงุฎุชุจุงุฑ 3: ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ุงูุชุญูู ูู ุชุญุฏูุซ identity
SELECT
  id,
  full_name,
  primary_identity,
  secondary_identity
FROM user_profiles
WHERE phone_number = '0501234567'; -- ุงุณุชุจุฏู ุจุฑูู ุงูุฌูุงู ุงููุณุชุฎุฏู ูู ุงูุงุฎุชุจุงุฑ

-- ุงููุชูุฌุฉ ุงููุชููุนุฉ ูููุณุชุฎุฏู ุงูุงุณุชุซูุงุฑู:
-- primary_identity: NULL ุฃู 'farmer' (ุฅุฐุง ุณุจู ูู ุงูุญุฌุฒ ุงูุฒุฑุงุนู)
-- secondary_identity: 'investor' โ

-- ุงูุชุญูู ูู ุงูุญุฌูุฒุงุช ุงููุคูุฏุฉ
SELECT
  id,
  user_id,
  farm_name,
  total_trees,
  total_price,
  status,
  created_at
FROM reservations
WHERE user_id = 'abc-123' -- ุงุณุชุจุฏู ุจู user_id ุงููุนูู
ORDER BY created_at DESC;

-- ุงููุชูุฌุฉ ุงููุชููุนุฉ:
-- status: 'confirmed' โ
-- user_id: ููุณ NULL โ
-- guest_id: NULL โ
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. PrePaymentRegistration.tsx

**ุงูุชุบููุฑุงุช:**
- โ ุฅุถุงูุฉ `farmCategory` ู `guestId` props
- โ ุฅุถุงูุฉ `useEffect` ููุชุญูู ูู ุงูุฌูุณุฉ
- โ ุฅุถุงูุฉ ุฏุงูุฉ `updateUserIdentity`
- โ ุฅุถุงูุฉ ุฏุงูุฉ `linkTemporaryReservation`
- โ ุชุญุฏูุซ `handleSubmit` ูุงุณุชุฏุนุงุก ุงูุฏูุงู ุงูุฌุฏูุฏุฉ
- โ ุฅุถุงูุฉ ุดุงุดุฉ ุชุญููู ูููุณุชุฎุฏููู ุงููุณุฌููู
- โ ุฅุถุงูุฉ logging ููุตู

### 2. InvestmentFarmPage.tsx

**ุงูุชุบููุฑุงุช:**
- โ ุชูุฑูุฑ `farmCategory="investment"` ุฅูู PrePaymentRegistration

### 3. AgriculturalFarmPage.tsx

**ุงูุชุบููุฑุงุช:**
- โ ุชูุฑูุฑ `farmCategory="agricultural"` ุฅูู PrePaymentRegistration

---

## ๐ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

### 1. ุฃูููุฉ ุงูุชุญูู ูู ุงูุฌูุณุฉ ุฃููุงู
```typescript
// โ ุณูุก - ูุฎูู ุงููููู ููุท
if (user) return null;

// โ ุฌูุฏ - ูุณุชุฎุฏู ุงูุฌูุณุฉ ุงูููุฌูุฏุฉ
useEffect(() => {
  if (user) {
    // ุชุญุฏูุซ ุงูุจูุงูุงุช ูุงููุชุงุจุนุฉ
  }
}, [user]);
```

### 2. ุฃูููุฉ ุชุญุฏูุซ Context/Identity
```typescript
// โ ุณูุก - ูุง ูุญูุธ ุงูุณูุงู
await createUser(data);

// โ ุฌูุฏ - ูุญูุธ ุงูุณูุงู
await createUser(data);
await updateIdentity(userId, farmCategory);
```

### 3. ุฃูููุฉ ุฑุจุท ุงูุจูุงูุงุช ุงููุคูุชุฉ
```typescript
// โ ุณูุก - ุงูุจูุงูุงุช ุงููุคูุชุฉ ุชุถูุน
// ูุง ููุฌุฏ ููุฏ ูุฑุจุท ุงูุญุฌูุฒุงุช

// โ ุฌูุฏ - ุฑุจุท ุชููุงุฆู
await linkTemporaryReservation(userId, guestId);
```

### 4. ุฃูููุฉ UX ุงูุณูุณุฉ
```typescript
// โ ุณูุก - ูุทูุจ ุงูุชุณุฌูู ูู ูุณุชุฎุฏู ูุณุฌู ุฏุฎูู
if (!user) showRegistration();

// โ ุฌูุฏ - ูุชุฎุทู ุงูุฎุทูุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ
if (user) {
  goDirectlyToPayment();
} else {
  showRegistration();
}
```

---

## โ ูุนุงููุฑ ุงููุฌุงุญ

### โ 1. ุชุฎุทู ุงูุชุณุฌูู ูููุณุชุฎุฏููู ุงููุณุฌููู
```
ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู โ ูุถุบุท "ุงุญุฌุฒ ุงูุขู" โ ุดุงุดุฉ ุงูุฏูุน ูุจุงุดุฑุฉ
```

### โ 2. ุชุญุฏูุซ Identity ุชููุงุฆูุงู
```
ุงููุณุชุฎุฏู ูุณุฌู โ identity ููุญุฏูุซ โ ูุธูุฑ ูู "ุญุณุงุจู" ุจุงููููุฉ ุงูุตุญูุญุฉ
```

### โ 3. ุฑุจุท ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ
```
ุญุฌุฒ ูุคูุช โ ุชุณุฌูู โ ุงูุญุฌุฒ ููุฑุจุท ุจุงูุญุณุงุจ ุชููุงุฆูุงู
```

### โ 4. ุธููุฑ ุงูุญุฌูุฒุงุช ูู "ุญุณุงุจู"
```
ุญุฌุฒ โ ุฏูุน โ "ุญุณุงุจู" โ ุงูุญุฌุฒ ูุธูุฑ ูุจุงุดุฑุฉ
```

### โ 5. Logging ุดุงูู
```
ูู ุฎุทูุฉ โ ุฑุณุงูุฉ ูู Console โ ุณูููุฉ ุงูุชุดุฎูุต
```

---

## ๐ ูุง ุงูุชุงููุ

ุงูุขู ุจุนุฏ ุฅุตูุงุญ ุฏูุฑุฉ ุงูุญุฌุฒ ูุงูุชุณุฌูู ุจุงููุงูู:

### โ ุชู ุฅูุฌุงุฒู:
1. โ ุฅุตูุงุญ Database Constraint (confirmed/completed)
2. โ ุชุญุฏูุซ ุฌููุน ุงูุญุฌูุฒุงุช ุงูุญุงููุฉ
3. โ ุฅุตูุงุญ ููุญุฉ ุงูุชุณุฌูู
4. โ ุฏุนู farmCategory
5. โ ุฑุจุท ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ
6. โ ุชุญุฏูุซ Identity/Context
7. โ Logging ููุตู

### ๐ฏ ุฌุงูุฒ ููุฅูุชุงุฌ:
- ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ โ ูุณุฌููู ููุญุฌุฒูู ููุฑูู ุญุฌูุฒุงุชูู โ
- ุงููุณุชุฎุฏููู ุงูุญุงูููู โ ูุญุฌุฒูู ููุฑูู ุญุฌูุฒุงุชูู โ
- ุงูุญุฌูุฒุงุช ุงููุคูุชุฉ โ ุชูุฑุจุท ุชููุงุฆูุงู โ
- Identity/Context โ ููุญุฏูุซ ุชููุงุฆูุงู โ

---

**ุงููุธุงู ุงูุขู ุณููู ูุธูููุงู 100%!** โโโ

ุชุงุฑูุฎ ุงูุฅููุงู: 2026-02-03
ุงูุญุงูุฉ: โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงูุฅูุชุงุฌ
