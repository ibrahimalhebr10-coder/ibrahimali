# ูุธุงู ุงูุฃุฑุดูุฉ ูุงูุญุฐู ุงููุงูู

ุชู ุชุทุจูู ูุธุงู ูุชูุงูู ูุขูู ูุฃุฑุดูุฉ ูุญุฐู ุงูุจูุงูุงุช ุงููุงููุฉ ูููุฒุงุฑุน.

## ๐ฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### 1๏ธโฃ ูุธุงู ุงูุฃุฑุดูุฉ ุงูุฐูู
- **ุญูุธ ููุทุฉ ูุงููุฉ** ูู ุฌููุน ุงูุจูุงูุงุช ุงููุงููุฉ
- **ุฎูุงุฑ ุงูุชุตููุฑ ุงูุงุฎุชูุงุฑู** ุจุนุฏ ุงูุฃุฑุดูุฉ
- **ููุงุญุธุงุช ูุฎุตุตุฉ** ููู ุฃุฑุดูู
- **ุชุฎุฒูู ุขูู** ููุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ

### 2๏ธโฃ ูุธุงู ุงูุญุฐู ุงูููุงุฆู ุงููุญูู
- **ุชุฃููุฏ ูุฒุฏูุฌ** ุจููุฏ ูุฑูุฏ ููู ูุฒุฑุนุฉ
- **ุณุจุจ ุฅูุฒุงูู** ููุญุฐู
- **ุณุฌู ุชุฏููู ูุงูู** ูุฌููุน ุนูููุงุช ุงูุญุฐู
- **ูุง ูููู ุงูุชุฑุงุฌุน** (ุญูุงูุฉ ูุตูู)

### 3๏ธโฃ ุณุฌู ุงูุชุฏููู ุงูุดุงูู
- ุชุณุฌูู ุชููุงุฆู ูุฌููุน ุงูุนูููุงุช
- ุชูุงุตูู ูุงููุฉ ููุนูููุงุช
- ูุนูููุงุช ุงููุณุคูู ุงูุฐู ูุงู ุจุงูุนูููุฉ
- ุชุงุฑูุฎ ูููุช ูู ุนูููุฉ

---

## ๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ

#### 1. `farm_financial_archives`
ุชุฎุฒูู ุงูุฃุฑุดููุงุช ุงููุงููุฉ:
- `id` - ูุนุฑู ูุฑูุฏ
- `farm_id` - ูุนุฑู ุงููุฒุฑุนุฉ
- `archive_name` - ุงุณู ุงูุฃุฑุดูู
- `archive_period_start` - ุจุฏุงูุฉ ุงููุชุฑุฉ
- `archive_period_end` - ููุงูุฉ ุงููุชุฑุฉ
- `total_income` - ุฅุฌูุงูู ุงูุฏุฎู
- `total_expenses` - ุฅุฌูุงูู ุงููุตุฑููุงุช
- `final_balance` - ุงูุฑุตูุฏ ุงูููุงุฆู
- `transactions_snapshot` - ููุทุฉ ุงูุนูููุงุช (JSON)
- `transfers_snapshot` - ููุทุฉ ุงูุชุญูููุงุช (JSON)
- `archived_by` - ุงููุณุคูู
- `archived_at` - ุชุงุฑูุฎ ุงูุฃุฑุดูุฉ
- `notes` - ููุงุญุธุงุช

#### 2. `farm_finance_audit_log`
ุณุฌู ุชุฏููู ุงูุนูููุงุช ุงููุงููุฉ:
- `id` - ูุนุฑู ูุฑูุฏ
- `farm_id` - ูุนุฑู ุงููุฒุฑุนุฉ
- `operation_type` - ููุน ุงูุนูููุฉ (archive/delete/restore/transfer)
- `operation_details` - ุชูุงุตูู ุงูุนูููุฉ (JSON)
- `performed_by` - ุงููุณุคูู
- `performed_at` - ุชุงุฑูุฎ ุงูุนูููุฉ

---

## ๐ง ุงูุฏูุงู (Functions)

### 1. `archive_farm_finances()`
**ุงููุตู:** ุฅูุดุงุก ุฃุฑุดูู ููุจูุงูุงุช ุงููุงููุฉ

**ุงููุนุงููุงุช:**
- `p_farm_id` (uuid) - ูุนุฑู ุงููุฒุฑุนุฉ
- `p_archive_name` (text) - ุงุณู ุงูุฃุฑุดูู
- `p_clear_current` (boolean) - ุชุตููุฑ ุงูุจูุงูุงุช ุจุนุฏ ุงูุฃุฑุดูุฉ
- `p_notes` (text) - ููุงุญุธุงุช ุงุฎุชูุงุฑูุฉ

**ุงูุฅุฑุฌุงุน:**
```json
{
  "success": true,
  "archive_id": "uuid",
  "archive_name": "Q1 2024",
  "total_income": 150000,
  "total_expenses": 80000,
  "final_balance": 70000,
  "transactions_archived": 45,
  "transfers_archived": 3,
  "cleared": true
}
```

**ุงูุฃูุงู:**
- ูุญูุธ ููุทุฉ ูุงููุฉ ูุจู ุฃู ุชุตููุฑ
- ูุณุฌู ุงูุนูููุฉ ูู ุณุฌู ุงูุชุฏููู
- ูุชุทูุจ ุตูุงุญูุงุช ูุฏูุฑ

---

### 2. `delete_farm_finances_permanently()`
**ุงููุตู:** ุญุฐู ููุงุฆู ููุจูุงูุงุช ุงููุงููุฉ (ุฎุทูุฑ!)

**ุงููุนุงููุงุช:**
- `p_farm_id` (uuid) - ูุนุฑู ุงููุฒุฑุนุฉ
- `p_confirmation_code` (text) - ููุฏ ุงูุชุฃููุฏ
- `p_admin_reason` (text) - ุณุจุจ ุงูุญุฐู

**ููุฏ ุงูุชุฃููุฏ:**
```
{ุฃูู 8 ุฃุญุฑู ูู farm_id}DELETE
ูุซุงู: 12ab34cdDELETE
```

**ุงูุฅุฑุฌุงุน:**
```json
{
  "success": true,
  "transactions_deleted": 45,
  "transfers_deleted": 3,
  "message": "ุชู ุงูุญุฐู ุงูููุงุฆู ุจูุฌุงุญ"
}
```

**ุงูุฃูุงู:**
- ูุชุทูุจ ููุฏ ุชุฃููุฏ ุตุญูุญ
- ูุชุทูุจ ุณุจุจ ูุงุถุญ (10 ุฃุญุฑู ุนูู ุงูุฃูู)
- ูุณุฌู ุงูุนูููุฉ ูู ุณุฌู ุงูุชุฏููู ูุจู ุงูุญุฐู
- ูุง ูููู ุงูุชุฑุงุฌุน ุนูู

---

### 3. `get_farm_archives()`
**ุงููุตู:** ุงูุญุตูู ุนูู ูุงุฆูุฉ ุฃุฑุดููุงุช ูุฒุฑุนุฉ

**ุงููุนุงููุงุช:**
- `p_farm_id` (uuid) - ูุนุฑู ุงููุฒุฑุนุฉ

**ุงูุฅุฑุฌุงุน:**
```json
[
  {
    "id": "uuid",
    "archive_name": "Q1 2024",
    "archive_period_start": "2024-01-01",
    "archive_period_end": "2024-03-31",
    "total_income": 150000,
    "total_expenses": 80000,
    "final_balance": 70000,
    "transactions_count": 45,
    "transfers_count": 3,
    "archived_by": "uuid",
    "archived_at": "2024-04-01",
    "notes": "ููุงูุฉ ุงูุฑุจุน ุงูุฃูู"
  }
]
```

---

### 4. `get_archive_details()`
**ุงููุตู:** ุงูุญุตูู ุนูู ุชูุงุตูู ุฃุฑุดูู ูุงูู

**ุงููุนุงููุงุช:**
- `p_archive_id` (uuid) - ูุนุฑู ุงูุฃุฑุดูู

**ุงูุฅุฑุฌุงุน:**
```json
{
  "id": "uuid",
  "farm_id": "uuid",
  "archive_name": "Q1 2024",
  "total_income": 150000,
  "total_expenses": 80000,
  "final_balance": 70000,
  "transactions": [...],
  "transfers": [...],
  "archived_by": "uuid",
  "archived_at": "2024-04-01",
  "notes": "..."
}
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ูููุน ุงูุฃุฒุฑุงุฑ
ูู ุตูุญุฉ **ุงููุงููุฉ > ูุฒุฑุนุฉ ูุนููุฉ**:

1. **ุฒุฑ ุงูุฃุฑุดูุฉ** (ุฃุตูุฑ):
   - ุฃููููุฉ: ๐ฆ Archive
   - ุงููููุน: ุจุฌุงูุจ ุฒุฑ "ุฏูุน ูุงุฆุถ ูุงูู"
   - ุงููุธููุฉ: ูุชุญ ูุงูุฐุฉ ุงูุฃุฑุดูุฉ

2. **ุฒุฑ ุงูุญุฐู ุงูููุงุฆู** (ุฃุญูุฑ):
   - ุฃููููุฉ: ๐๏ธ Trash2
   - ุงููููุน: ุฃูุตู ุงููุณุงุฑ
   - ุงููุธููุฉ: ูุชุญ ูุงูุฐุฉ ุงูุชุญุฐูุฑ ูุงูุญุฐู

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ุณููุงุฑูู 1: ุฃุฑุดูุฉ ููุงูุฉ ุงูุฑุจุน
```
1. ุงูุฐูุงุจ ููุณู ุงููุงููุฉ > ุงุฎุชูุงุฑ ุงููุฒุฑุนุฉ
2. ุงูููุฑ ุนูู ุฒุฑ "ุฃุฑุดูุฉ"
3. ุฅุฏุฎุงู ุงุณู: "ุงูุฑุจุน ุงูุฃูู 2024"
4. ูุชุงุจุฉ ููุงุญุธุงุช: "ููุงูุฉ ุงูุฑุจุน - ุงูุฃุฏุงุก ููุชุงุฒ"
5. ุชูุนูู "ุชุตููุฑ ุงูุจูุงูุงุช" โ
6. ุงูููุฑ ุนูู "ุฃุฑุดูุฉ ุงูุขู"
```

**ุงููุชูุฌุฉ:**
- โ ุญูุธ ููุทุฉ ูุงููุฉ ูู ุงูุฃุฑุดูู
- โ ุชุตููุฑ ุงูุจูุงูุงุช ุงูุญุงููุฉ
- โ ุงูุจุฏุก ุจูุชุฑุฉ ูุงููุฉ ุฌุฏูุฏุฉ

---

### ุณููุงุฑูู 2: ุฃุฑุดูุฉ ุจุฏูู ุชุตููุฑ (ูููุฑุงุฌุนุฉ ููุท)
```
1. ุงูุฐูุงุจ ููุณู ุงููุงููุฉ > ุงุฎุชูุงุฑ ุงููุฒุฑุนุฉ
2. ุงูููุฑ ุนูู ุฒุฑ "ุฃุฑุดูุฉ"
3. ุฅุฏุฎุงู ุงุณู: "ูุฑุงุฌุนุฉ ููุชุตู ุงูุดูุฑ"
4. ุชุฑู "ุชุตููุฑ ุงูุจูุงูุงุช" ูุงุฑุบ
5. ุงูููุฑ ุนูู "ุฃุฑุดูุฉ ุงูุขู"
```

**ุงููุชูุฌุฉ:**
- โ ุญูุธ ููุทุฉ ูู ุงูุฃุฑุดูู
- โ ุงูุจูุงูุงุช ุงูุญุงููุฉ ูู ุชุชุฃุซุฑ
- โ ูููู ุงูููุงุฑูุฉ ูุงุญูุงู

---

### ุณููุงุฑูู 3: ุญุฐู ููุงุฆู (ุญุงูุฉ ุทูุงุฑุฆ)
```
1. ุงูุฐูุงุจ ููุณู ุงููุงููุฉ > ุงุฎุชูุงุฑ ุงููุฒุฑุนุฉ
2. ุงูููุฑ ุนูู ุฒุฑ "ุญุฐู ููุงุฆู"
3. ูุฑุงุกุฉ ุงูุชุญุฐูุฑุงุช ุจุนูุงูุฉ โ๏ธ
4. ูุชุงุจุฉ ุงูุณุจุจ: "ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุฎุงุทุฆุฉ ุชู ุฅุฏุฎุงููุง ุจุงูุฎุทุฃ"
5. ูุณุฎ ููุฏ ุงูุชุฃููุฏ ูู ุงูุดุงุดุฉ
6. ูุตู ุงูููุฏ ูู ุงูุญูู
7. ุงูููุฑ ุนูู "ุญุฐู ููุงุฆู"
```

**ุงููุชูุฌุฉ:**
- โ ุญุฐู ููุงุฆู ูุฌููุน ุงูุจูุงูุงุช
- โ ุชุณุฌูู ูู ุณุฌู ุงูุชุฏููู
- โ ูุง ูููู ุงูุชุฑุงุฌุน

---

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### ุตูุงุญูุงุช RLS
- **ููุท ุงููุฏูุฑูู** ูููููู:
  - ุนุฑุถ ุงูุฃุฑุดููุงุช
  - ุฅูุดุงุก ุฃุฑุดููุงุช ุฌุฏูุฏุฉ
  - ุญุฐู ุงูุจูุงูุงุช ุงููุงููุฉ
  - ุนุฑุถ ุณุฌู ุงูุชุฏููู

### ุขููุงุช ุงูุญูุงูุฉ
1. **ุงูุฃุฑุดูุฉ:**
   - ูุง ูููู ุฃุฑุดูุฉ ุจููุณ ุงูุงุณู ูุฑุชูู
   - ูุชู ุญูุธ ููุทุฉ ูุงููุฉ ูุจู ุฃู ุชุตููุฑ
   - ุชุณุฌูู ุชููุงุฆู ูู ุณุฌู ุงูุชุฏููู

2. **ุงูุญุฐู:**
   - ููุฏ ุชุฃููุฏ ูุฑูุฏ ููู ูุฒุฑุนุฉ
   - ุณุจุจ ุฅูุฒุงูู (10 ุฃุญุฑู ุนูู ุงูุฃูู)
   - ุชุณุฌูู ูู ุณุฌู ุงูุชุฏููู ูุจู ุงูุญุฐู
   - ุชุญุฐูุฑุงุช ูุงุถุญุฉ ูู ุงููุงุฌูุฉ

---

## ๐ ุณุฌู ุงูุชุฏููู

ุฌููุน ุงูุนูููุงุช ูุชู ุชุณุฌูููุง ูู `farm_finance_audit_log`:

```json
{
  "farm_id": "uuid",
  "operation_type": "archive",
  "operation_details": {
    "archive_id": "uuid",
    "archive_name": "Q1 2024",
    "total_income": 150000,
    "total_expenses": 80000,
    "final_balance": 70000,
    "clear_current": true,
    "transactions_count": 45,
    "transfers_count": 3
  },
  "performed_by": "admin_uuid",
  "performed_at": "2024-04-01T10:30:00Z"
}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃุฑุดูุฉ โ ุงููุณุฎ ุงูุงุญุชูุงุทู**
   - ุงูุฃุฑุดูุฉ ุชุญูุธ ุงูุจูุงูุงุช ุฏุงุฎู ุงููุธุงู
   - ุงููุณุฎ ุงูุงุญุชูุงุทู ูุฌุจ ุฃู ูููู ุฎุงุฑุฌู

2. **ุงูุญุฐู ุงูููุงุฆู ุฎุทูุฑ**
   - ุงุณุชุฎุฏูู ููุท ูู ุญุงูุงุช ุงูุทูุงุฑุฆ
   - ููุฑ ูุฑุชูู ูุจู ุงูุญุฐู
   - ุชุฃูุฏ ูู ูุฌูุฏ ุฃุฑุดูู ูุจู ุงูุญุฐู

3. **ุณุฌู ุงูุชุฏููู**
   - ูุง ูููู ุญุฐูู ุฃู ุชุนุฏููู
   - ูุญุชูุธ ุจุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ
   - ูููุฏ ูููุฑุงุฌุนุฉ ูุงูุชุญููู

---

## ๐ฏ ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุฃุฑุดู ุจุงูุชุธุงู:**
   - ููุงูุฉ ูู ุดูุฑ
   - ููุงูุฉ ูู ุฑุจุน
   - ูุจู ุฃู ุชุบููุฑ ูุจูุฑ

2. **ุงุณุชุฎุฏู ุฃุณูุงุก ูุงุถุญุฉ:**
   - โ "ุฃุฑุดูู 1"
   - โ "ููุงูุฑ 2024 - ููุงูุฉ ุงูุดูุฑ"

3. **ุฃุถู ููุงุญุธุงุช:**
   - ุงูุฃุญุฏุงุซ ุงููููุฉ
   - ุงูููุงุญุธุงุช ุงููุงููุฉ
   - ุงููุฑุงุฑุงุช ุงููุชุฎุฐุฉ

4. **ุชุฌูุจ ุงูุญุฐู:**
   - ุงุณุชุฎุฏู ุงูุฃุฑุดูุฉ ุจุฏูุงู ูู ุงูุญุฐู
   - ุงูุญุฐู ููุท ููุญุงูุงุช ุงูุทุงุฑุฆุฉ

---

## โ ุงูุฎูุงุตุฉ

ุชู ุชุทุจูู ูุธุงู ููู ูุขูู ูุฌูุน ุจูู:
- **ุงููุฑููุฉ:** ุฃุฑุดูุฉ ุจุณูุทุฉ ูุณุฑูุนุฉ
- **ุงูุฃูุงู:** ุญูุงูุฉ ูููุฉ ุถุฏ ุงูุญุฐู ุงูุฎุงุทุฆ
- **ุงูุดูุงููุฉ:** ุณุฌู ุชุฏููู ูุงูู
- **ุณูููุฉ ุงูุงุณุชุฎุฏุงู:** ูุงุฌูุฉ ุจุณูุทุฉ ููููููุฉ

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู! ๐
