# ุงููุฑุญูุฉ 1 ูู ูุณู "ูุญุตููู" - ููุชููุฉ โ

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุฌุงุฒ ุงููุฑุญูุฉ ุงูุฃููู ูู ูุณู "ูุญุตููู" ุจูุฌุงุญ. ุงููุธุงู ุงูุขู ูููุฑ:

1. โ ูุงุฆูุฉ ุงููุฒุงุฑุน ุงูููุชููุฉ
2. โ ุตูุญุฉ ุชูุงุตูู ูู ูุฒุฑุนุฉ ูุน 5 ุชุจููุจุงุช
3. โ ูุธุงู ุฅุฏุงุฑุฉ ููุงู ุงูุนูู ูุงูู ุงููุธุงุฆู
4. โ ุงูุชุจููุจุงุช ุงูุฃุฎุฑู ุฌุงูุฒุฉ ููุชูุณุน ุงููุณุชูุจูู

---

## ๐๏ธ ุงููููู ุงูุนุงู

### 1๏ธโฃ ูุงุฆูุฉ ุงููุฒุงุฑุน

**ุงููููู:** `src/components/MyHarvest.tsx`

**ุงููุธููุฉ:**
- ูุนุฑุถ ุฌููุน ุงููุฒุงุฑุน ุงูููุชููุฉ (`status = 'completed'`)
- ูู ูุฒุฑุนุฉ ุชุธูุฑ ูู ุจุทุงูุฉ ูุณุชููุฉ
- ุชุญุชูู ุนูู:
  - ุงุณู ุงููุฒุฑุนุฉ (ุนุฑุจู + ุฅูุฌููุฒู)
  - ุงููููุน
  - ุงููุณุงุญุฉ ุงูุฅุฌูุงููุฉ
  - ุฒุฑ "ุฏุฎูู ุนูู ุงููุฒุฑุนุฉ"

**ุงูุงุณุชุนูุงู:**
```typescript
const { data } = await supabase
  .from('farms')
  .select('*')
  .eq('status', 'completed')
  .order('name_ar');
```

---

### 2๏ธโฃ ุตูุญุฉ ุชูุงุตูู ุงููุฒุฑุนุฉ

**ุงููููู:** `src/components/harvest/FarmDetails.tsx`

**ุงูุชุจููุจุงุช ุงูุฎูุณุฉ:**

| ุงูุชุจููุจ | ุงูุฃููููุฉ | ุงููุตู | ุงูุญุงูุฉ |
|---------|----------|-------|--------|
| ุงูุชุดุบูู | `Play` | ูุนูููุงุช ุงูุชุดุบูู ุงููููู | ููุฏ ุงูุชุทููุฑ |
| ุงูุตูุงูุฉ | `Wrench` | ุฅุฏุงุฑุฉ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ ูุงูุทุงุฑุฆุฉ | ููุฏ ุงูุชุทููุฑ |
| ููุงู ุงูุนูู | `ClipboardList` | ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงู ุงููุงูู | **ููุชูู โ** |
| ุงููุนุฏุงุช | `Truck` | ุฅุฏุงุฑุฉ ุงููุนุฏุงุช ูุงูุขููุงุช | ููุฏ ุงูุชุทููุฑ |
| ุงููุงููุฉ ุงูุชุดุบูููุฉ | `DollarSign` | ุงููุตุฑููุงุช ูุงูุฅูุฑุงุฏุงุช | ููุฏ ุงูุชุทููุฑ |

**ุงูุชููู:**
- ุฒุฑ ุฑุฌูุน โ ุงูุนูุฏุฉ ููุงุฆูุฉ ุงููุฒุงุฑุน
- ุฒุฑ ุฅุบูุงู โ ุฅุบูุงู ุงููุณู ุจุงููุงูู
- ุดุฑูุท ุงูุชุจููุจุงุช ุฃููู ููุงุจู ููุชูุฑูุฑ

---

## ๐ ูุธุงู ููุงู ุงูุนูู (ุงูุชุฑููุฒ ุงูุฃุณุงุณู)

### ุงูุฌุฏูู: `farm_tasks`

```sql
CREATE TABLE farm_tasks (
  id uuid PRIMARY KEY,
  farm_id uuid REFERENCES farms(id),
  task_type text NOT NULL,              -- ููุน ุงูุนูู
  description text NOT NULL,            -- ูุตู ุงููููุฉ
  assigned_to uuid REFERENCES admins(id), -- ุงููููู
  assigned_by uuid REFERENCES admins(id), -- ูู ุฃุณูุฏ ุงููููุฉ
  start_time timestamptz NOT NULL,      -- ููุช ุงูุจุฏุก
  end_time timestamptz,                 -- ููุช ุงูุฅุบูุงู
  duration_minutes integer,             -- ุงููุฏุฉ (ูุญุณูุจุฉ ุชููุงุฆูุงู)
  status text DEFAULT 'pending',        -- pending, in_progress, completed
  notes text,                           -- ููุงุญุธุงุช
  created_at timestamptz,
  updated_at timestamptz
);
```

### ุงูุฎุฏูุฉ: `farmTasksService`

**ุงููููุน:** `src/services/farmTasksService.ts`

**ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:**

```typescript
// ุฅูุดุงุก ูููุฉ ุฌุฏูุฏุฉ
createTask(taskData)

// ุชุญุฏูุซ ูููุฉ
updateTask(taskId, updates)

// ุจุฏุก ูููุฉ
startTask(taskId)

// ุฅุบูุงู ูููุฉ (ูุญุณุจ ุงููุฏุฉ ุชููุงุฆูุงู)
completeTask(taskId, notes?)

// ุญุฐู ูููุฉ
deleteTask(taskId)

// ุฌูุจ ููุงู ูุฒุฑุนุฉ ูุนููุฉ
getFarmTasks(farmId)

// ุฌูุจ ููุงู ุงููุณุชุฎุฏู ุงูุญุงูู
getMyTasks()

// ุงูุชุญูู ูู ุตูุงุญูุฉ ุฅุฏุงุฑุฉ ุงููููุฉ
canManageTask(taskId)
```

### ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูููุงู

**ุงููููู:** `src/components/harvest/TasksTab.tsx`

#### ุนุฑุถ ุงูููุงู

ูู ูููุฉ ุชุนุฑุถ:
- ููุน ุงูุนูู (ุนููุงู ูุจูุฑ)
- ุงููุตู
- ุญุงูุฉ ุงููููุฉ (ูุนููุฉ / ุฌุงุฑูุฉ / ููุชููุฉ)
- ุงุณู ุงููููู
- ููุช ุงูุจุฏุก
- ููุช ุงูุฅุบูุงู (ุฅู ูุฌุฏ)
- ุงููุฏุฉ ุงููุนููุฉ (ูุญุณูุจุฉ ุชููุงุฆูุงู)
- ููุงุญุธุงุช

#### ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ

ูุงูุฐุฉ ููุจุซูุฉ ุชุญุชูู ุนูู:
1. **ููุน ุงูุนูู** (ูุต ุญุฑ) - ูุทููุจ
2. **ุงููุตู** (textarea) - ูุทููุจ
3. **ุงููููู** (ูุงุฆูุฉ ููุณุฏูุฉ) - ูุทููุจ
   - ุชุธูุฑ ููุท ุงููุณุชุฎุฏููู ุงููุฎุตุตูู ูููุฒุฑุนุฉ
4. **ููุช ุงูุจุฏุก** (datetime-local) - ูุทููุจ
5. **ููุงุญุธุงุช** (textarea) - ุงุฎุชูุงุฑู

#### ุฏูุฑุฉ ุญูุงุฉ ุงููููุฉ

```
1. ูุนููุฉ (pending)
   โ [ุจุฏุก ุงููููุฉ] โ ุงููููู ููุท
2. ุฌุงุฑูุฉ (in_progress)
   โ [ุฅุบูุงู ุงููููุฉ] โ ุงููููู ุฃู ูุฏูุฑ ุงููุฒุฑุนุฉ
3. ููุชููุฉ (completed)
```

**ุงูููุงุนุฏ:**
- ุงููููุฉ ูุง ุชูุบูู ุฅูุง ูู **ุงููููู** ุฃู **ูุฏูุฑ ุงููุฒุฑุนุฉ**
- ุนูุฏ ุงูุฅุบูุงู:
  - ูุชู ุชุณุฌูู `end_time` ุชููุงุฆูุงู
  - ูุชู ุญุณุงุจ `duration_minutes` ุชููุงุฆูุงู
  - ูููู ุฅุถุงูุฉ ููุงุญุธุงุช ุฅุบูุงู

### ุญุณุงุจ ุงููุฏุฉ ุงูุชููุงุฆู

**ุงูุขููุฉ:**
```sql
CREATE FUNCTION calculate_task_duration()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.end_time IS NOT NULL AND NEW.start_time IS NOT NULL THEN
    NEW.duration_minutes := EXTRACT(EPOCH FROM (NEW.end_time - NEW.start_time)) / 60;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

**ุงูุนุฑุถ:**
```typescript
function formatDuration(minutes: number | null): string {
  if (!minutes) return '-';
  const hours = Math.floor(minutes / 60);
  const mins = Math.round(minutes % 60);
  if (hours > 0) {
    return `${hours} ุณุงุนุฉ ู ${mins} ุฏูููุฉ`;
  }
  return `${mins} ุฏูููุฉ`;
}
```

---

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

### RLS (Row Level Security)

#### ุงููุฑุงุกุฉ
```sql
-- ุงููุณุชุฎุฏููู ุงููุฎุตุตูู ูููุฒุฑุนุฉ ูุฑูู ุงูููุงู
CREATE POLICY "Admins can view tasks for their assigned farms"
  ON farm_tasks FOR SELECT
  USING (
    -- Super admin ูุฑู ูู ุดูุก
    -- ุฃู ุงููุณุชุฎุฏู ูุฎุตุต ูููุฒุฑุนุฉ
  );
```

#### ุงููุชุงุจุฉ
```sql
-- ูุฏุฑุงุก ุงููุฒุงุฑุน ูุงููุดุฑููู ูููููู ุฅูุดุงุก ููุงู
CREATE POLICY "Farm managers can create tasks"
  ON farm_tasks FOR INSERT
  WITH CHECK (
    -- ุงููุณุชุฎุฏู ูุฎุตุต ูููุฒุฑุนุฉ ุจููุน full_access ุฃู supervisor
  );
```

#### ุงูุชุญุฏูุซ
```sql
-- ุงููููู ุฃู ูุฏูุฑ ุงููุฒุฑุนุฉ ูููููู ุชุญุฏูุซ ุงููููุฉ
CREATE POLICY "Assigned users and managers can update tasks"
  ON farm_tasks FOR UPDATE
  USING (
    -- ุงููููู ุจุงููููุฉ ุฃู ูุฏูุฑ ุงููุฒุฑุนุฉ
  );
```

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช
- `supabase/migrations/*_create_farm_tasks_system.sql`

### ุงูุฎุฏูุงุช
- `src/services/farmTasksService.ts`

### ุงูููููุงุช
- `src/components/MyHarvest.tsx` (ุฅุนุงุฏุฉ ูุชุงุจุฉ)
- `src/components/harvest/FarmDetails.tsx`
- `src/components/harvest/TasksTab.tsx`
- `src/components/harvest/OperationsTab.tsx`
- `src/components/harvest/MaintenanceTab.tsx`
- `src/components/harvest/EquipmentTab.tsx`
- `src/components/harvest/FinanceTab.tsx`

---

## ๐ฏ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุนุฑุถ ุงููุฒุงุฑุน
```
1. ุงูุชุญ ูุณู "ูุญุตููู" ูู ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
2. ุณุชุธูุฑ ูุงุฆูุฉ ุจุฌููุน ุงููุฒุงุฑุน ุงูููุชููุฉ
3. ูู ูุฒุฑุนุฉ ูู ุจุทุงูุฉ ูุณุชููุฉ
```

### 2. ุงูุฏุฎูู ุนูู ูุฒุฑุนุฉ
```
1. ุงุถุบุท ุนูู ุจุทุงูุฉ ุงููุฒุฑุนุฉ
2. ุณุชูุชุญ ุตูุญุฉ ุงูุชูุงุตูู ูุน ุงูุชุจููุจุงุช ุงูุฎูุณุฉ
3. ุงูุชุจููุจ ุงูุงูุชุฑุงุถู: "ุงูุชุดุบูู"
```

### 3. ุฅุฏุงุฑุฉ ุงูููุงู
```
1. ุงูุชุญ ุชุจููุจ "ููุงู ุงูุนูู"
2. ุงุถุบุท "ุฅุถุงูุฉ ูููุฉ"
3. ุงููุฃ ุงูุจูุงูุงุช:
   - ููุน ุงูุนูู (ูุซู: ุฑูุ ุชุณููุฏุ ุชูููู)
   - ุงููุตู ุงูุชูุตููู
   - ุงุฎุชุฑ ุงููููู ูู ุงููุงุฆูุฉ
   - ุญุฏุฏ ููุช ุงูุจุฏุก
   - ุฃุถู ููุงุญุธุงุช (ุงุฎุชูุงุฑู)
4. ุงุถุบุท "ุฅุถุงูุฉ ุงููููุฉ"
```

### 4. ุชูููุฐ ุงููููุฉ
```
ูููููู ุจุงููููุฉ:
1. ุงุจุญุซ ุนู ุงููููุฉ ุงููุนููุฉ
2. ุงุถุบุท "ุจุฏุก ุงููููุฉ"
3. ุชุชุญูู ุงูุญุงูุฉ ุฅูู "ุฌุงุฑูุฉ"
4. ุนูุฏ ุงูุงูุชูุงุกุ ุงุถุบุท "ุฅุบูุงู ุงููููุฉ"
5. ุฃุถู ููุงุญุธุงุช ุงูุฅุบูุงู (ุงุฎุชูุงุฑู)
6. ูุชู ุญุณุงุจ ุงููุฏุฉ ุชููุงุฆูุงู
```

---

## ๐งช ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุนุฑุถ ุงููุฒุงุฑุน ุงูููุชููุฉ
```
1. ุฃูุดุฆ ูุฒุฑุนุฉ ุจุญุงูุฉ "completed"
2. ุฃูุดุฆ ูุฒุฑุนุฉ ุจุญุงูุฉ "draft"
3. ุงูุชุญ ูุณู "ูุญุตููู"
4. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุชุธูุฑ ุงููุฒุฑุนุฉ ุงูููุชููุฉ ููุท
```

### ุงุฎุชุจุงุฑ 2: ุฅูุดุงุก ูููุฉ
```
1. ุงุฏุฎู ุนูู ูุฒุฑุนุฉ ููุชููุฉ
2. ุงูุชุญ ุชุจููุจ "ููุงู ุงูุนูู"
3. ุงุถุบุท "ุฅุถุงูุฉ ูููุฉ"
4. ุงููุฃ ุงูุจูุงูุงุช
5. ุงุญูุธ
6. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุชุธูุฑ ุงููููุฉ ุจุญุงูุฉ "ูุนููุฉ"
```

### ุงุฎุชุจุงุฑ 3: ุชูููุฐ ูููุฉ
```
1. ุณุฌู ุฏุฎูู ูุงููููู ุจุงููููุฉ
2. ุงูุชุญ ุงููููุฉ
3. ุงุถุบุท "ุจุฏุก ุงููููุฉ"
4. ุงููุชูุฌุฉ: ุชุชุญูู ูุญุงูุฉ "ุฌุงุฑูุฉ"
5. ุงุถุบุท "ุฅุบูุงู ุงููููุฉ"
6. ุฃุถู ููุงุญุธุงุช
7. ุงููุชูุฌุฉ: ุชุชุญูู ูุญุงูุฉ "ููุชููุฉ" ูุน ุนุฑุถ ุงููุฏุฉ
```

### ุงุฎุชุจุงุฑ 4: ุงูุตูุงุญูุงุช
```
ุงููููู ุจุงููููุฉ:
- โ ูุฑู ุงููููุฉ
- โ ูุจุฏุฃ ุงููููุฉ
- โ ูุบูู ุงููููุฉ
- โ ูุง ูุญุฐู ุงููููุฉ

ูุฏูุฑ ุงููุฒุฑุนุฉ:
- โ ูุฑู ุฌููุน ุงูููุงู
- โ ููุดุฆ ููุงู
- โ ูุบูู ุฃู ูููุฉ
- โ ูุญุฐู ุงูููุงู

ูุณุชุฎุฏู ุบูุฑ ูุฎุตุต ูููุฒุฑุนุฉ:
- โ ูุง ูุฑู ุงูููุงู ุฃุตูุงู
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ูุง ุชู ุฅูุฌุงุฒู

- **ุงูุฌุฏุงูู:** 1 ุฌุฏูู ุฌุฏูุฏ (`farm_tasks`)
- **ุงูุฎุฏูุงุช:** 1 ุฎุฏูุฉ ุฌุฏูุฏุฉ (`farmTasksService`)
- **ุงูููููุงุช:** 7 ููููุงุช (1 ูุนุงุฏ ูุชุงุจุชู + 6 ุฌุฏูุฏุฉ)
- **ุงูุณูุงุณุงุช:** 4 ุณูุงุณุงุช RLS
- **ุงูุฏูุงู:** 2 ุฏุงูุฉ ุชููุงุฆูุฉ (ุญุณุงุจ ุงููุฏุฉ + ุชุญุฏูุซ updated_at)

### ุงููุธุงุฆู ุงููุชุงุญุฉ

- โ ุนุฑุถ ูุงุฆูุฉ ุงููุฒุงุฑุน ุงูููุชููุฉ
- โ ุงูุฏุฎูู ุนูู ุฃู ูุฒุฑุนุฉ
- โ ุงูุชููู ุจูู 5 ุชุจููุจุงุช
- โ ุฅูุดุงุก ูููุฉ ุฌุฏูุฏุฉ
- โ ุจุฏุก ูููุฉ
- โ ุฅุบูุงู ูููุฉ
- โ ุญุณุงุจ ุงููุฏุฉ ุชููุงุฆูุงู
- โ ุนุฑุถ ุชูุงุตูู ูู ูููุฉ
- โ ุญูุงูุฉ ุงูููุงู ุจู RLS

### ูุง ูู ููููุฐ ูู ุงููุฑุญูุฉ 1

- โ ูุธุงู ุงููุฑุงุณูุฉ
- โ ูุธุงู ุงูุฅุดุนุงุฑุงุช
- โ ุชุจููุจ ุงูุชุดุบูู (ูุญุชูู ูุงูู)
- โ ุชุจููุจ ุงูุตูุงูุฉ (ูุญุชูู ูุงูู)
- โ ุชุจููุจ ุงููุนุฏุงุช (ูุญุชูู ูุงูู)
- โ ุชุจููุจ ุงููุงููุฉ (ูุญุชูู ูุงูู)

**ููุงุญุธุฉ:** ุงูุชุจููุจุงุช ุงูุฃุฑุจุนุฉ ุงูุฃุฎุฑู ุชุนุฑุถ ุฑุณุงูุฉ "ููุฏ ุงูุชุทููุฑ" ูุฌุงูุฒุฉ ููุชูุณุน ูู ุงููุฑุงุญู ุงููุงุฏูุฉ.

---

## ๐ ุงูุฎุทูุงุช ุงููุงุฏูุฉ (ุงููุฑุญูุฉ 2)

### ุงูุชุฑุงุญุงุช ููุชูุณุน:

1. **ุชุจููุจ ุงูุชุดุบูู:**
   - ุชุณุฌูู ุนูููุงุช ุงูุฑู
   - ุชุณุฌูู ุนูููุงุช ุงูุชุณููุฏ
   - ูุชุงุจุนุฉ ุงูููู ุงููููู

2. **ุชุจููุจ ุงูุตูุงูุฉ:**
   - ุฌุฏููุฉ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ
   - ุชุณุฌูู ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ
   - ุชุชุจุน ุชูุงููู ุงูุตูุงูุฉ

3. **ุชุจููุจ ุงููุนุฏุงุช:**
   - ูุงุฆูุฉ ุงููุนุฏุงุช ุงููุชุงุญุฉ
   - ุญุงูุฉ ูู ูุนุฏุฉ
   - ุฌุฏููุฉ ุงูุตูุงูุฉ ูููุนุฏุงุช

4. **ุชุจููุจ ุงููุงููุฉ:**
   - ุชุณุฌูู ุงููุตุฑููุงุช
   - ุชุณุฌูู ุงูุฅูุฑุงุฏุงุช
   - ุชูุงุฑูุฑ ุดูุฑูุฉ ูุณูููุฉ

5. **ุชุญุณููุงุช ุนุงูุฉ:**
   - ูุธุงู ุงูุฅุดุนุงุฑุงุช
   - ูุธุงู ุงููุฑุงุณูุฉ
   - ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช
   - ุงูุชุตุฏูุฑ ุฅูู Excel/PDF

---

## โ ุงูุฎูุงุตุฉ

ุงููุฑุญูุฉ ุงูุฃููู ูู ูุณู "ูุญุตููู" ููุชููุฉ ุจูุฌุงุญ! ุงููุธุงู ุงูุขู ูููุฑ:

- โ ูููู ูุงุถุญ ูููุธู ูููุฒุงุฑุน
- โ ูุธุงู ููุงู ุนูู ูุงูู ุงููุธุงุฆู
- โ ุญูุงูุฉ ุฃูููุฉ ุดุงููุฉ
- โ ูุงุฌูุฉ ูุณุชุฎุฏู ุณููุฉ ูุฌูููุฉ
- โ ุฌุงูุฒ ููุชูุณุน ูู ุงููุฑุงุญู ุงููุงุฏูุฉ

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู!
