# ุฏููู ูุธุงู ุงูุชุฐููุฑุงุช ุงูุชููุงุฆูุฉ - ูุงูู ูููุตู

## ุงููุญุชููุงุช
1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ููู ูุนูู ุงููุธุงู](#ููู-ูุนูู-ุงููุธุงู)
3. [ุงูุฅุนุฏุงุฏุงุช](#ุงูุฅุนุฏุงุฏุงุช)
4. [ุงูุชุดุบูู ุงููุฏูู](#ุงูุชุดุบูู-ุงููุฏูู)
5. [ุฌุฏููุฉ ุงูุชุฐููุฑุงุช ุงูุชููุงุฆูุฉ](#ุฌุฏููุฉ-ุงูุชุฐููุฑุงุช-ุงูุชููุงุฆูุฉ)
6. [ุงุฎุชุจุงุฑ ุงููุธุงู](#ุงุฎุชุจุงุฑ-ุงููุธุงู)
7. [ุงุณุชูุดุงู ุงูุฃุฎุทุงุก](#ุงุณุชูุดุงู-ุงูุฃุฎุทุงุก)

---

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุชุฐููุฑุงุช ุงูุชููุงุฆูุฉ ูู ุฌุฒุก ูู **ูุธุงู ุงูุฏูุน ุงููุฑู** ูููู ุจู:

โ **ูุญุต ุงูุญุฌูุฒุงุช ุงููุนููุฉ** ูู ุณุงุนุฉ (ุฃู ุญุณุจ ุงูุฌุฏููุฉ)
โ **ุฅุฑุณุงู ุชุฐููุฑุงุช ุฐููุฉ** ุญุณุจ ุงูููุช ุงููุชุจูู
โ **ููุน ุงูุชูุฑุงุฑ** - ูู ุชุฐููุฑ ูุฑุณู ูุฑุฉ ูุงุญุฏุฉ ููุท
โ **ุงูุชุณุฌูู ุงููุงูู** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ **ุงูุฅูุบุงุก ุงูุชููุงุฆู** ููุญุฌูุฒุงุช ุงูููุชููุฉ (ุงุฎุชูุงุฑู)

---

## ููู ูุนูู ุงููุธุงู

### 1. ุฃููุงุน ุงูุชุฐููุฑุงุช

ุงููุธุงู ูุฑุณู 4 ุฃููุงุน ูู ุงูุชุฐููุฑุงุช:

#### ุฃ) ุชุฐููุฑ ููุฑ ุงูุญุฌุฒ (Initial)
- **ูุชู:** ุฎูุงู ุฃูู ุณุงุนุชูู ูู ุงูุญุฌุฒ
- **ุงูุดุฑุท:** `payment_reminder_count = 0`
- **ุงูุฑุณุงูุฉ:** ูู ูุงูุจ `payment_reminder_initial`
- **ูุซุงู:** "ุดูุฑุงู ูุญุฌุฒู ูุนูุง! ูุฏูู 7 ุฃูุงู ูุฅุชูุงู ุงูุฏูุน"

#### ุจ) ุชุฐููุฑ ููุชุตู ุงููุฏุฉ (Midway)
- **ูุชู:** ุจุนุฏ ูุฑูุฑ ูุตู ุงููุฏุฉ
- **ุงูุดุฑุท:** `days_remaining <= grace_period / 2`
- **ุงูุฑุณุงูุฉ:** ูู ูุงูุจ `payment_reminder_midway`
- **ูุซุงู:** "ุชุฐููุฑ: ูุฏูู 3 ุฃูุงู ูุชุจููุฉ ูุฅุชูุงู ุฏูุน ุญุฌุฒู"

#### ุฌ) ุชุฐููุฑ ูุจู ููู (One Day Before)
- **ูุชู:** ูุจู 24 ุณุงุนุฉ ูู ุงูููุนุฏ ุงูููุงุฆู
- **ุงูุดุฑุท:** `days_remaining <= 1 AND > 0.25`
- **ุงูุฑุณุงูุฉ:** ูู ูุงูุจ `payment_reminder_urgent`
- **ูุซุงู:** "ุนุงุฌู: ูุชุจูู 18 ุณุงุนุฉ ููุท ูุฅุชูุงู ุฏูุน ุญุฌุฒู!"

#### ุฏ) ุชุฐููุฑ ููู ุงูููุนุฏ (Deadline Day)
- **ูุชู:** ุขุฎุฑ 6 ุณุงุนุงุช ูุจู ุงูุชูุงุก ุงููููุฉ
- **ุงูุดุฑุท:** `hours_remaining <= 6 AND > 0`
- **ุงูุฑุณุงูุฉ:** ูู ูุงูุจ `payment_reminder_urgent`
- **ูุซุงู:** "ุนุงุฌู: ูุชุจูู 4 ุณุงุนุงุช ููุท ูุฅุชูุงู ุฏูุน ุญุฌุฒู!"

### 2. ุฎุท ุณูุฑ ุงูุชุฐููุฑ

```
ุงูุญุฌุฒ
  โ
[ุณุงุนุชูู] โ ุชุฐููุฑ ููุฑู โ๏ธ
  โ
[3-4 ุฃูุงู] โ ุชุฐููุฑ ููุชุตู ุงููุฏุฉ โ๏ธ
  โ
[24 ุณุงุนุฉ] โ ุชุฐููุฑ ุนุงุฌู โ๏ธ
  โ
[6 ุณุงุนุงุช] โ ุชุฐููุฑ ููุงุฆู ๐จ
  โ
ุงูุชูุงุก ุงููููุฉ
  โ
[ุงุฎุชูุงุฑู] โ ุฅูุบุงุก ุชููุงุฆู โ
```

### 3. ููุทู ููุน ุงูุชูุฑุงุฑ

ุงููุธุงู ูุชุญูู ูู:
- โ **ุนุฏุงุฏ ุงูุชุฐููุฑุงุช:** `payment_reminder_count`
- โ **ุขุฎุฑ ููุน ุชุฐููุฑ:** ูู ุฌุฏูู `payment_reminders`
- โ **ููุช ุขุฎุฑ ูุชุงุจุนุฉ:** `last_follow_up_date`

**ูู ูุฑุณู** ููุณ ููุน ุงูุชุฐููุฑ ูุฑุชูู ุฃุจุฏุงู!

---

## ุงูุฅุนุฏุงุฏุงุช

### 1. ุฅุนุฏุงุฏุงุช ุงููุธุงู

ุงูุชุญ: **ููุญุฉ ุงูุฅุฏุงุฑุฉ โ ุงูุฅุนุฏุงุฏุงุช โ ุฅุนุฏุงุฏุงุช ุงูุฏูุน ุงููุฑู**

#### ุงูุฅุนุฏุงุฏุงุช ุงูุฃุณุงุณูุฉ:

| ุงูุฅุนุฏุงุฏ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ | ุงููุตู |
|---------|-------------------|-------|
| `flexible_payment_enabled` | `true` | ุชูุนูู/ุชุนุทูู ุงููุธุงู ุจุงููุงูู |
| `payment_grace_period_days` | `7` | ุงููุฏุฉ ุงููุณููุญุฉ ุจุงูุฃูุงู (3-30) |
| `auto_cancel_after_deadline` | `false` | ุฅูุบุงุก ุชููุงุฆู ุจุนุฏ ุงูุชูุงุก ุงููููุฉ |

#### ุฅุนุฏุงุฏุงุช ุงูุชุฐููุฑุงุช:

| ุงูุฅุนุฏุงุฏ | ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ | ุงููุตู |
|---------|-------------------|-------|
| `reminder_on_booking` | `true` | ุชุฐููุฑ ููุฑ ุงูุญุฌุฒ |
| `reminder_midway` | `true` | ุชุฐููุฑ ูู ููุชุตู ุงููุฏุฉ |
| `reminder_one_day_before` | `true` | ุชุฐููุฑ ูุจู 24 ุณุงุนุฉ |
| `reminder_deadline_day` | `true` | ุชุฐููุฑ ูู ุขุฎุฑ 6 ุณุงุนุงุช |

### 2. ููุงูุจ ุงูุฑุณุงุฆู

ููููู ุชุฎุตูุต ุงูุฑุณุงุฆู ุจุงุณุชุฎุฏุงู ุงููุชุบูุฑุงุช:

| ุงููุชุบูุฑ | ุงููุตู | ูุซุงู |
|---------|-------|------|
| `{days}` | ุนุฏุฏ ุงูุฃูุงู ุงููุชุจููุฉ | "7" |
| `{hours}` | ุนุฏุฏ ุงูุณุงุนุงุช ุงููุชุจููุฉ | "18" |
| `{payment_link}` | ุฑุงุจุท ุงูุฏูุน ุงููุจุงุดุฑ | (ูุฑูุจุงู) |

**ุฃูุซูุฉ ุงูููุงูุจ:**

```
ุฑุณุงูุฉ ููุฑูุฉ:
"ุดูุฑุงู ูุญุฌุฒู ูุนูุง! ูุฏูู {days} ุฃูุงู ูุฅุชูุงู ุงูุฏูุน."

ุฑุณุงูุฉ ููุชุตู ุงููุฏุฉ:
"ุชุฐููุฑ: ูุฏูู {days} ุฃูุงู ูุชุจููุฉ ูุฅุชูุงู ุฏูุน ุญุฌุฒู."

ุฑุณุงูุฉ ุนุงุฌูุฉ:
"ุนุงุฌู: ูุชุจูู {hours} ุณุงุนุฉ ููุท ูุฅุชูุงู ุฏูุน ุญุฌุฒู!"
```

---

## ุงูุชุดุบูู ุงููุฏูู

### 1. ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ

ุงููููุน: **ุงูุฅุนุฏุงุฏุงุช โ ุฅุนุฏุงุฏุงุช ุงูุฏูุน ุงููุฑู โ ุฃุณูู ุงูุตูุญุฉ**

#### ุฒุฑ "ุชุดุบูู ุงูุชุฐููุฑุงุช ุงูุขู"

ุนูุฏ ุงูููุฑ ุนููู:
1. โ ููุญุต ุฌููุน ุงูุญุฌูุฒุงุช ุงููุนููุฉ
2. โ ูุฑุณู ุงูุชุฐููุฑุงุช ุงูููุงุณุจุฉ
3. โ ูุณุฌู ูู ุดูุก ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. โ ูุนุฑุถ ุชูุฑูุฑ ููุฑู ุจุงููุชุงุฆุฌ

#### ุงูุชูุฑูุฑ ูุนุฑุถ:
- **ุงูุชุฐููุฑุงุช ุงููุฑุณูุฉ:** ุนุฏุฏ ุงูุชุฐููุฑุงุช ุงูุชู ุชู ุฅุฑุณุงููุง
- **ุงูุชุฐููุฑุงุช ุงููุชุฎุทุงุฉ:** ุงูุญุฌูุฒุงุช ุงูุชู ูู ุชุญุชุงุฌ ุชุฐููุฑ
- **ุงูุญุฌูุฒุงุช ุงูููุบุงุฉ:** (ุฅุฐุง ูุงู ุงูุฅูุบุงุก ุงูุชููุงุฆู ููุนู)

### 2. ูู SQL ูุจุงุดุฑุฉ

```sql
-- ุชุดุบูู ูุนุงูุฌุฉ ุงูุชุฐููุฑุงุช
SELECT * FROM process_payment_reminders();

-- ุงููุชูุฌุฉ:
{
  "success": true,
  "message": "ุชูุช ูุนุงูุฌุฉ ุงูุชุฐููุฑุงุช ุจูุฌุงุญ",
  "sent": 5,
  "skipped": 12,
  "processed_at": "2026-02-09T15:30:00Z"
}
```

### 3. ูุนุงูุฌุฉ ุงูุญุฌูุฒุงุช ุงูููุชููุฉ

```sql
-- ุฅูุบุงุก ุงูุญุฌูุฒุงุช ุงูููุชููุฉ (ุงุฎุชูุงุฑู)
SELECT * FROM process_expired_reservations();

-- ุงููุชูุฌุฉ:
{
  "success": true,
  "message": "ุชูุช ูุนุงูุฌุฉ ุงูุญุฌูุฒุงุช ุงูููุชููุฉ",
  "cancelled": 2,
  "processed_at": "2026-02-09T15:30:00Z"
}
```

---

## ุฌุฏููุฉ ุงูุชุฐููุฑุงุช ุงูุชููุงุฆูุฉ

### 1. ุจุงุณุชุฎุฏุงู Supabase Cron Jobs

ูู ููุญุฉ ุชุญูู Supabase:

1. ุงุฐูุจ ุฅูู **Database โ Cron Jobs**
2. ุฃูุดุฆ Cron Job ุฌุฏูุฏ:

```sql
-- ุงุณู ุงููุธููุฉ: payment_reminders_hourly
-- ุงูุฌุฏููุฉ: ูู ุณุงุนุฉ (0 * * * *)
-- ุงูุฃูุฑ:
SELECT net.http_post(
    url := 'https://YOUR_PROJECT.supabase.co/functions/v1/payment-reminders',
    headers := jsonb_build_object(
        'Authorization', 'Bearer YOUR_SERVICE_ROLE_KEY',
        'Content-Type', 'application/json'
    )
) AS request_id;
```

### 2. ุงูุฌุฏููุฉ ุงูููุตู ุจูุง

| ุงูููุช | ุงูุฅุฌุฑุงุก | ุงูุบุฑุถ |
|-------|---------|-------|
| ูู ุณุงุนุฉ | `process_payment_reminders()` | ูุญุต ูุฅุฑุณุงู ุงูุชุฐููุฑุงุช |
| ูู 6 ุณุงุนุงุช | `process_expired_reservations()` | ุฅูุบุงุก ุงูุญุฌูุฒุงุช ุงูููุชููุฉ |
| ูุฑุฉ ููููุงู | ูุณุฎ ุงุญุชูุงุทู ููุจูุงูุงุช | ุญูุงูุฉ ุงูุณุฌูุงุช |

### 3. Cron Expression Examples

```bash
# ูู ุณุงุนุฉ
0 * * * *

# ูู 30 ุฏูููุฉ (ููุชุทุจููุงุช ุนุงููุฉ ุงูุญุฑูุฉ)
*/30 * * * *

# ูู 2 ุณุงุนุฉ
0 */2 * * *

# ููููุงู ูู ุงูุณุงุนุฉ 9 ุตุจุงุญุงู
0 9 * * *

# ูู 6 ุณุงุนุงุช
0 */6 * * *
```

### 4. ูุซุงู ุจุงุณุชุฎุฏุงู GitHub Actions

ุฅุฐุง ุฃุฑุฏุช ุงูุฌุฏููุฉ ุฎุงุฑุฌ Supabase:

```yaml
name: Payment Reminders
on:
  schedule:
    - cron: '0 * * * *'  # ูู ุณุงุนุฉ
  workflow_dispatch:  # ุชุดุบูู ูุฏูู

jobs:
  send-reminders:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Edge Function
        run: |
          curl -X POST \
            'https://YOUR_PROJECT.supabase.co/functions/v1/payment-reminders' \
            -H 'Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}' \
            -H 'Content-Type: application/json'
```

---

## ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ุณุฑูุน (ุจุฏูู ุฅุฑุณุงู ูุนูู)

```sql
-- ุฏุงูุฉ ุงุฎุชุจุงุฑ ุชุนุฑุถ ูุง ุณูุญุฏุซ ุจุฏูู ุชูููุฐ
SELECT * FROM test_payment_reminders();

-- ุงููุชูุฌุฉ:
-- reservation_id | customer_name | days_remaining | should_send | suggested_type
-- --------------|---------------|----------------|-------------|----------------
-- abc123...     | ุฃุญูุฏ ูุญูุฏ    | 6.5            | false       | none
-- def456...     | ุณุงุฑุฉ ุนูู     | 3.2            | true        | midway
-- ghi789...     | ุฎุงูุฏ ุฃุญูุฏ    | 0.8            | true        | one_day_before
```

### 2. ุฅูุดุงุก ุญุฌุฒ ุงุฎุชุจุงุฑู

```sql
-- ุฅูุดุงุก ุญุฌุฒ ูุน ุฏูุน ูุฑู (ููุงุฎุชุจุงุฑ)
INSERT INTO reservations (
  customer_name,
  customer_email,
  customer_phone,
  farm_name,
  total_trees,
  total_amount,
  status,
  flexible_payment_enabled,
  payment_deadline,
  path_type
) VALUES (
  'ุนููู ุงุฎุชุจุงุฑู',
  'test@example.com',
  '0501234567',
  'ูุฒุฑุนุฉ ุงูุงุฎุชุจุงุฑ',
  10,
  5000,
  'pending',
  true,
  NOW() + INTERVAL '2 hours',  -- ูููุฉ ุณุงุนุชูู ููุงุฎุชุจุงุฑ
  'agricultural'
);
```

### 3. ูุญุต ุงูุชุฐููุฑุงุช ุงููุฑุณูุฉ

```sql
-- ูุดุงูุฏุฉ ุฌููุน ุงูุชุฐููุฑุงุช
SELECT
  pr.reminder_type,
  pr.message,
  pr.sent_at,
  r.customer_name,
  r.payment_deadline
FROM payment_reminders pr
JOIN reservations r ON r.id = pr.reservation_id
ORDER BY pr.sent_at DESC
LIMIT 10;
```

### 4. ูุญุต ุณุฌู ุงููุชุงุจุนุฉ

```sql
-- ูุดุงูุฏุฉ ุฃูุดุทุฉ ุงููุชุงุจุนุฉ
SELECT
  fa.activity_type,
  fa.activity_result,
  fa.notes,
  fa.created_at,
  r.customer_name
FROM follow_up_activities fa
JOIN reservations r ON r.id = fa.reservation_id
WHERE fa.activity_type = 'reminder'
ORDER BY fa.created_at DESC
LIMIT 10;
```

### 5. ูุญุต ุงูุญุฌูุฒุงุช ุงููุนููุฉ

```sql
-- ูุงุฆูุฉ ุงูุญุฌูุฒุงุช ุงูุชู ุชุญุชุงุฌ ูุชุงุจุนุฉ
SELECT
  customer_name,
  total_amount,
  payment_deadline,
  EXTRACT(EPOCH FROM (payment_deadline - NOW())) / 3600 as hours_remaining,
  payment_reminder_count
FROM reservations
WHERE status = 'pending'
  AND flexible_payment_enabled = true
  AND payment_deadline > NOW()
ORDER BY payment_deadline ASC;
```

---

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ 1: ุงูุชุฐููุฑุงุช ูุง ุชุฑุณู

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**
- โ ุงููุธุงู ูุนุทู: ุชุญูู ูู `flexible_payment_enabled = true`
- โ ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ูุนููุฉ
- โ ุงูุชุฐููุฑุงุช ูุนุทูุฉ ูู ุงูุฅุนุฏุงุฏุงุช
- โ ุงูุชุฐููุฑุงุช ุฃุฑุณูุช ุจุงููุนู (ุชุญูู ูู ุฌุฏูู payment_reminders)

**ุงูุญู:**
```sql
-- ุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช
SELECT key, value FROM system_settings
WHERE key LIKE '%reminder%' OR key = 'flexible_payment_enabled';

-- ุชุญูู ูู ูุฌูุฏ ุญุฌูุฒุงุช
SELECT COUNT(*) FROM reservations
WHERE status = 'pending'
  AND flexible_payment_enabled = true;
```

### ุงููุดููุฉ 2: ุงูุชุฐููุฑุงุช ุชุชูุฑุฑ

**ุงูุณุจุจ:**
- ุฎุทุฃ ูู ููุทู ููุน ุงูุชูุฑุงุฑ

**ุงูุญู:**
```sql
-- ุญุฐู ุงูุชุฐููุฑุงุช ุงูููุฑุฑุฉ
DELETE FROM payment_reminders
WHERE id IN (
  SELECT id FROM (
    SELECT id,
           ROW_NUMBER() OVER (
             PARTITION BY reservation_id, reminder_type
             ORDER BY sent_at DESC
           ) as rn
    FROM payment_reminders
  ) t WHERE rn > 1
);
```

### ุงููุดููุฉ 3: Edge Function ูุง ูุนูู

**ุงูุชุญูู:**
```bash
# ุงุฎุชุจุฑ Edge Function ูุจุงุดุฑุฉ
curl -X POST \
  'https://YOUR_PROJECT.supabase.co/functions/v1/payment-reminders' \
  -H 'Authorization: Bearer YOUR_ANON_KEY' \
  -H 'Content-Type: application/json'
```

**ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ:**
- โ URL ุฎุงุทุฆ
- โ ANON_KEY ุบูุฑ ุตุญูุญ
- โ Edge Function ุบูุฑ ููุดูุฑุฉ

### ุงููุดููุฉ 4: ุงูุฅูุบุงุก ุงูุชููุงุฆู ูุง ูุนูู

**ุงูุณุจุจ:**
- ุงูุฅุนุฏุงุฏ `auto_cancel_after_deadline` ูุนุทู

**ุงูุญู:**
```sql
-- ุชูุนูู ุงูุฅูุบุงุก ุงูุชููุงุฆู
UPDATE system_settings
SET value = 'true'
WHERE key = 'auto_cancel_after_deadline';

-- ุฃู ุชุดุบูู ูุฏููุงู
SELECT * FROM process_expired_reservations();
```

---

## ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### 1. ุฅุญุตุงุฆูุงุช ุงูุชุฐููุฑุงุช

```sql
-- ุนุฏุฏ ุงูุชุฐููุฑุงุช ุงููุฑุณูุฉ ุงูููู
SELECT
  reminder_type,
  COUNT(*) as count
FROM payment_reminders
WHERE sent_at >= CURRENT_DATE
GROUP BY reminder_type
ORDER BY count DESC;

-- ูุชูุณุท ุงูุชุฐููุฑุงุช ููู ุญุฌุฒ
SELECT
  AVG(payment_reminder_count) as avg_reminders
FROM reservations
WHERE flexible_payment_enabled = true;
```

### 2. ูุนุฏู ุงููุฌุงุญ

```sql
-- ูุณุจุฉ ุงูุฏูุน ุจุนุฏ ุงูุชุฐููุฑุงุช
SELECT
  COUNT(CASE WHEN status = 'confirmed' THEN 1 END) * 100.0 / COUNT(*) as success_rate
FROM reservations
WHERE flexible_payment_enabled = true
  AND payment_reminder_count > 0;
```

### 3. ููุช ุงูุงุณุชุฌุงุจุฉ

```sql
-- ูุชูุณุท ุงูููุช ูู ุงูุชุฐููุฑ ุญุชู ุงูุฏูุน
SELECT
  AVG(
    EXTRACT(EPOCH FROM (r.updated_at - pr.sent_at)) / 3600
  ) as avg_hours_to_payment
FROM reservations r
JOIN payment_reminders pr ON pr.reservation_id = r.id
WHERE r.status = 'confirmed'
  AND r.flexible_payment_enabled = true;
```

---

## ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### ุณ1: ูู ูุฑุฉ ูุฌุจ ุชุดุบูู Edge Functionุ
**ุฌ:** ุงูููุตู ุจู ูู ุณุงุนุฉ. ููุชุทุจููุงุช ุนุงููุฉ ุงูุญุฑูุฉุ ูู 30 ุฏูููุฉ.

### ุณ2: ูู ูููู ุชุฎุตูุต ุฑุณุงุฆู ูุฎุชููุฉ ููู ูุณุงุฑ (ุฒุฑุงุนู/ุงุณุชุซูุงุฑู)ุ
**ุฌ:** ุญุงููุงู ูุงุ ููู ูููู ุฅุถุงูุฉ ูุฐู ุงูููุฒุฉ ูุงุญูุงู ุจุชุนุฏูู ุงูุฏูุงู.

### ุณ3: ูุงุฐุง ูู ุฃุฑุงุฏ ุงูุนููู ุชุนุทูู ุงูุชุฐููุฑุงุชุ
**ุฌ:** ูููู ุฅุถุงูุฉ ุญูู `disable_reminders` ูู ุฌุฏูู `reservations`.

### ุณ4: ูู ุงูุชุฐููุฑุงุช ูุนููุฉ ุฃู ูุญุงูุงุฉุ
**ุฌ:** ุญุงููุงู ูุชู ุงูุชุณุฌูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. ูุฅุฑุณุงู ูุนููุ ูุฌุจ ุฑุจุท:
- WhatsApp API
- SMS Gateway
- Email Service

### ุณ5: ููู ุฃุชุชุจุน ุฃู ุชุฐููุฑ ุฃุฏู ููุฏูุนุ
**ุฌ:** ุฑุงุฌุน ุฌุฏูู `payment_reminders` ูุน `reservations`:
```sql
SELECT
  pr.reminder_type,
  pr.sent_at,
  r.updated_at as payment_at,
  EXTRACT(EPOCH FROM (r.updated_at - pr.sent_at)) / 3600 as hours_to_convert
FROM reservations r
JOIN payment_reminders pr ON pr.reservation_id = r.id
WHERE r.status = 'confirmed'
ORDER BY r.updated_at DESC;
```

---

## ุงููููุงุช ุงูุฑุฆูุณูุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```
supabase/migrations/
  โโโ create_automatic_payment_reminders_system.sql
      โโโ process_payment_reminders()
      โโโ process_expired_reservations()
      โโโ test_payment_reminders()
```

### Edge Function:
```
supabase/functions/payment-reminders/
  โโโ index.ts
```

### ุงููุงุฌูุงุช:
```
src/components/admin/
  โโโ FlexiblePaymentSettings.tsx
      โโโ ุฒุฑ "ุชุดุบูู ุงูุชุฐููุฑุงุช ุงูุขู"
```

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

### 1. ุงูุชูุงูู ูุน WhatsApp
```typescript
// ูู Edge Function
if (reminderType === 'urgent') {
  await sendWhatsAppMessage(customerPhone, message);
}
```

### 2. ุงูุชูุงูู ูุน SMS
```typescript
// ูู Edge Function
await sendSMS({
  to: customerPhone,
  message: message
});
```

### 3. ุงูุชูุงูู ูุน Email
```typescript
// ูู Edge Function
await sendEmail({
  to: customerEmail,
  subject: 'ุชุฐููุฑ ุจุงูุฏูุน',
  body: message
});
```

### 4. ุชูุงุฑูุฑ ุฐููุฉ
- ุชุญููู ุฃููุงุช ุงูุงุณุชุฌุงุจุฉ
- A/B Testing ููุฑุณุงุฆู
- ุชุญุณูู ููุงุนูุฏ ุงูุฅุฑุณุงู

---

## ุงูุฎูุงุตุฉ

ูุธุงู ุงูุชุฐููุฑุงุช ุงูุชููุงุฆูุฉ **ุฌุงูุฒ ููุนูู 100%**!

### ูุง ูู ููุฌูุฏ:
โ 3 ุฏูุงู SQL ูููุฉ
โ Edge Function ููุดูุฑุฉ
โ ุฒุฑ ุชุดุบูู ูุฏูู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉ
โ ููุน ุงูุชูุฑุงุฑ ุงูุฐูู
โ ุชุณุฌูู ุดุงูู

### ูุง ูุญุชุงุฌ ุชูุนูู:
โฐ ุฌุฏููุฉ Cron Job (5 ุฏูุงุฆู)
๐ฑ ุฑุจุท WhatsApp/SMS/Email (ุงุฎุชูุงุฑู)

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2026-02-09
**ุงูุฅุตุฏุงุฑ:** 1.0
**ุงูุญุงูุฉ:** ุฌุงูุฒ ููุฅูุชุงุฌ
