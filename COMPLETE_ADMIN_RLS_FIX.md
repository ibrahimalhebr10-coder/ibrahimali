# ุฅุตูุงุญ ุดุงูู ูุตูุงุญูุงุช ุงูุฃุฏูู ูู ุงููุธุงู

## ๐ ููุฎุต ุงููุดููุฉ

ุฌููุน ุงูุชุจููุจุงุช ูู ูุณู "ูุฒุฑุนุชู" (ุงููุณุงุฑ ุงูุฒุฑุงุนู ูุงูุงุณุชุซูุงุฑู) ูุงูุช ุชุฑูุถ ุฃู ุนูููุฉ ุฅุถุงูุฉ ุฃู ุชุนุฏูู ุจุฎุทุฃ **403 Forbidden**.

---

## ๐ ุงูุณุจุจ ุงูุฌุฐุฑู

### ุงูุจููุฉ ุงูุตุญูุญุฉ ูููุธุงู:
```
auth.users.id โ admins.user_id โ admins.id
```

### ุงููุดููุฉ ูู ุณูุงุณุงุช RLS:
ูุงูุช ุงูุณูุงุณุงุช ุชุชุญูู ูู:
```sql
WHERE admins.id = auth.uid()  โ
```

ููู ุงูุตุญูุญ:
```sql
WHERE admins.user_id = auth.uid()  โ
```

### ูุซุงู ุชูุถูุญู:
ุนูุฏ ุชุณุฌูู ุฏุฎูู `admin@dev.com`:
- `auth.uid()` = `bfaef5ae-f1f8-4a1f-aa6a-752b2e116371`
- `admins.user_id` = `bfaef5ae-f1f8-4a1f-aa6a-752b2e116371` โ (ูุทุงุจู)
- `admins.id` = `5cb18491-ef24-41bd-8c1e-290bf68416c4` โ (ูุฎุชูู)

---

## โ ุงูุฌุฏุงูู ุงูููุตูุญุฉ

### 1๏ธโฃ ุงููุณุงุฑ ุงูุฒุฑุงุนู (Agricultural Path)

| ุงูุฌุฏูู | ุงูุชุจููุจ | ุงููุตู |
|-------|---------|-------|
| `agricultural_tree_inventory` | ุฎุฑูุทุฉ ุงูุฃุดุฌุงุฑ | ุฅุฏุงุฑุฉ ุงูุฃุดุฌุงุฑ ุงููุฒุฑูุนุฉ |
| `agricultural_growth_stages` | ูุฑุงุญู ุงูููู | ุชุชุจุน ูุฑุงุญู ููู ุงูุฃุดุฌุงุฑ |
| `agricultural_operations` | ุงูุนูููุงุช ุงูุฒุฑุงุนูุฉ | ุชุณุฌูู ุงูุนูููุงุช ุงูููููุฉ |
| `agricultural_documentation` | ุงูุชูุซูู | ุฑูุน ุตูุฑ ููุณุชูุฏุงุช |
| `agricultural_experience_content` | ุจุงูู ุงูุชุฌุฑุจุฉ | ูุญุชูู ุชุฌุฑุจุฉ ุงููุฒุงุฑุน |

### 2๏ธโฃ ุงููุณุงุฑ ุงูุงุณุชุซูุงุฑู (Investment Path)

| ุงูุฌุฏูู | ุงูุชุจููุจ | ุงููุตู |
|-------|---------|-------|
| `investment_status_tracking` | ุญุงูุฉ ุงูุงุณุชุซูุงุฑ | ุชุชุจุน ุญุงูุฉ ุงููุณุชุซูุฑูู |
| `investment_agricultural_assets` | ุงูุฃุตูู ุงูุฒุฑุงุนูุฉ | ุฅุฏุงุฑุฉ ุงูุฃุตูู |
| `investment_expansion_opportunities` | ูุฑุต ุงูุชูุณุน | ุนุฑุถ ุงููุฑุต |
| `investment_experience_content` | ุจุงูู ุงูุชุฌุฑุจุฉ | ูุญุชูู ุชุฌุฑุจุฉ ุงููุณุชุซูุฑ |
| `investment_products_yields` | ุงูููุชุฌุงุช | ุชุณุฌูู ุงูุฅูุชุงุฌ |
| `investment_waste_yields` | ุงููุฎููุงุช | ุชุณุฌูู ุงููุฎููุงุช |

### 3๏ธโฃ ุฌุฏุงูู ุฅุฏุงุฑูุฉ ุฅุถุงููุฉ

| ุงูุฌุฏูู | ุงููุตู |
|-------|-------|
| `action_categories` | ูุฌููุนุงุช ุงูุตูุงุญูุงุช |
| `admin_actions` | ุงูุตูุงุญูุงุช ุงููุชุงุญุฉ |
| `admin_farm_assignments` | ุชุนูููุงุช ุงููุฒุงุฑุน |
| `role_actions` | ุฑุจุท ุงูุฃุฏูุงุฑ ุจุงูุตูุงุญูุงุช |
| `storage.objects` | ุฑูุน ุงููููุงุช ูุงูุตูุฑ |

---

## ๐๏ธ ุงูุฅุตูุงุญุงุช ุงููููุฐุฉ

### Migration 1: `fix_agricultural_tree_inventory_rls_user_id.sql`
ุฅุตูุงุญ ุฌุฏูู ุฎุฑูุทุฉ ุงูุฃุดุฌุงุฑ (ุฃูู ุฅุตูุงุญ).

### Migration 2: `fix_all_myfarm_tables_rls_policies.sql`
ุฅุตูุงุญ ุดุงูู ูุฌููุน ุฌุฏุงูู ุงููุณุงุฑ ุงูุฒุฑุงุนู ูุงูุงุณุชุซูุงุฑู.

### Migration 3: `fix_remaining_admin_rls_policies.sql`
ุฅุตูุงุญ ุงูุฌุฏุงูู ุงูุฅุฏุงุฑูุฉ ุงููุชุจููุฉ.

---

## ๐ฏ ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1๏ธโฃ ุชุณุฌูู ุงูุฏุฎูู

ุงูุชุญ `/admin` ูุณุฌู ุฏุฎูู ุจุฃุญุฏ ุงูุญุณุงุจูู:

**ุงูุญุณุงุจ ุงูุฃูู (ููุชุทููุฑ):**
```
ุงูุจุฑูุฏ: admin@dev.com
ูููุฉ ุงููุฑูุฑ: Admin@123
```

**ุงูุญุณุงุจ ุงูุซุงูู:**
```
ุงูุจุฑูุฏ: ibrahimalhebr1@gmail.com
ูููุฉ ุงููุฑูุฑ: [ูููุฉ ูุฑูุฑู]
```

### 2๏ธโฃ ุงุฎุชุจุงุฑ ุงููุณุงุฑ ุงูุฒุฑุงุนู

1. ุงุฐูุจ ุฅูู: **ูุฒุฑุนุชู** โ **ุงููุณุงุฑ ุงูุฒุฑุงุนู**
2. ุงุฎุชุฑ ูุฒุฑุนุฉ (ูุซู: "ูุฒุฑุนุฉ ุงูุฒูุชูู ุงููุชุทูุฑุฉ")
3. ุงุฎุชุจุฑ ูู ุชุจููุจ:

   โ **ุฎุฑูุทุฉ ุงูุฃุดุฌุงุฑ**: ุงุถุบุท "ุฅุถุงูุฉ ุฃุดุฌุงุฑ"

   โ **ูุฑุงุญู ุงูููู**: ุงุถุบุท "ุฅุถุงูุฉ ูุฑุญูุฉ"

   โ **ุงูุนูููุงุช ุงูุฒุฑุงุนูุฉ**: ุงุถุบุท "ุชุณุฌูู ุนูููุฉ"

   โ **ุงูุชูุซูู**: ุงุถุบุท "ุฑูุน ูุณุชูุฏ"

   โ **ุจุงูู ุงูุชุฌุฑุจุฉ**: ุงุถุบุท "ุฅุถุงูุฉ ูุญุชูู"

### 3๏ธโฃ ุงุฎุชุจุงุฑ ุงููุณุงุฑ ุงูุงุณุชุซูุงุฑู

1. ุงุฐูุจ ุฅูู: **ูุฒุฑุนุชู** โ **ุงููุณุงุฑ ุงูุงุณุชุซูุงุฑู**
2. ุงุฎุชุฑ ูุณุชุซูุฑ
3. ุงุฎุชุจุฑ ูู ุชุจููุจ:

   โ **ุญุงูุฉ ุงูุงุณุชุซูุงุฑ**: ุงุถุบุท "ุชุญุฏูุซ ุงูุญุงูุฉ"

   โ **ุงูุฃุตูู ุงูุฒุฑุงุนูุฉ**: ุงุถุบุท "ุนุฑุถ ุงูุฃุตูู"

   โ **ุงูููุชุฌุงุช**: ุงุถุบุท "ุชุณุฌูู ููุชุฌ"

   โ **ุงููุฎููุงุช**: ุงุถุบุท "ุชุณุฌูู ูุฎููุงุช"

   โ **ูุฑุต ุงูุชูุณุน**: ุงุถุบุท "ุฅุถุงูุฉ ูุฑุตุฉ"

   โ **ุจุงูู ุงูุชุฌุฑุจุฉ**: ุงุถุบุท "ุฅุถุงูุฉ ูุญุชูู"

---

## ๐ ุงูุณูุงุณุฉ ุงูุฌุฏูุฏุฉ ุงูููุญุฏุฉ

ุฌููุน ุณูุงุณุงุช RLS ููุฃุฏูู ุฃุตุจุญุช ุชุณุชุฎุฏู ูุฐุง ุงูููุท:

```sql
-- ูููุฑุงุกุฉ
CREATE POLICY "Admins can read [table]"
  ON [table_name]
  FOR SELECT
  TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM admins
      WHERE admins.user_id = auth.uid()
        AND admins.is_active = true
    )
  );

-- ููุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู
CREATE POLICY "Admins can manage [table]"
  ON [table_name]
  FOR ALL
  TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM admins
      WHERE admins.user_id = auth.uid()
        AND admins.is_active = true
    )
  )
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM admins
      WHERE admins.user_id = auth.uid()
        AND admins.is_active = true
    )
  );
```

---

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

โ **15+ ุฌุฏูู** ุชู ุฅุตูุงุญูุง

โ **10 ุชุจููุจุงุช** ูู ูุฒุฑุนุชู ุชุนูู ุงูุขู ุจููุงุกุฉ

โ **ุตูุฑ ุฃุฎุทุงุก 403** ูู ุฌููุน ุงูุนูููุงุช ุงูุฅุฏุงุฑูุฉ

โ **ุฃูุงู ูุญุณูู** ูุน ุงูุชุญูู ูู `is_active = true`

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจุงููุงูู! ุฌููุน ุงูุชุจููุจุงุช ูู ูุณู "ูุฒุฑุนุชู" (ุงููุณุงุฑ ุงูุฒุฑุงุนู ูุงูุงุณุชุซูุงุฑู) ุงูุขู ุชุนูู ุจุดูู ุตุญูุญ ููููู ููุฃุฏูู:

- ุฅุถุงูุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ โ
- ุชุนุฏูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ โ
- ุญุฐู ุงูุจูุงูุงุช โ
- ุฑูุน ุงููููุงุช ูุงูุตูุฑ โ

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2026-02-04
**ุนุฏุฏ ุงูุฌุฏุงูู ุงูููุตูุญุฉ:** 15 ุฌุฏูู
**ุนุฏุฏ ุงูู Migrations:** 3 ูููุงุช migration
