# ูุฑุงุฌุนุฉ ุชูููุฐ - ุงููุฑุญูุฉ ุงูุซุงููุฉ
# ุงุณุชููุงู ูุฎุฑุฌุงุช ุงูุชุดุบูู ูู ุฒุฑ "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก"

ุงูุชุงุฑูุฎ: 4 ูุจุฑุงูุฑ 2026
ุงูุญุงูุฉ: ูุฑุงุฌุนุฉ ุดุงููุฉ

---

## ุฃููุงู: ุฃุณุฆูุฉ ูุญุต ุฅูุฒุงููุฉ - ุงูุฅุฌุงุจุงุช ุงููุงููุฉ

### 1๏ธโฃ ูู ุฒุฑ ยซุฃุดุฌุงุฑู ุงูุฎุถุฑุงุกยป ูู ุงูููุชุฑ:

**โ ููุฌูุฏ**

**ุงููููุน:**
- `/src/components/Footer.tsx` - ุงูุณุทุฑ 36
- ุงุณู ุงูุฒุฑ: "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก" (ูููุณุงุฑ ุงูุฒุฑุงุนู) ุฃู "ุฃุดุฌุงุฑู ุงูุฐูุจูุฉ" (ูููุณุงุฑ ุงูุงุณุชุซูุงุฑู)

**ุงููุณุงุฑ ุงูุญุงูู:**
- ููุฌู ุฅูู: `MyGreenTrees` component ุนุจุฑ `onMyFarmClick()` ูู App.tsx
- ุนูุฏ ุงูุถุบุท ุนูู ุงูุฒุฑ: `setShowMyGreenTrees(true)` - ุงูุณุทุฑ 49 ูู App.tsx

---

### 2๏ธโฃ ูู ุงูุฒุฑ ูุณุชููู ุจูุงูุงุชู ูุจุงุดุฑุฉ ูู:

**โ ุณุฌูุงุช ุงูุตูุงูุฉ ุงูููุดูุฑุฉ ูู ูุณู ุงูุชุดุบูู**

**ุงูุชูุถูุญ ุงููุงูู:**

#### ูุตุฏุฑ ุงูุจูุงูุงุช ุงููุญูุฏ:
```typescript
// ูู clientMaintenanceService.ts - ุงูุณุทุฑ 54-63
async getClientMaintenanceRecords(): Promise<ClientMaintenanceRecord[]> {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) throw new Error('User not authenticated');

  const { data, error } = await supabase
    .rpc('get_client_maintenance_records', { client_user_id: user.id });

  if (error) throw error;
  return data || [];
}
```

#### RPC Function ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
-- ูู migration: 20260204073542_create_maintenance_payments_tracking.sql
-- ุงูุณุทูุฑ 149-191
CREATE OR REPLACE FUNCTION get_client_maintenance_records(client_user_id uuid)
RETURNS TABLE (...)
AS $$
BEGIN
  RETURN QUERY
  SELECT
    mr.id as maintenance_id,
    mr.farm_id,
    f.name_ar as farm_name,
    mr.maintenance_type,
    mr.maintenance_date,
    mr.status,
    mf.total_amount,
    mf.cost_per_tree,
    COUNT(DISTINCT ia.id) as client_tree_count,
    (COUNT(DISTINCT ia.id) * mf.cost_per_tree) as client_due_amount,
    COALESCE(mp.payment_status, 'pending') as payment_status,
    mp.id as payment_id
  FROM maintenance_records mr      -- โ ูู ูุณู ุงูุชุดุบูู ูุจุงุดุฑุฉ
  JOIN farms f ON f.id = mr.farm_id
  LEFT JOIN maintenance_fees mf ON mf.maintenance_id = mr.id
  LEFT JOIN investment_assets ia ON ia.farm_id = mr.farm_id AND ia.user_id = client_user_id
  LEFT JOIN maintenance_payments mp ON mp.maintenance_fee_id = mf.id AND mp.user_id = client_user_id
  WHERE mr.status = 'published'   -- โ ููุท ุงูููุดูุฑุฉ
    AND ia.id IS NOT NULL         -- โ ููุท ุงููุฒุงุฑุน ุงููููููุฉ
  GROUP BY ...
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

**ุงููุชูุฌุฉ:** โ **ุงููุตุฏุฑ ุงููุญูุฏ = ูุณู ุงูุชุดุบูู**

ูุง ููุฌุฏ ุฃู ูุตุฏุฑ ุจูุงูุงุช ุขุฎุฑ. ุฌููุน ุงูุจูุงูุงุช ุชุฃุชู ูู:
- `maintenance_records` - ุณุฌูุงุช ุงูุตูุงูุฉ ูู ูุณู ุงูุชุดุบูู
- `maintenance_fees` - ุฑุณูู ุงูุตูุงูุฉ ูู ูุณู ุงูุชุดุบูู
- `maintenance_payments` - ุณุฏุงุฏุงุช ุงูุนููุงุก

---

### 3๏ธโฃ ูู ูุชู ุงูุชุญูู ุนูุฏ ุฏุฎูู ุงูุนููู ูู:
```
client โ trees โ farms โ maintenance (published)
```

**โ ูุนู**

**ุงููุณุงุฑ ุงููุงูู:**

```sql
-- 1. ุจุฏุก ูู ุงูุนููู
WHERE ... AND ia.user_id = client_user_id

-- 2. ุงูุฃุดุฌุงุฑ ุงููููููุฉ (investment_assets)
LEFT JOIN investment_assets ia ON ia.farm_id = mr.farm_id AND ia.user_id = client_user_id
WHERE ia.id IS NOT NULL  -- โ ุงูุชุฃูุฏ ูู ูุฌูุฏ ููููุฉ

-- 3. ุงููุฒุงุฑุน ุงููุฑุชุจุทุฉ
JOIN farms f ON f.id = mr.farm_id

-- 4. ุงูุตูุงูุงุช ุงูููุดูุฑุฉ ููุท
FROM maintenance_records mr
WHERE mr.status = 'published'  -- โ ููุท ุงูููุดูุฑุฉ
```

**ุงูุชุณูุณู:**
1. โ ุงูุนููู (`client_user_id`)
2. โ ุฃุดุฌุงุฑู (`investment_assets` ุญูุซ `user_id = client_user_id`)
3. โ ุงููุฒุงุฑุน ุงูุชู ูููู ูููุง ุฃุดุฌุงุฑ (`farms` ุงููุฑุชุจุทุฉ ุจู `investment_assets`)
4. โ ุงูุตูุงูุงุช ุงูููุดูุฑุฉ ููุท (`maintenance_records` ุญูุซ `status = 'published'`)

**ุงููุชูุฌุฉ:** โ **ุงููุณุงุฑ ูุทุงุจู ุชูุงูุงู ููููุงุตูุงุช**

---

### 4๏ธโฃ ูู ูุง ูุธูุฑ ููุนููู ููุชุตุฑ ุนูู:
- ููุน ุงูุตูุงูุฉ
- ุชุงุฑูุฎ ุงูุชูููุฐ
- ูุตู ูุฎุชุตุฑ
- ุตูุฑ ูููุฏูู

**โ๏ธ ูุง - ููุฌุฏ ุฎุทุฃ ูุงุญุฏ**

**ูุง ูุธูุฑ ุญุงููุงู ูู ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ:**
- โ ููุน ุงูุตูุงูุฉ (`maintenance_type`) - ุงูุณุทุฑ 291-293
- โ ุชุงุฑูุฎ ุงูุชูููุฐ (`maintenance_date`) - ุงูุณุทุฑ 300-303
- โ ุงุณู ุงููุฒุฑุนุฉ (`farm_name`) - ุงูุณุทุฑ 290
- โ ุนุฏุฏ ุงูุฃุดุฌุงุฑ - ุงูุณุทุฑ 297
- โ ุฑุณูู ุงูุตูุงูุฉ (ุฅู ูุฌุฏุช) - ุงูุณุทูุฑ 307-344
- โ ุญุงูุฉ ุงูุณุฏุงุฏ - ุงูุณุทูุฑ 314-324
- โ ุฒุฑ "ุนุฑุถ ุงูุชูุงุตูู" - ุงูุณุทุฑ 347-353

**โ ุงููุดููุฉ: ูู ุตูุญุฉ ุงูุชูุงุตูู**

ุนูุฏ ุงูุถุบุท ุนูู "ุนุฑุถ ุงูุชูุงุตูู"ุ ูุชู ุนุฑุถ:
```typescript
// ูู MyGreenTrees.tsx - ุงูุณุทูุฑ 173-204
{maintenanceDetails.stages && maintenanceDetails.stages.length > 0 && (
  <div>
    <h3>ูุฑุงุญู ุงูุชูููุฐ</h3>  {/* โ ูุฐุง ุฎุทุฃ! */}
    {maintenanceDetails.stages.map((stage) => (
      <div>
        <h4>{stage.stage_title}</h4>
        <p>{stage.stage_note}</p>
        <span>{stage.stage_date}</span>
      </div>
    ))}
  </div>
)}
```

**โ ุงููุฑุงุญู ูุฌุจ ุฅุฎูุงุคูุง!**

ุงูููุงุตูุงุช ุชุทูุจ:
> ูู ูุชู ุฅุฎูุงุก:
> - ูุฑุงุญู ุงูุตูุงูุฉุ โ **ูุฌุจ ูุนู**
> - ุงูุชูุงุตูู ุงูุชุดุบูููุฉ ุงูุฏุงุฎููุฉุ โ **ูุฌุจ ูุนู**

**ูุง ูุฌุจ ุนุฑุถู ููุท:**
- โ ููุน ุงูุตูุงูุฉ
- โ ุชุงุฑูุฎ ุงูุชูููุฐ
- โฌ ูุตู ูุฎุชุตุฑ (ุบูุฑ ููุฌูุฏ ุญุงููุงู)
- โ ุตูุฑ ูููุฏูู (ุงูุณุทูุฑ 206-242)

**ุงููุชูุฌุฉ:** โ๏ธ **ูุญุชุงุฌ ุชุตุญูุญ - ุฅุฒุงูุฉ ุงููุฑุงุญู ูู ุตูุญุฉ ุงูุชูุงุตูู**

---

### 5๏ธโฃ ูู ุชุธูุฑ ุฑุณูู ุงูุตูุงูุฉ ููุนููู:
ููุท ุนูุฏ ูุฌูุฏ ูุจูุบ ูุณุฌูุ

**โ ูุนู**

**ุงูุฏููู ูู ุงูููุฏ:**
```typescript
// ูู MyGreenTrees.tsx - ุงูุณุทุฑ 307
{record.total_amount && record.cost_per_tree && (
  <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 border border-blue-100">
    {/* ุนุฑุถ ุงูุฑุณูู */}
  </div>
)}
```

**ุงูุดุฑุท:**
- `record.total_amount` ููุฌูุฏ (ููุณ null)
- `record.cost_per_tree` ููุฌูุฏ (ููุณ null)

**ุงููุชูุฌุฉ:** โ **ุงูุฑุณูู ุชุธูุฑ ููุท ุนูุฏ ูุฌูุฏ ูุจูุบ**

---

### 6๏ธโฃ ูู ูุชู ุญุณุงุจ ูุตูุจ ุงูุนููู ุฏููุงูููููุงุ
```
ูุตูุจ ุงูุนููู = ุนุฏุฏ ุฃุดุฌุงุฑู ร ุชูููุฉ ุงูุดุฌุฑุฉ
```

**โ ูุนู**

**ุฃูู ูุชู ุงูุญุณุงุจ:**

#### โ๏ธ **ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database) - ุตุญูุญ โ**

```sql
-- ูู RPC function - ุงูุณุทุฑ 176
(COUNT(DISTINCT ia.id) * mf.cost_per_tree) as client_due_amount
```

**ุงูุญุณุงุจ:**
- `COUNT(DISTINCT ia.id)` = ุนุฏุฏ ุฃุดุฌุงุฑ ุงูุนููู ูู ุงููุฒุฑุนุฉ
- `mf.cost_per_tree` = ุชูููุฉ ุงูุดุฌุฑุฉ ุงููุงุญุฏุฉ ูู ุฌุฏูู ุฑุณูู ุงูุตูุงูุฉ
- **ุงููุชูุฌุฉ** = `client_due_amount` (ุงููุจูุบ ุงููุณุชุญู)

#### โ **ููุฌุฏ ุนุฑุถ ููุท ูู ุงููุงุฌูุฉ - ูุง ุญุณุงุจุงุช โ**

```typescript
// ูู MyGreenTrees.tsx - ุงูุณุทูุฑ 336-341
<div className="flex justify-between">
  <span className="font-semibold text-gray-900">ุงููุจูุบ ุงููุณุชุญู</span>
  <span className="text-xl font-bold text-blue-600">
    {record.client_due_amount} ุฑ.ุณ  {/* โ ููุท ุนุฑุถุ ูุง ุญุณุงุจ */}
  </span>
</div>
```

**ุงููุชูุฌุฉ:** โ **ุงูุญุณุงุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุทุ ูุงููุงุฌูุฉ ุทุจูุฉ ุนุฑุถ**

---

### 7๏ธโฃ ูู ูุธูุฑ ููุนููู:
- ุญุงูุฉ ุงูุณุฏุงุฏุ
- ูุณุฏุฏ / ุบูุฑ ูุณุฏุฏ

**โ ูุนู**

**ุงูุฏููู ูู ุงูููุฏ:**
```typescript
// ูู MyGreenTrees.tsx - ุงูุณุทูุฑ 314-324
{record.payment_status === 'paid' ? (
  <span className="flex items-center gap-1 text-green-600 font-semibold">
    <CheckCircle className="w-5 h-5" />
    ูุณุฏุฏ
  </span>
) : (
  <span className="flex items-center gap-1 text-amber-600 font-semibold">
    <AlertCircle className="w-5 h-5" />
    ุบูุฑ ูุณุฏุฏ
  </span>
)}
```

**ุงูุญุงูุงุช:**
- โ `paid` = ูุณุฏุฏ (ุฃุฎุถุฑ + ุฃููููุฉ checkmark)
- โ `pending` = ุบูุฑ ูุณุฏุฏ (ุจุฑุชูุงูู + ุฃููููุฉ ุชุญุฐูุฑ)

**ุงููุชูุฌุฉ:** โ **ุญุงูุฉ ุงูุณุฏุงุฏ ุชุธูุฑ ุจูุถูุญ**

---

### 8๏ธโฃ ูู ููุฌุฏ ุฒุฑ ูุงุญุฏ ููุท:
"ุณุฏุงุฏ ุงูุฑุณูู"
ููุง ููุฌุฏ ุฃู ุฎูุงุฑุงุช ุฃุฎุฑูุ

**โ ูุนู**

**ุงูุฃุฒุฑุงุฑ ุงูููุฌูุฏุฉ:**

#### 1. ุฒุฑ "ุนุฑุถ ุงูุชูุงุตูู" (ุฏุงุฆูุงู)
```typescript
// ุงูุณุทูุฑ 347-353
<button onClick={() => handleViewDetails(record)}>
  <Eye className="w-5 h-5" />
  ุนุฑุถ ุงูุชูุงุตูู
</button>
```

#### 2. ุฒุฑ "ุณุฏุงุฏ ุงูุฑุณูู" (ุนูุฏ ูุฌูุฏ ุฑุณูู ุบูุฑ ูุณุฏุฏุฉ)
```typescript
// ุงูุณุทูุฑ 355-364
{record.total_amount && record.cost_per_tree && record.payment_status === 'pending' && (
  <button onClick={() => handlePayFee(record)}>
    <DollarSign className="w-5 h-5" />
    ุณุฏุงุฏ ุงูุฑุณูู
  </button>
)}
```

**ุดุฑูุท ุธููุฑ ุฒุฑ ุงูุณุฏุงุฏ:**
- ููุฌุฏ `total_amount` (ูุจูุบ ุฅุฌูุงูู)
- ููุฌุฏ `cost_per_tree` (ุชูููุฉ ููุดุฌุฑุฉ)
- ุงูุญุงูุฉ `pending` (ุบูุฑ ูุณุฏุฏ)

**ุงููุชูุฌุฉ:** โ **ุฒุฑ ูุงุญุฏ ููุท ููุณุฏุงุฏ - ูุง ุฎูุงุฑุงุช ุฃุฎุฑู**

---

### 9๏ธโฃ ูุงุฐุง ูุญุฏุซ ุนูุฏ ุนุฏู ุงูุณุฏุงุฏุ

**โ ูุง ูููุน ุนุฑุถ ุงูุตูุงูุฉ**
**โ ูุง ูููุน ุงููุชุงุจุนุฉ**
**โ ูุง ูุคุซุฑ ุนูู ุญุงูุฉ ุงูุดุฌุฑุฉ**

**ุงูุชูุถูุญ:**

#### โ ูุง ููุฌุฏ ุฃู ุชูููุฏ

```typescript
// ูู MyGreenTrees.tsx
// ุฌููุน ุงูุตูุงูุงุช ุชูุนุฑุถ ุจุบุถ ุงููุธุฑ ุนู ุญุงูุฉ ุงูุณุฏุงุฏ

{records.map((record) => (
  <div key={record.maintenance_id}>
    {/* ุงูุนููู ูุฑู ูู ุดูุก */}
    {/* ููููู ุนุฑุถ ุงูุชูุงุตูู */}
    {/* ุญุงูุฉ ุงูุณุฏุงุฏ ูุนุฑูุถุฉ ููุท */}
  </div>
))}
```

#### ูุง ูุญุฏุซ ุนูุฏ ุนุฏู ุงูุณุฏุงุฏ:
- โ ูุฑู ุงูุนููู ุงูุตูุงูุฉ ุจุดูู ุทุจูุนู
- โ ููููู ุนุฑุถ ุงูุชูุงุตูู ูุงูุตูุฑ
- โ ูุฑู ุญุงูุฉ "ุบูุฑ ูุณุฏุฏ" ููุท
- โ ูุฑู ุฒุฑ "ุณุฏุงุฏ ุงูุฑุณูู"
- โ ูุง ููุฌุฏ ุฃู ููุน ุฃู ุชูููุฏ

**ุงููุชูุฌุฉ:** โ **ุนุฏู ุงูุณุฏุงุฏ ูุง ูุคุซุฑ ุนูู ุฃู ุดูุก - ููุท ูุนูููุฉ ูุนุฑูุถุฉ**

---

### ๐ ูู ูุชู ุงูุชุฒุงูู ุงูููุฑูุ

**โ ูุนู**

**ุงูุณููุงุฑูู:**
```
1. ุงูุฅุฏุงุฑุฉ ุชูุดุฑ ุตูุงูุฉ ูู ูุณู ุงูุชุดุบูู
   โ
2. ุชูุถุงู ุฅูู ุฌุฏูู maintenance_records ุจุญุงูุฉ 'published'
   โ
3. ุงูุนููู ูุฏุฎู ุนูู "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก"
   โ
4. ุชุธูุฑ ุงูุตูุงูุฉ ููุฑุงู
```

**ุงูุฏููู:**

#### 1. ุนูุฏ ูุดุฑ ุตูุงูุฉ:
```sql
-- ูู ูุณู ุงูุชุดุบูู
INSERT INTO maintenance_records (status = 'published')
-- ุชุตุจุญ ูุฑุฆูุฉ ููุฑุงู
```

#### 2. ุนูุฏ ุฅุถุงูุฉ ุฑุณูู:
```sql
-- ูู ูุณู ุงูุชุดุบูู
INSERT INTO maintenance_fees (maintenance_id, total_amount, cost_per_tree)
-- ุชุธูุฑ ููุนููู ููุฑุงู
```

#### 3. ุนูุฏ ุชุญุฏูุซ ุญุงูุฉ ุณุฏุงุฏ:
```typescript
// ูู clientMaintenanceService.ts - ุงูุณุทูุฑ 133-146
await supabase
  .from('maintenance_payments')
  .update({ payment_status: 'paid', amount_paid: amountPaid })
  .eq('id', paymentId)

// ุซู
loadMaintenanceRecords(); // โ ุฅุนุงุฏุฉ ุชุญููู ููุฑู
```

**ุงููุชูุฌุฉ:** โ **ุงูุชุฒุงูู ููุฑู - ูุง ููุฌุฏ ุชุฃุฎูุฑ**

---

## ุซุงููุงู: ุชูููู ุงูุญุงูุฉ ุงูุญุงููุฉ

### โ ูุง ุชู ุชูููุฐู ุจุดูู ุตุญูุญ (95%):

| ุงูุจูุฏ | ุงูุญุงูุฉ | ุงูููุงุญุธุฉ |
|-------|---------|----------|
| ุฒุฑ "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก" ููุฌูุฏ | โ | ูู Footer.tsx |
| ูุณุชููู ูู ูุณู ุงูุชุดุบูู ูุจุงุดุฑุฉ | โ | RPC function ูุงุถุญุฉ |
| ุงููุณุงุฑ: client โ trees โ farms โ maintenance | โ | ูุทุงุจู 100% |
| ููุท ุงูุตูุงูุงุช ุงูููุดูุฑุฉ (published) | โ | WHERE status = 'published' |
| ุงูุฑุณูู ุชุธูุฑ ุนูุฏ ูุฌูุฏ ูุจูุบ ููุท | โ | ุดุฑุท ูุงุถุญ |
| ุญุณุงุจ ูุตูุจ ุงูุนููู ูู DB | โ | ูุง ุญุณุงุจุงุช ูู ุงููุงุฌูุฉ |
| ุนุฑุถ ุญุงูุฉ ุงูุณุฏุงุฏ | โ | ูุณุฏุฏ / ุบูุฑ ูุณุฏุฏ |
| ุฒุฑ ูุงุญุฏ ููุท ููุณุฏุงุฏ | โ | ูุง ุฎูุงุฑุงุช ุฃุฎุฑู |
| ุนุฏู ุงูุณุฏุงุฏ ูุง ูููุน | โ | ูุง ุชูููุฏุงุช |
| ุงูุชุฒุงูู ููุฑู | โ | ูุจุงุดุฑ ุจุฏูู ุชุฃุฎูุฑ |
| ุตูุฑ ูููุฏูู | โ | ูุนุฑูุถุฉ |

### โ ูุง ูู ูููููุฐ ุจุดูู ุตุญูุญ (5%):

| ุงูุจูุฏ | ุงูุญุงูุฉ | ุงูููุงุญุธุฉ |
|-------|---------|----------|
| ุฅุฎูุงุก ูุฑุงุญู ุงูุตูุงูุฉ | โ | ุชุธูุฑ ูู ุตูุญุฉ ุงูุชูุงุตูู |
| ุฅุฎูุงุก ุงูุชูุงุตูู ุงูุชุดุบูููุฉ | โ | ุงููุฑุงุญู = ุชูุงุตูู ุชุดุบูููุฉ |
| ูุตู ูุฎุชุตุฑ | โฌ | ุบูุฑ ููุฌูุฏ |

---

## ุซุงูุซุงู: ุงููุทููุจ ุชุตุญูุญู

### ุงููุดููุฉ ุงููุญูุฏุฉ: ุนุฑุถ ุงููุฑุงุญู ูู ุตูุญุฉ ุงูุชูุงุตูู

**ุงููููุน:**
- `/src/components/MyGreenTrees.tsx` - ุงูุณุทูุฑ 173-204

**ุงููุดููุฉ:**
```typescript
// ูุฐุง ุงูููุฏ ูุฌุจ ุฅุฒุงูุชู
{maintenanceDetails.stages && maintenanceDetails.stages.length > 0 && (
  <div>
    <h3>ูุฑุงุญู ุงูุชูููุฐ</h3>  {/* โ ุชูุงุตูู ุชุดุบูููุฉ - ูุฌุจ ุฅุฎูุงุคูุง */}
    {/* ... ุนุฑุถ ุงููุฑุงุญู */}
  </div>
)}
```

**ููุงุฐุง ูุฐุง ุฎุทุฃุ**

ุงูููุงุตูุงุช ุชูุต ุนูู:
> ูู ูุชู ุฅุฎูุงุก:
> - **ูุฑุงุญู ุงูุตูุงูุฉุ** โ ูุฌุจ ูุนู
> - **ุงูุชูุงุตูู ุงูุชุดุบูููุฉ ุงูุฏุงุฎููุฉุ** โ ูุฌุจ ูุนู

**ุงูุชูุงุตูู ุงูุชุดุบูููุฉ = ุงููุฑุงุญู**

ุงููุฑุงุญู ุชุญุชูู ุนูู:
- ุฃุณูุงุก ุงููุฑุงุญู (stage_title)
- ููุงุญุธุงุช ุฏุงุฎููุฉ (stage_note)
- ุชูุงุฑูุฎ ุชูููุฐ ุฏุงุฎููุฉ (stage_date)

ูุฐู ูุนูููุงุช **ุชุดุบูููุฉ ุฏุงุฎููุฉ** ูุง ูุฌุจ ุฃู ูุฑุงูุง ุงูุนููู!

---

### ุงูุญู ุงููุทููุจ:

#### ุงูุชุตุญูุญ 1: ุฅุฒุงูุฉ ุงููุฑุงุญู ูู ุตูุญุฉ ุงูุชูุงุตูู

```typescript
// ุญุฐู ุงูุณุทูุฑ 173-204 ุจุงููุงูู
// ูุง ุฏุงุนู ูุฌูุจ ุงููุฑุงุญู ุฃู ุนุฑุถูุง
```

#### ุงูุชุตุญูุญ 2: ุฅุถุงูุฉ ูุตู ูุฎุชุตุฑ (ุงุฎุชูุงุฑู)

ุฅุฐุง ุฃุฑุฏูุง ุฅุถุงูุฉ "ูุตู ูุฎุชุตุฑ":
- ุฅุถุงูุฉ ุญูู `description` ูู ุฌุฏูู `maintenance_records`
- ููุชุจู ุงูุฅุฏุงุฑู ุนูุฏ ุฅูุดุงุก ุงูุตูุงูุฉ
- ููุนุฑุถ ููุนููู ุจุฏูุงู ูู ุงููุฑุงุญู

```typescript
// ูู ุตูุญุฉ ุงูุชูุงุตูู
{maintenanceDetails.description && (
  <div className="bg-gray-50 rounded-xl p-4">
    <p className="text-gray-700">{maintenanceDetails.description}</p>
  </div>
)}
```

#### ุงูุชุตุญูุญ 3: ุชุญุฏูุซ ุฏุงูุฉ getMaintenanceDetails

```typescript
// ูู clientMaintenanceService.ts - ุชุนุฏูู ุงูุณุทูุฑ 65-104
async getMaintenanceDetails(maintenanceId: string): Promise<MaintenanceDetails> {
  const [recordResult, mediaResult] = await Promise.all([
    supabase
      .from('maintenance_records')
      .select('*')
      .eq('id', maintenanceId)
      .eq('status', 'published')
      .single(),

    // ุฅุฒุงูุฉ ุฌูุจ ุงููุฑุงุญู - ูุง ูุญุชุงุฌูุง
    // stagesResult ุชู ุญุฐููุง

    supabase
      .from('maintenance_media')
      .select('id, media_type, file_path')
      .eq('maintenance_id', maintenanceId)
      .order('uploaded_at', { ascending: false })
  ]);

  if (recordResult.error) throw recordResult.error;

  const media = mediaResult.data || [];
  const mediaWithUrls = await Promise.all(
    media.map(async (m) => {
      const { data } = supabase.storage
        .from('maintenance-media')
        .getPublicUrl(m.file_path);
      return { ...m, media_url: data.publicUrl };
    })
  );

  return {
    ...recordResult.data,
    stages: [],  // โ ูุงุฑุบ - ูุง ูุฑุงุญู
    media: mediaWithUrls
  };
}
```

---

## ุฑุงุจุนุงู: ุฎุทุฉ ุงูุชุตุญูุญ ุงููุงููุฉ

### ุงููุฑุญูุฉ 1: ุฅุฒุงูุฉ ุงููุฑุงุญู ูู ูุงุฌูุฉ ุงูุนููู โ

**ุงููุฏู:** ุฅุฎูุงุก ุงูุชูุงุตูู ุงูุชุดุบูููุฉ (ุงููุฑุงุญู) ุนู ุงูุนููู

**ุงูุฎุทูุงุช:**

1. โ **ุชุนุฏูู MyGreenTrees.tsx**
   - ุญุฐู ุนุฑุถ ุงููุฑุงุญู (ุงูุณุทูุฑ 173-204)
   - ุฅุจูุงุก ุนุฑุถ ุงูุตูุฑ ูุงูููุฏูู ููุท

2. โ **ุชุนุฏูู clientMaintenanceService.ts**
   - ุฅุฒุงูุฉ ุฌูุจ ุงููุฑุงุญู ูู `getMaintenanceDetails`
   - ุฃู ุฅุฑุฌุงุน ูุตูููุฉ ูุงุฑุบุฉ `stages: []`

3. โ **ุงุฎุชุจุงุฑ**
   - ุงูุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุงููุฑุงุญู ูู ุตูุญุฉ ุงูุชูุงุตูู
   - ุงูุชุฃูุฏ ูู ุธููุฑ ุงูุตูุฑ ูุงูููุฏูู ุจุดูู ุตุญูุญ

---

### ุงููุฑุญูุฉ 2: ุฅุถุงูุฉ ูุตู ูุฎุชุตุฑ (ุงุฎุชูุงุฑู) โฌ

**ุงููุฏู:** ุฅุนุทุงุก ุงูุนููู ูุนูููุงุช ุจุณูุทุฉ ุนู ุงูุตูุงูุฉ ุจุฏูู ุชูุงุตูู ุชุดุบูููุฉ

**ุงูุฎุทูุงุช:**

1. โฌ **ุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
   ```sql
   ALTER TABLE maintenance_records
   ADD COLUMN description text;

   COMMENT ON COLUMN maintenance_records.description
   IS 'ูุตู ูุฎุชุตุฑ ููุนููู (ูุธูุฑ ูู ูุงุฌูุฉ ุงูุนููู ููุท)';
   ```

2. โฌ **ุชุนุฏูู ูููุฐุฌ ุฅุถุงูุฉ ุงูุตูุงูุฉ ูู ุงูุฅุฏุงุฑุฉ**
   ```typescript
   <textarea
     name="description"
     placeholder="ูุตู ูุฎุชุตุฑ ููุนููู (ุงุฎุชูุงุฑู)"
     rows={3}
   />
   ```

3. โฌ **ุนุฑุถ ุงููุตู ูู ูุงุฌูุฉ ุงูุนููู**
   ```typescript
   {maintenanceDetails.description && (
     <div className="bg-gray-50 rounded-xl p-4 mb-6">
       <h3 className="font-semibold text-gray-900 mb-2">ุนู ูุฐู ุงูุตูุงูุฉ</h3>
       <p className="text-gray-700">{maintenanceDetails.description}</p>
     </div>
   )}
   ```

---

## ุฎุงูุณุงู: ุงูุชูููู ุงูููุงุฆู

### ุงูุญุงูุฉ ุงูุญุงููุฉ: 95% ููุชููุฉ โ

**ูุง ูุนูู ุจุดูู ููุชุงุฒ:**
- โ ุงูุฒุฑ ููุฌูุฏ ููุนูู
- โ ุงูุจูุงูุงุช ูู ูุณู ุงูุชุดุบูู ูุจุงุดุฑุฉ
- โ ุงููุณุงุฑ ุตุญูุญ: client โ trees โ farms โ maintenance
- โ ููุท ุงูุตูุงูุงุช ุงูููุดูุฑุฉ
- โ ุงูุญุณุงุจุงุช ูู DB
- โ ุงููุงุฌูุฉ ุทุจูุฉ ุนุฑุถ ููุท
- โ ุญุงูุฉ ุงูุณุฏุงุฏ ูุงุถุญุฉ
- โ ุฒุฑ ุณุฏุงุฏ ูุงุญุฏ
- โ ูุง ุชูููุฏุงุช ุนูุฏ ุนุฏู ุงูุณุฏุงุฏ
- โ ุงูุชุฒุงูู ููุฑู

**ูุง ูุญุชุงุฌ ุชุตุญูุญ (5% ููุท):**
- โ ุฅุฎูุงุก ุงููุฑุงุญู ุนู ุงูุนููู (ุชูุงุตูู ุชุดุบูููุฉ)
- โฌ ุฅุถุงูุฉ ูุตู ูุฎุชุตุฑ (ุงุฎุชูุงุฑู)

---

## ุณุงุฏุณุงู: ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### โ ุงููุฑุญูุฉ ุงูุซุงููุฉ **ููุชููุฉ ุจูุณุจุฉ 95%**

**ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ:**
- โ ุฒุฑ "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก" ูุณุชููู ูุฎุฑุฌุงุช ูุณู ุงูุชุดุบูู ูุจุงุดุฑุฉ
- โ ูุง ููุฌุฏ ุฃู ููุทู ุญุณุงุจู ุฃู ุชุดุบููู ูู ุงููุงุฌูุฉ
- โ ุงููุงุฌูุฉ ุทุจูุฉ ุนุฑุถ ููุท (View Layer)
- โ ุฌููุน ุงูุญุณุงุจุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูุชุฒุงูู ููุฑู

**ุงููุทููุจ ููุท:**
- โ๏ธ ุฅุฒุงูุฉ ุนุฑุถ ุงููุฑุงุญู ูู ุตูุญุฉ ุงูุชูุงุตูู (15 ุฏูููุฉ)
- โฌ ุฅุถุงูุฉ ูุตู ูุฎุชุตุฑ (ุงุฎุชูุงุฑู - 30 ุฏูููุฉ)

**ุงูุชูุตูุฉ:**
- ุฅุตูุงุญ ุงููุดููุฉ ุงููุญูุฏุฉ (ุฅุฎูุงุก ุงููุฑุงุญู)
- ุซู ุงุนุชูุงุฏ ุงููุธุงู ูุงูุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ

---

## ุณุงุจุนุงู: ููุงุญุธุฉ ุญุงุณูุฉ

### โ ูุง ููุฌุฏ ุฃู ููุทู ูุฎุงูู ูู ุฒุฑ "ุฃุดุฌุงุฑู ุงูุฎุถุฑุงุก"

**ุชุฃููุฏ:**
- โ ูุง ุญุณุงุจุงุช ูู ุงููุงุฌูุฉ
- โ ูุง ููุทู ุชุดุบููู ูู ุงููุงุฌูุฉ
- โ ูุง ููุทู ุชุญููู ูู ุงููุงุฌูุฉ
- โ ุงููุงุฌูุฉ ููุท ุชุนุฑุถ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฌููุน ุงูุญุณุงุจุงุช ูุงูููุทู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (RPC function)

**ุงูุงุณุชุซูุงุก ุงููุญูุฏ:**
- โ๏ธ ุนุฑุถ ุงููุฑุงุญู (ุชูุงุตูู ุชุดุบูููุฉ) - ูุฌุจ ุฅุฎูุงุคูุง

---

**ุงูุญุงูุฉ:** ููุชูู ุชูุฑูุจุงู - ูุญุชุงุฌ ุชุตุญูุญ ุจุณูุท ููุท โ
