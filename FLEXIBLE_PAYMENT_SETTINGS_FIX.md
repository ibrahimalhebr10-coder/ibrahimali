# ุฅุตูุงุญ: ุญูุธ ุฅุนุฏุงุฏุงุช ูุธุงู ุงูุฏูุน ุงููุฑู โ

ุชู ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุญูุธ ุฅุนุฏุงุฏุงุช ูุธุงู ุงูุฏูุน ุงููุฑู ุจุดูู ุตุญูุญ!

---

## ุงููุดููุฉ ุงููุฏููุฉ โ

```
ุงููุฏูุฑ ูููู ุจุชุนุทูู ูุธุงู ุงูุฏูุน ุงููุฑู
    โ
ูุถุบุท "ุญูุธ ุงูุฅุนุฏุงุฏุงุช"
    โ
โ ุจุนุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉุ ุงูุฅุนุฏุงุฏ ูุนูุฏ ููุญุงูุฉ ุงูุณุงุจูุฉ
โ ูุง ูุชู ุญูุธ ุงูุชุบููุฑุงุช
โ ุงููุดููุฉ ูู ุชุญููู ูุญูุธ ุงูุฅุนุฏุงุฏุงุช
```

---

## ุงูุณุจุจ ุงูุฌุฐุฑู

### 1. ูุดููุฉ ูู ุชุญููู ุงูุฅุนุฏุงุฏุงุช

```typescript
// ุงููุฏูู โ
const allSettings = await systemSettingsService.getAllSettings();

// getAllSettings() ุชุฑุฌุน ูุตูููุฉุ ููู ุงูููุฏ ูุญุงูู ุงุณุชุฎุฏุงููุง ููุงุฆู
const loadedSettings = {
  flexible_payment_enabled: allSettings.flexible_payment_enabled || 'true',
  // โ allSettings.flexible_payment_enabled = undefined
};
```

**ุงููุดููุฉ:** `getAllSettings()` ุชุฑุฌุน ูุตูููุฉ ูู ุงููุงุฆูุงุชุ ููู ุงูููุฏ ูุงู ูุญุงูู ุงููุตูู ููููู ูุจุงุดุฑุฉ ูุฃููุง ูุงุฆู.

### 2. ูุดููุฉ ูู updateSetting

ุงูู service ูุงู ููุชุฑุถ ุฃู ุฌููุน ุงูุฅุนุฏุงุฏุงุช ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ ููู ุฅุฐุง ูู ููู ุงูุฅุนุฏุงุฏ ููุฌูุฏุงูุ ูุดูุช ุนูููุฉ ุงูู UPDATE ุฏูู ุฅูุดุงุก ุงูุณุฌู.

---

## ุงูุญู ุงูุฌุฏูุฏ โ

### 1. ุฅุตูุงุญ ุชุญููู ุงูุฅุนุฏุงุฏุงุช

```typescript
const loadSettings = async () => {
  try {
    const allSettingsArray = await systemSettingsService.getAllSettings();

    // โ ุชุญููู ุงููุตูููุฉ ุฅูู ูุงุฆู
    const allSettings: Record<string, string> = {};
    allSettingsArray.forEach(setting => {
      allSettings[setting.key] = setting.value;
    });

    console.log('๐ฅ [SETTINGS] ุชุญููู ุงูุฅุนุฏุงุฏุงุช:', allSettings);

    const loadedSettings = {
      flexible_payment_enabled: allSettings['flexible_payment_enabled'] || 'true',
      // โ ุงูุขู ูููู ุงููุตูู ูููููุฉ ุจุดูู ุตุญูุญ
    };

    setSettings(loadedSettings);
  } catch (error) {
    console.error('โ [SETTINGS] ุฎุทุฃ ูู ุชุญููู ุงูุฅุนุฏุงุฏุงุช:', error);
  }
};
```

### 2. ุฅุตูุงุญ updateSetting

```typescript
async updateSetting(key: string, value: string): Promise<boolean> {
  try {
    // โ ุงูุชุญูู ูู ูุฌูุฏ ุงูุฅุนุฏุงุฏ ุฃููุงู
    const { data: existing } = await supabase
      .from('system_settings')
      .select('id')
      .eq('key', key)
      .maybeSingle();

    if (existing) {
      // โ ุงูุฅุนุฏุงุฏ ููุฌูุฏ - ุชุญุฏูุซู
      await supabase
        .from('system_settings')
        .update({ value, updated_at: now() })
        .eq('key', key);
    } else {
      // โ ุงูุฅุนุฏุงุฏ ุบูุฑ ููุฌูุฏ - ุฅูุดุงุคู
      await supabase
        .from('system_settings')
        .insert({ key, value, category: 'payment' });
    }

    return true;
  } catch (error) {
    console.error('ุฎุทุฃ:', error);
    return false;
  }
}
```

### 3. ุฅุถุงูุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
INSERT INTO system_settings (key, value, description, category)
VALUES
  ('flexible_payment_enabled', 'true', 'ุชูุนูู/ุชุนุทูู ูุธุงู ุงูุฏูุน ุงููุฑู', 'payment'),
  ('payment_grace_period_days', '30', 'ุงููุฏุฉ ุงููุณููุญุฉ ููุฏูุน ุจุงูุฃูุงู', 'payment'),
  ('auto_cancel_after_deadline', 'false', 'ุฅูุบุงุก ุชููุงุฆู ุจุนุฏ ุงูุชูุงุก ุงููููุฉ', 'payment'),
  ('reminder_on_booking', 'true', 'ุฅุฑุณุงู ุชุฐููุฑ ููุฑ ุงูุญุฌุฒ', 'payment'),
  -- ... ุงููุฒูุฏ
ON CONFLICT (key) DO UPDATE
  SET value = EXCLUDED.value,
      updated_at = now();
```

---

## ููู ุชุฎุชุจุฑ ุงูุฅุตูุงุญุ

### 1. ุงูุชุญ ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช

```
ููุญุฉ ุงูุฅุฏุงุฑุฉ โ ุงูุฅุนุฏุงุฏุงุช โ ูุธุงู ุงูุฏูุน ุงููุฑู
```

### 2. ุงุฎุชุจุฑ ุชุนุทูู ุงููุธุงู

```
1. ุงูุธุฑ ุฅูู ุฒุฑ "ุชูุนูู ูุธุงู ุงูุฏูุน ุงููุฑู"
2. ุฅุฐุง ูุงู ููุนูุงู (ุฃุฎุถุฑ)ุ ุงุถุบุท ุนููู ูุชุนุทููู
3. ุงุถุบุท "ุญูุธ ุงูุฅุนุฏุงุฏุงุช"
4. ุงูุชุธุฑ ุฑุณุงูุฉ "ุชู ุงูุญูุธ ุจูุฌุงุญ" โ
5. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (F5)
6. โ ูุฌุจ ุฃู ูุจูู ุงูุฒุฑ ูุนุทูุงู (ุฑูุงุฏู)
```

### 3. ุงุฎุชุจุฑ ุชุบููุฑ ุงููุฏุฉ

```
1. ุบูุฑ "ุงููุฏุฉ ุงููุณููุญุฉ ููุฏูุน" ูู 30 ุฅูู 7 ุฃูุงู
2. ุงุถุบุท "ุญูุธ ุงูุฅุนุฏุงุฏุงุช"
3. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
4. โ ูุฌุจ ุฃู ูุจูู ุงูุฅุนุฏุงุฏ 7 ุฃูุงู
```

### 4. ุงุฎุชุจุฑ ููุงูุจ ุงูุฑุณุงุฆู

```
1. ุบูุฑ ูุต "ุฑุณุงูุฉ ุงูุชุฃููุฏ ุงูุฃููู"
2. ุงุถุบุท "ุญูุธ ุงูุฅุนุฏุงุฏุงุช"
3. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
4. โ ูุฌุจ ุฃู ูุจูู ุงููุต ุงูุฌุฏูุฏ
```

---

## ุฑุณุงุฆู Console ููุชุชุจุน

ุนูุฏ ุญูุธ ุงูุฅุนุฏุงุฏุงุชุ ุณุชุธูุฑ ูุฐู ุงูุฑุณุงุฆู:

```
๐พ [SETTINGS] ุจุฏุก ุญูุธ ุงูุฅุนุฏุงุฏุงุช...
๐พ [SETTINGS] ุงูุฅุนุฏุงุฏุงุช ุงููุฑุงุฏ ุญูุธูุง: {flexible_payment_enabled: "false", ...}
๐พ [SETTINGS] ุญูุธ flexible_payment_enabled = false
๐ [SYSTEM_SETTINGS] ุชุญุฏูุซ flexible_payment_enabled = false
๐ [SYSTEM_SETTINGS] ุชุญุฏูุซ ุฅุนุฏุงุฏ ููุฌูุฏ: flexible_payment_enabled
โ [SYSTEM_SETTINGS] ุชู ุชุญุฏูุซ flexible_payment_enabled
โ [SETTINGS] ุชู ุญูุธ flexible_payment_enabled
...
โ [SETTINGS] ุชู ุญูุธ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ!
๐ฅ [SETTINGS] ุชุญููู ุงูุฅุนุฏุงุฏุงุช: {...}
โ [SETTINGS] ุงูุฅุนุฏุงุฏุงุช ุงููุญููุฉ: {...}
```

---

## ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### 1. ุงููููุงุช ุงููุนุฏูุฉ

```
src/components/admin/FlexiblePaymentSettings.tsx
  - ุฅุตูุงุญ loadSettings() - ุชุญููู ุงููุตูููุฉ ุฅูู ูุงุฆู
  - ุฅุตูุงุญ handleSave() - ุฅุถุงูุฉ logs ูุฅุนุงุฏุฉ ุชุญููู
  - ุฅุถุงูุฉ console.log ุดุงูู ููุชุชุจุน

src/services/systemSettingsService.ts
  - ุฅุตูุงุญ updateSetting() - ุงูุชุญูู ูู ูุฌูุฏ ุงูุณุฌู
  - ุฅุถุงูุฉ ุฅูุดุงุก ุชููุงุฆู ููุฅุนุฏุงุฏุงุช ุงูุบูุฑ ููุฌูุฏุฉ
  - ุฅุถุงูุฉ logs ููุตูุฉ
```

### 2. ุงููุงููุฑูุดู ุงูุฌุฏูุฏ

```
supabase/migrations/[timestamp]_add_flexible_payment_settings.sql
  - ุฅุถุงูุฉ ุฌููุน ุฅุนุฏุงุฏุงุช ุงูุฏูุน ุงููุฑู ุงูุงูุชุฑุงุถูุฉ
  - ุงุณุชุฎุฏุงู ON CONFLICT ููุชุญุฏูุซ ุงูุชููุงุฆู
```

---

## ุงูููุงุฆุฏ

### ูููุฏูุฑ:

โ ููููู ุชุนุทูู ูุธุงู ุงูุฏูุน ุงููุฑู
โ ููููู ุชุบููุฑ ุงููุฏุฉ ุงูุฒูููุฉ
โ ููููู ุชุฎุตูุต ููุงูุจ ุงูุฑุณุงุฆู
โ ุงูุฅุนุฏุงุฏุงุช ุชุญูุธ ุจุดูู ุฏุงุฆู

### ุชูููุงู:

โ ุงูููุฏ ูุชุนุงูู ูุน ุงููุตูููุงุช ุจุดูู ุตุญูุญ
โ updateSetting ูุฏุนู ุฅูุดุงุก ูุชุญุฏูุซ
โ logs ุดุงููุฉ ููุชุชุจุน
โ ุฅุนุงุฏุฉ ุชุญููู ุชููุงุฆูุฉ ุจุนุฏ ุงูุญูุธ

---

## ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ุงูุชุญูู ูู ุฌููุน ุฅุนุฏุงุฏุงุช ุงูุฏูุน ุงููุฑู
SELECT key, value, category, updated_at
FROM system_settings
WHERE category = 'payment'
ORDER BY key;

-- ุงููุชูุฌุฉ ุงููุชููุนุฉ:
-- flexible_payment_enabled | true/false | payment | 2026-02-09
-- payment_grace_period_days | 7-30 | payment | 2026-02-09
-- auto_cancel_after_deadline | true/false | payment | 2026-02-09
-- reminder_on_booking | true/false | payment | 2026-02-09
-- ... ุงูุฎ
```

---

## ููุงุญุธุงุช ูููุฉ

### 1. ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ

ุฌููุน ุงูุฅุนุฏุงุฏุงุช ููุง ููู ุงูุชุฑุงุถูุฉ ูุนูููุฉ:
- `flexible_payment_enabled`: true
- `payment_grace_period_days`: 30
- `auto_cancel_after_deadline`: false
- ุฌููุน ุงูุชุฐููุฑุงุช: true

### 2. ุชุฃุซูุฑ ุงูุชุนุทูู

ุนูุฏ ุชุนุทูู `flexible_payment_enabled`:
- ูู ูุธูุฑ ุฒุฑ "ุงูุฏูุน ุฎูุงู 30 ูููุงู" ูู ุตูุญุงุช ุงููุฑุงุฌุนุฉ
- ุณูุธูุฑ ุฒุฑ ูุงุญุฏ ููุท: "ุชุฃููุฏ ุงูุญุฌุฒ ูุงูุฏูุน ุงูุขู"
- ุงูุญุฌูุฒุงุช ุงูุญุงููุฉ ุงููุนููุฉ ูู ุชุชุฃุซุฑ

### 3. ุงูููู ุงูุตุญูุญุฉ

ุฌููุน ุงูููู ูู ููุน string:
- `'true'` ู `'false'` (ูููุณ boolean)
- `'7'` ู `'30'` (ูููุณ number)

---

## ุงูุงุฎุชุจุงุฑ ุงููุงูู

### ุงูุณููุงุฑูู ุงููุงูู:

```
1. ุงูุชุญ ููุญุฉ ุงููุฏูุฑ
2. ุงุฐูุจ ุฅูู ุงูุฅุนุฏุงุฏุงุช โ ูุธุงู ุงูุฏูุน ุงููุฑู
3. ุนุทูู ุงููุธุงู (ุงุถุบุท ุนูู ุงูุฒุฑ ุงูุฃุฎุถุฑ ููุตุจุญ ุฑูุงุฏู)
4. ุบูุฑ ุงููุฏุฉ ุฅูู 7 ุฃูุงู
5. ุนุทูู "ุชุฐููุฑ ูู ููุชุตู ุงููุฏุฉ"
6. ุบูุฑ ูุต "ุฑุณุงูุฉ ุงูุชุฃููุฏ ุงูุฃููู"
7. ุงุถุบุท "ุญูุธ ุงูุฅุนุฏุงุฏุงุช"
8. โ ุงูุชุธุฑ ุฑุณุงูุฉ ุงููุฌุงุญ
9. ุงูุชุญ Console ูุชุญูู ูู ุงูู logs
10. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (F5)
11. โ ุชุญูู ุฃู ุฌููุน ุงูุชุบููุฑุงุช ูุญููุธุฉ
```

---

**ุชู ุงูุชุทุจูู ุจุชุงุฑูุฎ:** 2026-02-09

**ุงูุญุงูุฉ:** โ ูุตููุญ ููุนูู ุจุดูู ุตุญูุญ

**ุงูุงุฎุชุจุงุฑ:** ุฌุฑุจ ุงูุขู! ุนุทูู ุงููุธุงู ูุงุญูุธ ุซู ุฃุนุฏ ุงูุชุญููู.
