# ๐ ูุธุงู ุงูุฑุณุงุฆู ุงููุงูู - ุงููุฑุงุญู 1 + 2 + 3

## ูุธุฑุฉ ุนุงูุฉ ุดุงููุฉ

ุชู ุฅูุดุงุก ูุธุงู ุฑุณุงุฆู ูุชูุงูู ูุฅุฏุงุฑุฉ ุงูุชูุงุตู ูุน ุงููุณุชุซูุฑููุ ูุชุถูู ุฅุฑุณุงู ุงูุฑุณุงุฆูุ ุงูููุงูุจุ ูุงูุชูุซูู ุงููุงูู.

---

## ๐ ุงููููู ุงููุงูู

```
ูุธุงู ุงูุฑุณุงุฆู
โโโ ุตูุฏูู ุงููุงุฑุฏ (inbox)
โโโ ุงูุฑุณุงุฆู ุงููุฑุณูุฉ (sent)
โโโ ๐ ููุงูุจ ุงูุฑุณุงุฆู (templates) โ ุงููุฑุญูุฉ 2
โโโ ๐ ุณุฌู ุงูุฑุณุงุฆู (log) โ ุงููุฑุญูุฉ 3
โโโ ุฅูุดุงุก ุฑุณุงูุฉ (compose)
```

---

## โ ุงููุฑุญูุฉ 1: ุงูุจููุฉ ุงูุชุญุชูุฉ

### ุงูุฅูุฌุงุฒุงุช:
- โ ุฌุฏูู `messages` ุงูุฃุณุงุณู
- โ ูุธุงู ุงููุฑุงุณูุฉ ุจูู ุงููุณุชุฎุฏููู
- โ ุฑุณุงุฆู ุงููููุน ุงูุฏุงุฎููุฉ
- โ ูุงุฌูุฉ ูุฑูุฒ ุงูุฑุณุงุฆู

### ุงูุฌุฏุงูู:
- `messages` - ุงูุฑุณุงุฆู ุงูุฃุณุงุณูุฉ
- `visitor_messages` - ุฑุณุงุฆู ุงูุฒูุงุฑ
- `smart_assistant_conversations` - ูุญุงุฏุซุงุช ุงููุณุงุนุฏ ุงูุฐูู

---

## โ ุงููุฑุญูุฉ 2: ููุงูุจ ุงูุฑุณุงุฆู

### ุงูุฅูุฌุงุฒุงุช:
- โ ุฌุฏูู `message_templates`
- โ 4 ููุงูุจ ุงูุชุฑุงุถูุฉ
- โ ูุธุงู ุงููุชุบูุฑุงุช ุงูุฏููุงููููุฉ
- โ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูููุงูุจ

### ุงูููุงูุจ ุงูุฌุงูุฒุฉ:
1. **ูุชุญ ุณุฏุงุฏ** - 6 ูุชุบูุฑุงุช
2. **ุชุฐููุฑ ุจุงูุณุฏุงุฏ** - 7 ูุชุบูุฑุงุช
3. **ุชุฃููุฏ ุงุณุชูุงู ุงูุทูุจ** - 8 ูุชุบูุฑุงุช
4. **ุฑุณุงูุฉ ุนุงูุฉ** - 2 ูุชุบูุฑุงุช

### ุงููููุฒุงุช:
- โ ุฅูุดุงุก ูุชุนุฏูู ุงูููุงูุจ
- โ ุงูุชุดุงู ุชููุงุฆู ูููุชุบูุฑุงุช
- โ ุญูุงูุฉ ููุงูุจ ุงููุธุงู
- โ ุชุตูููุงุช ููููุฉ

---

## โ ุงููุฑุญูุฉ 3: ุณุฌู ุงูุฑุณุงุฆู

### ุงูุฅูุฌุงุฒุงุช:
- โ ุฌุฏูู `messages_log`
- โ ุชูุซูู ุดุงูู ููู ุฑุณุงูุฉ
- โ ุจุญุซ ูุชุตููุฉ ูุชูุฏูุฉ
- โ ุฅุญุตุงุฆูุงุช ููุฑูุฉ

### ุงูุจูุงูุงุช ุงููุณุฌูุฉ:
- โ ุงุณู ุงููุณุชุซูุฑ
- โ ููุน ุงูุฑุณุงูุฉ
- โ ุงููุงูุจ ุงููุณุชุฎุฏู
- โ ุงูููุงุฉ (ูููุน/ูุงุชุณุงุจ/SMS/ุฅูููู)
- โ ุญุงูุฉ ุงูุฅุฑุณุงู
- โ ุงูุชุงุฑูุฎ ูุงูููุช
- โ ุงููุฑุณู
- โ ุงููุฒุฑุนุฉ ุงููุฑุชุจุทุฉ

### ุงููููุฒุงุช:
- โ ุนุฑุถ ุดุงูู ููุฑุณุงุฆู
- โ ุจุญุซ ูู ุฌููุน ุงูุญููู
- โ ุชุตููุฉ ูุชุนุฏุฏุฉ ุงููุนุงููุฑ
- โ ูุงูุฐุฉ ุชูุงุตูู ูุงููุฉ
- โ ููุนุฑุถ ููุท

---

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ:

#### 1. `message_templates`
```sql
- id, name, content, variables
- category, is_system
- created_at, updated_at
```

#### 2. `messages_log`
```sql
- id, investor_id, investor_name
- message_type, template_id, template_name
- channel, subject, content
- sent_by, sent_by_name
- farm_id, farm_name
- reservation_id, payment_id
- status, metadata, created_at
```

---

## ๐ฏ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู

### ููุงูุจ ุงูุฑุณุงุฆู (ุงููุฑุญูุฉ 2):
- โ ุฅูุดุงุก ููุงูุจ ูุฎุตุตุฉ
- โ ุชุนุฏูู ุงูููุงูุจ ุงูููุฌูุฏุฉ
- โ ุงุณุชุฎุฏุงู ุงููุชุบูุฑุงุช ุงูุฏููุงููููุฉ
- โ ุชุตููู ุงูููุงูุจ

### ุณุฌู ุงูุฑุณุงุฆู (ุงููุฑุญูุฉ 3):
- โ ูุฑุงุฌุนุฉ ุงูุฑุณุงุฆู ุงููุฑุณูุฉ
- โ ุงูุชุฏููู ูุงูุงูุชุซุงู
- โ ุฎุฏูุฉ ุงูุนููุงุก
- โ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

### 1. ุฅูุดุงุก ุงููุงูุจ
```
ููุงูุจ ุงูุฑุณุงุฆู โ ุฅูุดุงุก ูุงูุจ โ ุญูุธ
```

### 2. ุฅุฑุณุงู ุงูุฑุณุงูุฉ
```
ุงุฎุชูุงุฑ ุงููุงูุจ โ ุงุณุชุจุฏุงู ุงููุชุบูุฑุงุช โ ุฅุฑุณุงู
```

### 3. ุงูุชุณุฌูู ุงูุชููุงุฆู
```
ุนูุฏ ุงูุฅุฑุณุงู โ ุชุณุฌูู ูู ุงูุณุฌู โ ุชูุซูู ูุงูู
```

### 4. ุงููุฑุงุฌุนุฉ
```
ุณุฌู ุงูุฑุณุงุฆู โ ุจุญุซ/ุชุตููุฉ โ ุนุฑุถ ุงูุชูุงุตูู
```

---

## ๐จ ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ูุฑูุฒ ุงูุฑุณุงุฆู - 5 ุชุจููุจุงุช:

#### 1. ุตูุฏูู ุงููุงุฑุฏ
- ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ
- (ููุฏ ุงูุชุทููุฑ)

#### 2. ุงูุฑุณุงุฆู ุงููุฑุณูุฉ
- ุงูุฑุณุงุฆู ุงูุตุงุฏุฑุฉ
- (ููุฏ ุงูุชุทููุฑ)

#### 3. ๐ ููุงูุจ ุงูุฑุณุงุฆู
- ุนุฑุถ ุฌููุน ุงูููุงูุจ
- ุฅูุดุงุก ูุชุนุฏูู
- ุงููุชุบูุฑุงุช ุงูุฏููุงููููุฉ

#### 4. ๐ ุณุฌู ุงูุฑุณุงุฆู
- ุชูุซูู ุดุงูู
- ุจุญุซ ูุชุตููุฉ
- ุฅุญุตุงุฆูุงุช

#### 5. ุฅูุดุงุก ุฑุณุงูุฉ
- ุฅุฑุณุงู ุฌุฏูุฏ
- (ููุฏ ุงูุชุทููุฑ)

---

## ๐ ุงูุตูุงุญูุงุช

### ููุงูุจ ุงูุฑุณุงุฆู:
- โ ุงููุฏูุฑ ุงูุนุงู ููุท
- โ ุฅูุดุงุกุ ุชุนุฏููุ ุญุฐู (ุงูููุงูุจ ุงููุฎุตุตุฉ)
- โ ุชุนุฏูู ููุงูุจ ุงููุธุงู (ุงููุญุชูู ููุท)

### ุณุฌู ุงูุฑุณุงุฆู:
- โ ุงููุฏูุฑ ุงูุนุงู ูุงููุดุฑููู
- โ ุนุฑุถ ููุท
- โ ูุง ุชุนุฏูู ููุง ุญุฐู

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุชุงุญุฉ

### ูู ุณุฌู ุงูุฑุณุงุฆู:
- ๐ ุฅุฌูุงูู ุงูุฑุณุงุฆู
- ๐ ุขุฎุฑ 24 ุณุงุนุฉ
- โ ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ
- โ ูุดู ุงูุฅุฑุณุงู

### ุงูุชูุฒูุนุงุช:
- ุญุณุจ ุงูููุน (ุณุฏุงุฏุ ุญุฌุฒุ ุนุงูุ ุฅุดุนุงุฑ)
- ุญุณุจ ุงูููุงุฉ (ูููุนุ ูุงุชุณุงุจุ SMSุ ุฅูููู)
- ุญุณุจ ุงูุญุงูุฉ (ูุฌุญุ ูุดูุ ูุนูู)

---

## ๐ ุงูุจุญุซ ูุงูุชุตููุฉ

### ุงูุจุญุซ ุงููุตู ูู:
- ุงุณู ุงููุณุชุซูุฑ
- ุงููุงูุจ ุงููุณุชุฎุฏู
- ุงูุนููุงู
- ุงุณู ุงููุฑุณู
- ุงุณู ุงููุฒุฑุนุฉ

### ุงูุชุตููุฉ ุญุณุจ:
- ููุน ุงูุฑุณุงูุฉ
- ุงูููุงุฉ
- ุญุงูุฉ ุงูุฅุฑุณุงู
- ุงูุชุงุฑูุฎ

---

## ๐ก ุงููุชุบูุฑุงุช ุงูุฏููุงููููุฉ

### ุงูุตูุบุฉ:
```
{{ุงุณู_ุงููุชุบูุฑ}}
```

### ุฃูุซูุฉ ุดุงุฆุนุฉ:
- `{{ุงุณู_ุงููุณุชุซูุฑ}}`
- `{{ุงุณู_ุงููุฒุฑุนุฉ}}`
- `{{ุฑูู_ุงูุญุฌุฒ}}`
- `{{ุงููุจูุบ}}`
- `{{ุชุงุฑูุฎ_ุงูุงุณุชุญูุงู}}`
- `{{ุฑุงุจุท_ุงูุณุฏุงุฏ}}`
- `{{ุนุฏุฏ_ุงูุฃุดุฌุงุฑ}}`
- `{{ููุน_ุงูุฃุดุฌุงุฑ}}`

### ุงูุงุณุชุฎุฏุงู:
```typescript
// ุงุณุชุจุฏุงู ุชููุงุฆู
const content = messageTemplatesService.replaceVariables(
  template.content,
  {
    'ุงุณู_ุงููุณุชุซูุฑ': 'ุฃุญูุฏ ูุญูุฏ',
    'ุงุณู_ุงููุฒุฑุนุฉ': 'ูุฒุฑุนุฉ ุงูุฒูุชูู',
    'ุฑูู_ุงูุญุฌุฒ': '12345'
  }
);
```

---

## ๐ ุงููููุงุช ุงููุชุงุญุฉ

### ุญุงููุงู:
- โ **ุฏุงุฎู ุงููููุน** - ุฑุณุงุฆู ุฏุงุฎููุฉ
- โณ **ูุงุชุณุงุจ** - ูุคูุช (ูุฑุฏู)

### ูุฑูุจุงู:
- ๐ **SMS** - ุฑุณุงุฆู ูุตูุฉ
- ๐ **Email** - ุจุฑูุฏ ุฅููุชุฑููู
- ๐ **WhatsApp API** - ูุงุชุณุงุจ ุฑุณูู

---

## ๐ฏ ุฃููุงุน ุงูุฑุณุงุฆู

### 1. ุณุฏุงุฏ (payment) ๐ข
- ูุชุญ ุฏูุนุงุช
- ุชุฐููุฑุงุช ุงูุณุฏุงุฏ
- ุชุฃููุฏ ุงูุฏูุน

### 2. ุญุฌุฒ (reservation) ๐ต
- ุชุฃููุฏ ุงูุทูุจ
- ุชุญุฏูุซุงุช ุงูุญุฌุฒ
- ุงูููุงููุฉ/ุงูุฑูุถ

### 3. ุนุงู (general) โช
- ุฑุณุงุฆู ุนุงูุฉ
- ุฅุนูุงูุงุช
- ุชูุงุตู

### 4. ุฅุดุนุงุฑ (notification) ๐ก
- ุชูุจููุงุช ุงููุธุงู
- ุฅุดุนุงุฑุงุช ูููุฉ
- ุชุญุฏูุซุงุช

---

## ๐ ุงูุชูุงูู ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

### ูุธุงู ุงูุญุฌูุฒุงุช:
```typescript
// ุนูุฏ ุชุฃููุฏ ุงูุญุฌุฒ
const template = await getTemplate('ุชุฃููุฏ ุงุณุชูุงู ุงูุทูุจ');
const content = replaceVariables(template, data);
await sendMessage(content);
await logMessage({...});
```

### ุงููุธุงู ุงููุงูู:
```typescript
// ุนูุฏ ูุชุญ ุฏูุนุฉ
const template = await getTemplate('ูุชุญ ุณุฏุงุฏ');
const content = replaceVariables(template, data);
await sendMessage(content);
await logMessage({...});
```

### ุงูุฌุฏููุฉ ุงูุชููุงุฆูุฉ:
```typescript
// ุชุฐููุฑ ุชููุงุฆู
const template = await getTemplate('ุชุฐููุฑ ุจุงูุณุฏุงุฏ');
const content = replaceVariables(template, data);
await sendMessage(content);
await logMessage({...});
```

---

## ๐ ูููู ุงููููุงุช

```
project/
โโโ supabase/migrations/
โ   โโโ create_message_templates_system.sql
โ   โโโ seed_default_message_templates.sql
โ   โโโ create_messages_log_system.sql
โโโ src/services/
โ   โโโ messageTemplatesService.ts
โ   โโโ messagesLogService.ts
โโโ src/components/admin/
    โโโ MessageTemplates.tsx
    โโโ MessagesLog.tsx
    โโโ MessagesCenter.tsx
```

---

## โจ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### ููุงูุจ ุงูุฑุณุงุฆู:
1. โ 4 ููุงูุจ ุงูุชุฑุงุถูุฉ ุฌุงูุฒุฉ
2. โ ุฅูุดุงุก ููุงูุจ ูุฎุตุตุฉ
3. โ ูุชุบูุฑุงุช ุฏููุงููููุฉ
4. โ ุงูุชุดุงู ุชููุงุฆู ูููุชุบูุฑุงุช
5. โ ุชุตูููุงุช ููุธูุฉ
6. โ ุญูุงูุฉ ููุงูุจ ุงููุธุงู

### ุณุฌู ุงูุฑุณุงุฆู:
1. โ ุชูุซูู ุดุงูู ููู ุฑุณุงูุฉ
2. โ ุจุญุซ ููู ููุฑู
3. โ ุชุตููุฉ ูุชุนุฏุฏุฉ ุงููุนุงููุฑ
4. โ ุฅุญุตุงุฆูุงุช ููุฑูุฉ
5. โ ูุงูุฐุฉ ุชูุงุตูู ูุงููุฉ
6. โ ููุนุฑุถ ููุท (ูุง ุชุนุฏูู)
7. โ ุฃุฏุงุก ูุญุณู ุจุงูููุงุฑุณ

---

## ๐ ุงูุฎุทูุงุช ุงููุงุฏูุฉ

### ุงููุฑุญูุฉ 4 (ููุชุฑุญุฉ):
- โ ุฅุฑุณุงู ุฑุณุงุฆู ุฌูุงุนูุฉ
- โ ุงุฎุชูุงุฑ ุงููุณุชูููู
- โ ุฌุฏููุฉ ุงูุฅุฑุณุงู
- โ ุชูุงูู SMS
- โ ุชูุงูู WhatsApp API
- โ ุชูุงูู Email

---

## ๐ ููุงุญุธุงุช ูุงูุฉ

1. **ุงูููุงูุจ ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู** - ูููู ุงุณุชุฎุฏุงููุง ููุฑุงู
2. **ุงูุณุฌู ููุซู ุชููุงุฆูุงู** - ูุฌุจ ุฃู ุชุณุฌู ุงูุฃูุณุงู ุงูุฃุฎุฑู
3. **ุงูุฃุฏุงุก ูุญุณู** - ููุงุฑุณ ุนูู ุฌููุน ุงูุญููู ุงููููุฉ
4. **ุงูุตูุงุญูุงุช ูุญููุฉ** - RLS ุนูู ุฌููุน ุงูุฌุฏุงูู
5. **ุงูุชุตููู ุงุญุชุฑุงูู** - ูุงุฌูุฉ ุฌูููุฉ ูุณููุฉ

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุงุณุชุฎุฏุงู ูุงูุจ
```typescript
// 1. ุฌูุจ ุงููุงูุจ
const template = await messageTemplatesService
  .getAllTemplates()
  .then(t => t.find(x => x.name === 'ูุชุญ ุณุฏุงุฏ'));

// 2. ุงุณุชุจุฏุงู ุงููุชุบูุฑุงุช
const content = messageTemplatesService.replaceVariables(
  template.content,
  {
    'ุงุณู_ุงููุณุชุซูุฑ': 'ุฃุญูุฏ ูุญูุฏ',
    'ุฑูู_ุงูุญุฌุฒ': '12345',
    'ุงุณู_ุงููุฒุฑุนุฉ': 'ูุฒุฑุนุฉ ุงูุฒูุชูู',
    'ุงููุจูุบ': '10000',
    'ุชุงุฑูุฎ_ุงูุงุณุชุญูุงู': '2026-02-15',
    'ุฑุงุจุท_ุงูุณุฏุงุฏ': 'https://...'
  }
);

// 3. ุฅุฑุณุงู ุงูุฑุณุงูุฉ
await sendMessage(investorId, content);

// 4. ุชุณุฌูู ูู ุงูุณุฌู
await messagesLogService.logMessage({
  investor_id: investorId,
  investor_name: 'ุฃุญูุฏ ูุญูุฏ',
  message_type: 'payment',
  template_id: template.id,
  template_name: template.name,
  channel: 'website',
  subject: 'ูุชุญ ุฏูุนุฉ ุฌุฏูุฏุฉ',
  content: content,
  sent_by: adminId,
  sent_by_name: 'ูุญูุฏ ุงูุนูู',
  farm_id: farmId,
  farm_name: 'ูุฒุฑุนุฉ ุงูุฒูุชูู',
  status: 'sent'
});
```

### ูุซุงู 2: ุงูุจุญุซ ูู ุงูุณุฌู
```typescript
// ุงูุจุญุซ ุนู ุฑุณุงุฆู ูุณุชุซูุฑ ูุนูู
const messages = await messagesLogService
  .getInvestorMessages(investorId);

// ุงูุจุญุซ ุนู ุฑุณุงุฆู ูุฒุฑุนุฉ ูุนููุฉ
const farmMessages = await messagesLogService
  .getFarmMessages(farmId);

// ุงูุจุญุซ ูุน ููุงุชุฑ
const filtered = await messagesLogService.getAllMessages({
  message_type: 'payment',
  channel: 'website',
  status: 'sent',
  date_from: '2026-01-01',
  date_to: '2026-01-31'
});
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ูุง ุชู ุฅูุฌุงุฒู:
- โ 2 ุฌุฏุงูู ุฌุฏูุฏุฉ
- โ 2 ุฎุฏูุงุช ูุงููุฉ
- โ 2 ููููุงุช ูุงุฌูุฉ
- โ 4 ููุงูุจ ุงูุชุฑุงุถูุฉ
- โ 12+ ููุชุฑ ุจุญุซ
- โ 4 ุฅุญุตุงุฆูุงุช ุฑุฆูุณูุฉ
- โ 100% ุชุบุทูุฉ RLS

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุจูุงุก ูุธุงู ุฑุณุงุฆู ูุชูุงูู ูุดูู:

1. **ููุงูุจ ุฌุงูุฒุฉ** ููุงุณุชุฎุฏุงู ุงูููุฑู
2. **ุณุฌู ุดุงูู** ูุชูุซูู ูู ุดูุก
3. **ูุงุฌูุงุช ุฌูููุฉ** ูุณููุฉ ุงูุงุณุชุฎุฏุงู
4. **ุฃูุงู ูุญูู** ุจุตูุงุญูุงุช RLS
5. **ุฃุฏุงุก ุนุงูู** ูุน ููุงุฑุณ ูุญุณูุฉ

ุงููุธุงู **ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูุงูุชูุงูู** ูุน ุจุงูู ุงูุฃูุธูุฉ!

---

**ุชุงุฑูุฎ ุงูุฅูุฌุงุฒ**: 2026-01-28
**ุงููุฑุงุญู ุงูููุชููุฉ**: 1 + 2 + 3
**ุงูุญุงูุฉ**: โ **ููุชูู ุจูุฌุงุญ**
