# ุงููุฑุญูุฉ ุงูุฃููู: ุฅุนุงุฏุฉ ุจูุงุก ยซูุฒุฑุนุชูยป - ุงููุณุงุฑ ุงูุฒุฑุงุนู โ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุนุงุฏุฉ ุจูุงุก ูุณู "ูุฒุฑุนุชู" ูููุณุงุฑ ุงูุฒุฑุงุนู ุจูุฌุงุญ ุจุญูุซ:
- โ ุฌููุน ุงูุนูููุงุช ุนูู ูุณุชูู **ุงููุฒุฑุนุฉ** ูููุณ ุงููุณุชุฎุฏู
- โ ุงูุชูุงููู ุชูุญุณุจ ุชููุงุฆููุง ููู ุดุฌุฑุฉ
- โ ุงูุชูุฒูุน ุฏููุงูููู ููุช ุงูุนุฑุถ
- โ ูุงุจููุฉ ุงูุชูุณุน ูุขูุงู ุงููุณุชุฎุฏููู

---

## ๐ฏ ูุง ุชู ุชูููุฐู

### 1๏ธโฃ ุฅูุบุงุก ุงูููุทู ุงููุฏูู โ

**ุงููุจุฏุฃ ุงููุนูุงุฑู ุงูุฌุฏูุฏ:**
```
โ ูุง ููุฌุฏ user_id ูู ุงูุนูููุงุช ุงูุฒุฑุงุนูุฉ
โ ูุง ุชูุงุฑูุฑ ูุฑุฏูุฉ ููู ูุณุชุฎุฏู
โ ูุง ูุฑุงุณูุงุช ูุฑุชุจุทุฉ ุจูุณุชุฎุฏู ูุญุฏุฏ

โ ูู ุนูููุฉ ูุฑุชุจุทุฉ ุจู farm_id ููุท
โ ุงูุชูููุฉ ุนูู ูุณุชูู ุงููุฒุฑุนุฉ
โ ุงูุชูุฒูุน ูุญุฏุซ ุฏููุงูููููุง
```

### 2๏ธโฃ ุชุญุฏูุซ ุฌุฏูู agricultural_operations โ

**ุงูุญููู ุงูุฌุฏูุฏุฉ:**

```sql
-- ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ููุนูููุฉ ุนูู ูุณุชูู ุงููุฒุฑุนุฉ
total_cost decimal(12,2) DEFAULT 0

-- ุชูููุฉ ุงูุดุฌุฑุฉ ุงููุงุญุฏุฉ (ูุญุณูุจุฉ ุชููุงุฆููุง)
cost_per_tree decimal(12,2) DEFAULT 0
```

**ูุซุงู:**
- ูุฒุฑุนุฉ ุจูุง 1000 ุดุฌุฑุฉ
- ุนูููุฉ ุฑู ุชูููุชูุง ุงูุฅุฌูุงููุฉ: 5000 ุฑูุงู
- ุงููุธุงู ูุญุณุจ ุชููุงุฆููุง: `cost_per_tree = 5000 / 1000 = 5 ุฑูุงู/ุดุฌุฑุฉ`

### 3๏ธโฃ ุญุณุงุจ ุชูููุฉ ุงูุดุฌุฑุฉ ุชููุงุฆููุง โ

**ุชู ุฅูุดุงุก Trigger:**

```sql
CREATE TRIGGER trigger_calculate_cost_per_tree
  BEFORE INSERT OR UPDATE OF total_cost
  ON agricultural_operations
  FOR EACH ROW
  EXECUTE FUNCTION calculate_cost_per_tree();
```

**ุขููุฉ ุงูุนูู:**
1. ุงูุฃุฏูู ูุฏุฎู ุงูุนูููุฉ ูุน ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ
2. ุงููุธุงู ูุฌูุจ ุนุฏุฏ ุงูุฃุดุฌุงุฑ ูู `agricultural_tree_inventory`
3. ูุญุณุจ ุชููุงุฆููุง: `cost_per_tree = total_cost / ุนุฏุฏ_ุงูุฃุดุฌุงุฑ`
4. ูุญูุธ ุงููุชูุฌุฉ ูู ููุณ ุงูุณุฌู

**โจ ูุง ุญุงุฌุฉ ูุฃู ุญุณุงุจุงุช ูุฏููุฉ!**

### 4๏ธโฃ ุชูุฒูุน ุงูุชูููุฉ ุฏููุงูููููุง โ

**ุงููุจุฏุฃ:**
- โ **ูุง** ูุชู ุฅูุดุงุก ุณุฌู ููู ูุณุชุฎุฏู
- โ ุงูุญุณุงุจ ูุญุฏุซ ููุช ุงูุนุฑุถ ููุท

**ูุซุงู ุนููู:**

```typescript
// ุนูุฏ ุนุฑุถ ุตูุญุฉ ุงููุณุชุฎุฏู
const userTrees = 10; // ุงููุณุชุฎุฏู ูููู 10 ุฃุดุฌุงุฑ
const costPerTree = 5; // ูู agricultural_operations

// ุงูุญุณุงุจ ุงูุฏููุงูููู
const userCost = userTrees * costPerTree; // = 50 ุฑูุงู
```

**ุงูููุงุฆุฏ:**
- โ ูุง ุชุฎุฒูู ููุฑุฑ
- โ ุฃุฏุงุก ุนุงูู
- โ ูุนูู ูุน 1 ุฃู 100,000 ูุณุชุฎุฏู ุจููุณ ุงูููุงุกุฉ

### 5๏ธโฃ ุงูุฅุดุนุงุฑุงุช ุนูู ูุณุชูู ุงููุฒุฑุนุฉ โ

**ุชู ุฅูุดุงุก ุฌุฏูู ุฌุฏูุฏ:**

```sql
CREATE TABLE farm_operation_notifications (
  id uuid PRIMARY KEY,
  farm_id uuid REFERENCES farms(id),
  operation_id uuid REFERENCES agricultural_operations(id),
  notification_type text,
  title text,
  message text,
  is_read boolean DEFAULT false,
  created_at timestamptz DEFAULT now()
);
```

**ุขููุฉ ุงูุนูู:**

1. **ุนูุฏ ุฅุถุงูุฉ ุนูููุฉ ุฒุฑุงุนูุฉ:**
   - ูุชู ุฅูุดุงุก ุฅุดุนุงุฑ **ูุงุญุฏ** ูุฑุชุจุท ุจู `farm_id`
   - ูุซุงู: "ุชู ุฅุถุงูุฉ ุนูููุฉ ุฑู ุจุชุงุฑูุฎ 2026-02-04"

2. **ุนูุฏ ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูููุณุชุฎุฏู:**
   ```sql
   -- ุงููุณุชุฎุฏู ูุฑู ููุท ุฅุดุนุงุฑุงุช ุงููุฒุงุฑุน ุงูุชู ูุฏูู ุฃุดุฌุงุฑ ูููุง
   SELECT * FROM farm_operation_notifications
   WHERE farm_id IN (
     SELECT farm_id FROM reservations
     WHERE user_id = auth.uid() AND status = 'active'
   )
   ```

3. **ุงููุชูุฌุฉ:**
   - โ ุฅุดุนุงุฑ ูุงุญุฏ ููู ุนูููุฉ
   - โ ูู ูู ูุฏูู ุดุฌุฑุฉ ูู ุงููุฒุฑุนุฉ ูุฑุงู
   - โ ูุง ุฅุฑุณุงู ูุฏูู
   - โ ูุงุจููุฉ ุชูุณุน ูุง ูุญุฏูุฏุฉ

---

## ๐ป ูุงุฌูุฉ ุงููุณุชุฎุฏู (Admin)

### ุชุญุฏูุซุงุช ุชุจููุจ "ุงูุนูููุงุช ุงูุฒุฑุงุนูุฉ"

**1. ุจุทุงูุฉ ุฅุญุตุงุฆูุฉ ุฌุฏูุฏุฉ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ฐ ุฅุฌูุงูู ุงูุชูุงููู    โ
โ    15,000 ุฑูุงู          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**2. ูููุฐุฌ ุฅุถุงูุฉ ุนูููุฉ:**
```
- ููุน ุงูุนูููุฉ: [ุฑู โผ]
- ุชุงุฑูุฎ ุงูุนูููุฉ: [2026-02-04]
- ุงููุตู: [ูุต ุชูุตููู]
- ุงูููุงุญุธุงุช ุงูุฏุงุฎููุฉ: [ูุต]
- ๐ฐ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ: [5000.00] ุฑูุงู
  โโ ุณูุชู ุญุณุงุจ ุชูููุฉ ุงูุดุฌุฑุฉ ุชููุงุฆููุง
```

**3. ุนุฑุถ ุงูุนูููุฉ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ง ุฑู                   2026-02-04   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ุชู ุฑู ุงููุฒุฑุนุฉ ุจุงููุงูู               โ
โ                                      โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ฐ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ: 5,000 ุฑูุงูโ โ
โ โ           5.00 ุฑูุงู/ุดุฌุฑุฉ          โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ

### ูุตุฏุฑ ุงูุจูุงูุงุช ุงููุงุญุฏ

```
agricultural_operations (ุงููุตุฏุฑ ุงููุญูุฏ)
    โ
    โโ total_cost (ุชูููุฉ ุฅุฌูุงููุฉ ูุงุญุฏุฉ)
    โ
    โโ cost_per_tree (ูุญุณูุจุฉ ุชููุงุฆููุง)
          โ
          โโ ุงููุณุงุฑ ุงูุฒุฑุงุนู ูุนุฑุถูุง ูุนูููุฉ ุฒุฑุงุนูุฉ
          โ
          โโ ุงููุณุงุฑ ุงูุงุณุชุซูุงุฑู ูุนุฑุถูุง ูุชูููุฉ ุชุดุบูู
              (ุณูุชู ูู ุงููุฑุญูุฉ ุงูุซุงููุฉ)
```

### ุชุฏูู ุงูุจูุงูุงุช

```
1. ุงูุฃุฏูู ูุฏุฎู ุนูููุฉ:
   โโโโโโโโโโโโโโโโโโโโโโ
   โ farm_id: ABC123    โ
   โ operation_type: ุฑู โ
   โ total_cost: 5000   โ
   โโโโโโโโโโโโโโโโโโโโโโ
           โ
2. Trigger ูุญุณุจ ุชููุงุฆููุง:
   cost_per_tree = 5000 / 1000 = 5 ุฑูุงู
           โ
3. Trigger ููุดุฆ ุฅุดุนุงุฑ:
   โโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ "ุนูููุฉ ุฑู ุฌุฏูุฏุฉ"      โ
   โ farm_id: ABC123        โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ
4. ุงููุณุชุฎุฏู ููุชุญ "ูุฒุฑุนุชู":
   - ูุฌูุจ ุงูุนูููุงุช ูููุฒุฑุนุฉ
   - ูุญุณุจ ุฏููุงูููููุง: 10 ุฃุดุฌุงุฑ ร 5 ุฑูุงู = 50 ุฑูุงู
   - ูุนุฑุถ ุงููุชูุฌุฉ
```

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1๏ธโฃ ุชุณุฌูู ุงูุฏุฎูู ูุฃุฏูู

```
ุงูุฑุงุจุท: /admin
ุงูุจุฑูุฏ: admin@dev.com
ูููุฉ ุงููุฑูุฑ: Admin@123
```

### 2๏ธโฃ ูุชุญ ุชุจููุจ "ุงูุนูููุงุช ุงูุฒุฑุงุนูุฉ"

1. ููุญุฉ ุงูุชุญูู โ **ูุฒุฑุนุชู**
2. ุงุฎุชุฑ: **ุงููุณุงุฑ ุงูุฒุฑุงุนู**
3. ุงุฎุชุฑ ูุฒุฑุนุฉ
4. ุงูุชุญ: **ุงูุนูููุงุช ุงูุฒุฑุงุนูุฉ**

### 3๏ธโฃ ุฅุถุงูุฉ ุนูููุฉ ูุน ุชูููุฉ

1. ุงุถุบุท "ุฅุถุงูุฉ ุนูููุฉ"
2. ุงููุฃ ุงููููุฐุฌ:
   - ููุน ุงูุนูููุฉ: **ุฑู**
   - ุงูุชุงุฑูุฎ: **ุงูููู**
   - ุงููุตู: **ุฑู ุดุงูู ูููุฒุฑุนุฉ**
   - ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ: **5000** ุฑูุงู
3. ุงุญูุธ

### 4๏ธโฃ ุงูุชุญูู ูู ุงูุญุณุงุจ ุงูุชููุงุฆู

1. ุงูุชุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุญูู ูู `agricultural_operations`
3. โ ูุฌุจ ุฃู ุชุฑู:
   ```
   total_cost: 5000
   cost_per_tree: 5.00 (ูุญุณูุจ ุชููุงุฆููุง)
   ```

### 5๏ธโฃ ุงูุชุญูู ูู ุงูุฅุดุนุงุฑ

1. ุงูุชุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุญูู ูู `farm_operation_notifications`
3. โ ูุฌุจ ุฃู ุชุฑู ุฅุดุนุงุฑ ูุงุญุฏ ูุฑุชุจุท ุจู `farm_id`

### 6๏ธโฃ ุงูุชุญูู ูู ุงูุนุฑุถ

1. ูู ูุงุฌูุฉ ุงูุฃุฏูู
2. ุดุงูุฏ ุจุทุงูุฉ ุงูุนูููุฉ
3. โ ูุฌุจ ุฃู ุชุฑู:
   - ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ: **5,000 ุฑูุงู**
   - ุชูููุฉ ุงูุดุฌุฑุฉ: **5.00 ุฑูุงู/ุดุฌุฑุฉ**

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ูุจู ุงููุฑุญูุฉ ุงูุฃููู
- โ ุนูููุงุช ูุฑุชุจุทุฉ ุจูุณุชุฎุฏููู
- โ ุชุฎุฒูู ููุฑุฑ ููู ูุณุชุฎุฏู
- โ ุญุณุงุจุงุช ูุฏููุฉ
- โ ุตุนูุจุฉ ุงูุชูุณุน

### ุจุนุฏ ุงููุฑุญูุฉ ุงูุฃููู
- โ ุนูููุงุช ุนูู ูุณุชูู ุงููุฒุฑุนุฉ ููุท
- โ ูุง ุชุฎุฒูู ููุฑุฑ
- โ ุญุณุงุจ ุชููุงุฆู ููุชูุงููู
- โ ุชูุฒูุน ุฏููุงูููู ููุช ุงูุนุฑุถ
- โ ูุงุจููุฉ ุชูุณุน ูุง ูุญุฏูุฏุฉ

---

## ๐ ุงูุฃูุงู

### RLS Policies

**1. agricultural_operations:**
```sql
-- ุงูุฃุฏูู: ูุตูู ูุงูู
FOR ALL TO authenticated
USING (EXISTS (SELECT 1 FROM admins WHERE admins.user_id = auth.uid()))
```

**2. farm_operation_notifications:**
```sql
-- ุงูุฃุฏูู: ูุตูู ูุงูู
FOR ALL TO authenticated
USING (EXISTS (SELECT 1 FROM admins WHERE admins.user_id = auth.uid()))

-- ุงููุณุชุฎุฏููู: ุนุฑุถ ุฅุดุนุงุฑุงุช ูุฒุงุฑุนูู ููุท
FOR SELECT TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM reservations
    WHERE farm_id = farm_operation_notifications.farm_id
      AND user_id = auth.uid()
      AND status = 'active'
  )
)
```

---

## ๐ ุงูุฃุฏุงุก

### ููุงุฑูุฉ ุงูุฃุฏุงุก

**ุงูุณููุงุฑูู:** ูุฒุฑุนุฉ ุจูุง 1000 ูุณุชุฎุฏูุ ุฅุถุงูุฉ ุนูููุฉ ูุงุญุฏุฉ

| ุงููุนูุงุฑ | ูุจู | ุจุนุฏ |
|---------|-----|-----|
| ุนุฏุฏ ุงูุณุฌูุงุช ุงููููุดุฃุฉ | 1000 | 1 |
| ุญุฌู ุงูุชุฎุฒูู | 1000ร | 1ร |
| ููุช ุงูุฅุฏุฎุงู | ุจุทูุก | ููุฑู |
| ูุงุจููุฉ ุงูุชูุณุน | ูุญุฏูุฏุฉ | ูุง ูุญุฏูุฏุฉ |

---

## ๐ฏ ูุนูุงุฑ ุงููุจูู (ุชู ุชุญูููู)

- โ ุฅุถุงูุฉ ุนูููุฉ ูุงุญุฏุฉ ุชุฎุฏู 10 ุฃู 100,000 ูุณุชุฎุฏู ุจููุณ ุงูุฃุฏุงุก
- โ ูุง ููุฌุฏ `user_id` ูู ุฌุฏูู `agricultural_operations`
- โ ูุง ููุฌุฏ ุณุฌู ุชุดุบูู ูุฑุชุจุท ุจูุณุชุฎุฏู
- โ ุงูุชูุงููู ุชูุญุณุจ ุญุณุจ ุงูุฃุดุฌุงุฑ ููุท
- โ ุงูุญุณุงุจ ุฏููุงูููู ููุช ุงูุนุฑุถ
- โ ุฅุดุนุงุฑ ูุงุญุฏ ููู ุนูููุฉุ ูุฑุงู ุฌููุน ุงููุณุชุฎุฏููู

---

## ๐ ุงููููุงุช ุงููุนุฏููุฉ

### Migrations
- โ `phase1_add_cost_tracking_to_farm_operations.sql`
  - ุฅุถุงูุฉ `total_cost`
  - ุฅุถุงูุฉ `cost_per_tree`
  - ุฅูุดุงุก trigger ููุญุณุงุจ ุงูุชููุงุฆู
  - ุฅูุดุงุก ุฌุฏูู `farm_operation_notifications`
  - ุณูุงุณุงุช RLS

### Components
- โ `AgriculturalOperationsTab.tsx`
  - ุฅุถุงูุฉ ุญูู ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ
  - ุนุฑุถ ุชูููุฉ ุงูุดุฌุฑุฉ
  - ุฅุญุตุงุฆูุฉ ุงูุชูุงููู ุงูุฅุฌูุงููุฉ
  - ูุงุฌูุฉ ุฅุฏุฎุงู ูุญุณููุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

**ุงููุฑุญูุฉ ุงูุซุงููุฉ (ูู ุงูุชุธุงุฑ ุงูููุงููุฉ):**
- ุชูุนูู "ูุฒุฑุนุชู" ูููุณุงุฑ ุงูุงุณุชุซูุงุฑู
- ุงุณุชุฎุฏุงู ููุณ ุงูุจูุงูุงุช ูู `agricultural_operations`
- ุงุฎุชูุงู ุงูุนุฑุถ ููุท (ุนูููุฉ ุฒุฑุงุนูุฉ vs ุชูููุฉ ุชุดุบูู)

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุนุงุฏุฉ ุจูุงุก ูุณู "ูุฒุฑุนุชู" ูููุณุงุฑ ุงูุฒุฑุงุนู ุจูุฌุงุญ ูุน:

1. โ **ูุนูุงุฑูุฉ ูุงุจูุฉ ููุชูุณุน**
   - ุนูููุฉ ูุงุญุฏุฉ ุชุฎุฏู ุขูุงู ุงููุณุชุฎุฏููู
   - ูุง ุชุฎุฒูู ููุฑุฑ
   - ุฃุฏุงุก ููุชุงุฒ

2. โ **ุญุณุงุจุงุช ุชููุงุฆูุฉ**
   - ุชูููุฉ ุงูุดุฌุฑุฉ ุชูุญุณุจ ุชููุงุฆููุง
   - ุชูุฒูุน ุฏููุงูููู
   - ูุง ุญุงุฌุฉ ูุชุฏุฎู ูุฏูู

3. โ **ุฅุดุนุงุฑุงุช ุฐููุฉ**
   - ุฅุดุนุงุฑ ูุงุญุฏ ููู ุนูููุฉ
   - ูุตู ูุฌููุน ุงููุณุชุฎุฏููู ุงููุนูููู
   - ูุง ุฅุฑุณุงู ูุฏูู

4. โ **ูุงุฌูุฉ ูุญุณููุฉ**
   - ุฅุฏุฎุงู ุณูู ููุชูุงููู
   - ุนุฑุถ ูุงุถุญ ููุจูุงูุงุช
   - ุฅุญุตุงุฆูุงุช ูููุฏุฉ

**ุงููุฑุญูุฉ ุงูุฃููู ููุชููุฉ ุจูุฌุงุญ! โ**

---

**ุชุงุฑูุฎ ุงูุฅููุงู:** 2026-02-04
**ุนุฏุฏ ุงููููุงุช ุงููุนุฏูุฉ:** 2
**ุนุฏุฏ Migrations:** 1
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ

**ุฌุงูุฒ ููุงูุชูุงู ุฅูู ุงููุฑุญูุฉ ุงูุซุงููุฉ!** ๐
